###############################################################################
#                                                                             #
# IAR C/C++ Compiler V7.60.1.40026 for 8051             29/Apr/2014  21:31:46 #
# Copyright (C) 2004-2010 IAR Systems AB.                                     #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data_rom                                           #
#    Dptr setup         =  1,16                                               #
#    Source file        =  D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\Source\GenericApp.c  #
#    Command line       =  -f D:\zigbee\projects\zstack-cc2530-coordinator\Pr #
#                          ojects\zstack\Samples\GenericApp\CC2530DB\..\..\.. #
#                          \Tools\CC2530DB\f8wCoord.cfg (-DCPU32MHZ           #
#                          -DROOT=__near_func -DMAC_CFG_APP_PENDING_QUEUE=TRU #
#                          E -DMAC_CFG_TX_DATA_MAX=5 -DMAC_CFG_TX_MAX=8       #
#                          -DMAC_CFG_RX_MAX=5 -DZDO_COORDINATOR -DRTR_NWK)    #
#                          -f D:\zigbee\projects\zstack-cc2530-coordinator\Pr #
#                          ojects\zstack\Samples\GenericApp\CC2530DB\..\..\.. #
#                          \Tools\CC2530DB\f8wConfig.cfg (-DZIGBEEPRO         #
#                          -DSECURE=0 -DZG_SECURE_DYNAMIC=0 -DREFLECTOR       #
#                          -DDEFAULT_CHANLIST=0x00000800                      #
#                          -DZDAPP_CONFIG_PAN_ID=0x1111                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DLINK_STATUS_JITTER_MASK=0x007F                   #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3    #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40           #
#                          -DNWK_MAX_BINDING_ENTRIES=4                        #
#                          -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DMAC_MAX_FRAME_SIZE=116                           #
#                          -DZDNWKMGR_MIN_TRANSMISSIONS=20 "-DCONST=const     #
#                          __code" -DGENERIC=__generic                        #
#                          -DRFD_RCVC_ALWAYS_ON=FALSE -DPOLL_RATE=1000        #
#                          -DQUEUED_POLL_RATE=100 -DRESPONSE_POLL_RATE=100)   #
#                          -DREJOIN_POLL_RATE=440 D:\zigbee\projects\zstack-c #
#                          c2530-coordinator\Projects\zstack\Samples\GenericA #
#                          pp\Source\GenericApp.c -D ZAPP_P1 -D MT_TASK -D    #
#                          MT_SYS_FUNC -D MT_ZDO_FUNC -D HAL_UART -D          #
#                          HAL_UART=TRUE -D HAL_DMA=TRUE -D HAL_LCD=FALSE -D  #
#                          HAL_KEY=FALSE -lC D:\zigbee\projects\zstack-cc2530 #
#                          -coordinator\Projects\zstack\Samples\GenericApp\CC #
#                          2530DB\CoordinatorEB\List\ -lA                     #
#                          D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\Coordinator #
#                          EB\List\ --diag_suppress Pe001,Pa010 -o            #
#                          D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\Coordinator #
#                          EB\Obj\ -e --require_prototypes --no_code_motion   #
#                          --debug --core=plain --dptr=16,1                   #
#                          --data_model=large --code_model=banked             #
#                          --calling_convention=xdata_reentrant               #
#                          --place_constants=data_rom --nr_virtual_regs 16    #
#                          -I D:\zigbee\projects\zstack-cc2530-coordinator\Pr #
#                          ojects\zstack\Samples\GenericApp\CC2530DB\ -I      #
#                          D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\Source\  #
#                          -I D:\zigbee\projects\zstack-cc2530-coordinator\Pr #
#                          ojects\zstack\Samples\GenericApp\CC2530DB\..\..\.. #
#                          \ZMain\TI2530DB\ -I D:\zigbee\projects\zstack-cc25 #
#                          30-coordinator\Projects\zstack\Samples\GenericApp\ #
#                          CC2530DB\..\..\..\..\..\Components\hal\include\    #
#                          -I D:\zigbee\projects\zstack-cc2530-coordinator\Pr #
#                          ojects\zstack\Samples\GenericApp\CC2530DB\..\..\.. #
#                          \..\..\Components\hal\target\CC2530EB\ -I          #
#                          D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\mac\include\ -I                     #
#                          D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\mac\high_level\ -I                  #
#                          D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\mac\low_level\srf04\ -I             #
#                          D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\mac\low_level\srf04\single_chip\    #
#                          -I D:\zigbee\projects\zstack-cc2530-coordinator\Pr #
#                          ojects\zstack\Samples\GenericApp\CC2530DB\..\..\.. #
#                          \..\..\Components\mt\ -I                           #
#                          D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\osal\include\ -I                    #
#                          D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\osal\mcu\ccsoc\ -I                  #
#                          D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\services\saddr\ -I                  #
#                          D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\services\sdata\ -I                  #
#                          D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\stack\af\ -I                        #
#                          D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\stack\nwk\ -I                       #
#                          D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\stack\sapi\ -I                      #
#                          D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\stack\sec\ -I                       #
#                          D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\stack\sys\ -I                       #
#                          D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\stack\zdo\ -I                       #
#                          D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\zmac\ -I D:\zigbee\projects\zstack- #
#                          cc2530-coordinator\Projects\zstack\Samples\Generic #
#                          App\CC2530DB\..\..\..\..\..\Components\zmac\f8w\   #
#                          -I "C:\Program Files (x86)\IAR Systems\Embedded    #
#                          Workbench 5.4\8051\INC\" -I "C:\Program Files      #
#                          (x86)\IAR Systems\Embedded Workbench               #
#                          5.4\8051\INC\CLIB\" -Ohz                           #
#    List file          =  D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\Coordinator #
#                          EB\List\GenericApp.lst                             #
#    Object file        =  D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\Coordinator #
#                          EB\Obj\GenericApp.r51                              #
#                                                                             #
#                                                                             #
###############################################################################

D:\zigbee\projects\zstack-cc2530-coordinator\Projects\zstack\Samples\GenericApp\Source\GenericApp.c
      1          /**************************************************************************************************
      2            Filename:       GenericApp.c
      3            Revised:        $Date: 2009-03-18 15:56:27 -0700 (Wed, 18 Mar 2009) $
      4            Revision:       $Revision: 19453 $
      5          
      6            Description:    Generic Application (no Profile).
      7          
      8          
      9            Copyright 2004-2009 Texas Instruments Incorporated. All rights reserved.
     10          
     11            IMPORTANT: Your use of this Software is limited to those specific rights
     12            granted under the terms of a software license agreement between the user
     13            who downloaded the software, his/her employer (which must be your employer)
     14            and Texas Instruments Incorporated (the "License").  You may not use this
     15            Software unless you agree to abide by the terms of the License. The License
     16            limits your use, and you acknowledge, that the Software may not be modified,
     17            copied or distributed unless embedded on a Texas Instruments microcontroller
     18            or used solely and exclusively in conjunction with a Texas Instruments radio
     19            frequency transceiver, which is integrated into your product.  Other than for
     20            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     21            works of, modify, distribute, perform, display or sell this Software and/or
     22            its documentation for any purpose.
     23          
     24            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     25            PROVIDED “AS IS?WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED, 
     26            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE, 
     27            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     28            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     29            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     30            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     31            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     32            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     33            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     34            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     35          
     36            Should you have any questions regarding your right to use this Software,
     37            contact Texas Instruments Incorporated at www.TI.com. 
     38          **************************************************************************************************/
     39          
     40          
     41          
     42          /*********************************************************************
     43           * INCLUDES
     44           */
     45          #include "OSAL.h"
     46          #include "AF.h"
     47          #include "ZDApp.h"
     48          #include "ZDObject.h"
     49          #include "ZDProfile.h"
     50          
     51          #include "GenericApp.h"
     52          #include "DebugTrace.h"
     53          #include "mt_uart.h"
     54          
     55          #if !defined( WIN32 )
     56            #include "OnBoard.h"
     57          #endif
     58          
     59          /* HAL */
     60          #include "hal_lcd.h"
     61          #include "hal_led.h"
     62          #include "hal_key.h"
     63          #include "hal_uart.h"
     64          
     65          /*********************************************************************
     66           * MACROS
     67           */
     68          /*********************************************************************
     69           * CONSTANTS
     70           */
     71           
     72          /*********************************************************************
     73           * TYPEDEFS
     74           */
     75           typedef struct
     76           {
     77             unsigned char endPoint;
     78             unsigned char extAddr[8];
     79             unsigned char compressed_addr;
     80           } EndDeviceInfo_t; //saved the end device information
     81          
     82          /*********************************************************************
     83           * GLOBAL VARIABLES
     84           */

   \                                 In  segment XDATA_Z, align 1, keep-with-next
     85          unsigned char device_count = 0;
   \                     device_count:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
     86           
     87           
     88          // This list should be filled with Application specific Cluster IDs.

   \                                 In  segment XDATA_ROM_C, align 1
     89          const cId_t GenericApp_ClusterList[GENERICAPP_MAX_CLUSTERS] =
   \                     GenericApp_ClusterList:
   \   000000   0100         DW 1
     90          {
     91            GENERICAPP_CLUSTERID
     92          };
     93          

   \                                 In  segment XDATA_ROM_C, align 1
     94          const SimpleDescriptionFormat_t GenericApp_SimpleDesc =
   \                     GenericApp_SimpleDesc:
   \   000000   20           DB 32
   \   000001   040F0100     DW 3844, 1
   \   000005   0001         DB 0, 1
   \   000007   ....         DW GenericApp_ClusterList
   \   000009   01           DB 1
   \   00000A   ....         DW GenericApp_ClusterList
     95          {
     96            GENERICAPP_ENDPOINT,              //  int Endpoint;
     97            GENERICAPP_PROFID,                //  uint16 AppProfId[2];
     98            GENERICAPP_DEVICEID,              //  uint16 AppDeviceId[2];
     99            GENERICAPP_DEVICE_VERSION,        //  int   AppDevVer:4;
    100            GENERICAPP_FLAGS,                 //  int   AppFlags:4;
    101            GENERICAPP_MAX_CLUSTERS,          //  byte  AppNumInClusters;
    102            (cId_t *)GenericApp_ClusterList,  //  byte *pAppInClusterList;
    103            GENERICAPP_MAX_CLUSTERS,          //  byte  AppNumInClusters;
    104            (cId_t *)GenericApp_ClusterList   //  byte *pAppInClusterList;
    105          };
    106          
    107          // This is the Endpoint/Interface description.  It is defined here, but
    108          // filled-in in GenericApp_Init().  Another way to go would be to fill
    109          // in the structure here and make it a "const" (in code space).  The
    110          // way it's defined in this sample app it is define in RAM.

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    111          endPointDesc_t GenericApp_epDesc;
   \                     GenericApp_epDesc:
   \   000000                DS 6
   \   000006                REQUIRE __INIT_XDATA_Z
    112          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    113          EndDeviceInfo_t EndDeviceInfos[16]; //init space for 16 devices
   \                     EndDeviceInfos:
   \   000000                DS 160
   \   0000A0                REQUIRE __INIT_XDATA_Z
    114          
    115          /*********************************************************************
    116           * EXTERNAL VARIABLES
    117           */
    118          
    119          /*********************************************************************
    120           * EXTERNAL FUNCTIONS
    121           */
    122          
    123          /*********************************************************************
    124           * LOCAL VARIABLES
    125           */

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    126          byte GenericApp_TaskID;   // Task ID for internal task/event processing
   \                     GenericApp_TaskID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    127                                    // This variable will be received when
    128                                    // GenericApp_Init() is called.

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    129          devStates_t GenericApp_NwkState;
   \                     GenericApp_NwkState:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    130          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    131          byte GenericApp_TransID;  // This is the unique message ID (counter)
   \                     GenericApp_TransID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    132          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    133          afAddrType_t GenericApp_DstAddr;
   \                     GenericApp_DstAddr:
   \   000000                DS 12
   \   00000C                REQUIRE __INIT_XDATA_Z
    134          
    135          /*********************************************************************
    136           * LOCAL FUNCTIONS
    137           */
    138          void GenericApp_ProcessZDOMsgs( zdoIncomingMsg_t *inMsg );
    139          void GenericApp_MessageMSGCB( afIncomingMSGPacket_t *pckt );
    140          void GenericApp_SendTheMessage( unsigned char dest_endID, unsigned char cmd, unsigned int temp_set);
    141          void GenericApp_SerialMSGCB(void);
    142          void str_reverse(char *str, int length);
    143          
    144          /*********************************************************************
    145           * NETWORK LAYER CALLBACKS
    146           */
    147          
    148          /*********************************************************************
    149           * PUBLIC FUNCTIONS
    150           */
    151          
    152          /*********************************************************************
    153           * @fn      GenericApp_Init
    154           *
    155           * @brief   Initialization function for the Generic App Task.
    156           *          This is called during initialization and should contain
    157           *          any application specific initialization (ie. hardware
    158           *          initialization/setup, table initialization, power up
    159           *          notificaiton ... ).
    160           *
    161           * @param   task_id - the ID assigned by OSAL.  This ID should be
    162           *                    used to send messages and set timers.
    163           *
    164           * @return  none
    165           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    166          void GenericApp_Init( byte task_id )
   \                     GenericApp_Init:
    167          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 29
   \   000005   74E3         MOV     A,#-0x1d
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   E9           MOV     A,R1
    168            halUARTCfg_t uartConfig;
    169            GenericApp_TaskID = task_id;
   \   00000B   90....       MOV     DPTR,#GenericApp_TaskID
   \   00000E   F0           MOVX    @DPTR,A
    170            GenericApp_NwkState = DEV_INIT;
   \   00000F   7401         MOV     A,#0x1
   \   000011   90....       MOV     DPTR,#GenericApp_NwkState
   \   000014   F0           MOVX    @DPTR,A
    171            GenericApp_TransID = 0;
   \   000015   E4           CLR     A
   \   000016   90....       MOV     DPTR,#GenericApp_TransID
   \   000019   F0           MOVX    @DPTR,A
    172            
    173            // Device hardware initialization can be added here or in main() (Zmain.c).
    174            uartConfig.configured           = TRUE;              // 2x30 don't care - see uart driver.
   \   00001A   7401         MOV     A,#0x1
   \   00001C   85..82       MOV     DPL,?XSP + 0
   \   00001F   85..83       MOV     DPH,?XSP + 1
   \   000022   F0           MOVX    @DPTR,A
    175            uartConfig.baudRate             = HAL_UART_BR_115200;
   \   000023   12....       LCALL   ?XSTACK_DISP0_8
   \   000026   7404         MOV     A,#0x4
   \   000028   F0           MOVX    @DPTR,A
    176            uartConfig.flowControl          = FALSE;
   \   000029   7402         MOV     A,#0x2
   \   00002B   12....       LCALL   ?XSTACK_DISP0_8
   \   00002E   E4           CLR     A
   \   00002F   F0           MOVX    @DPTR,A
    177            uartConfig.intEnable            = TRUE;              // 2x30 don't care - see uart driver.
   \   000030   7416         MOV     A,#0x16
   \   000032   12....       LCALL   ?XSTACK_DISP0_8
   \   000035   7401         MOV     A,#0x1
   \   000037   F0           MOVX    @DPTR,A
    178            uartConfig.callBackFunc         = MT_UartProcessZAppData;
   \   000038   741B         MOV     A,#0x1b
   \   00003A   12....       LCALL   ?XSTACK_DISP0_8
   \   00003D   74..         MOV     A,#(??MT_UartProcessZAppData?relay & 0xff)
   \   00003F   F0           MOVX    @DPTR,A
   \   000040   A3           INC     DPTR
   \   000041   74..         MOV     A,#((??MT_UartProcessZAppData?relay >> 8) & 0xff)
   \   000043   F0           MOVX    @DPTR,A
    179            HalUARTOpen (0, &uartConfig);
   \   000044                ; Setup parameters for call to function HalUARTOpen
   \   000044   85..82       MOV     DPL,?XSP + 0
   \   000047   85..83       MOV     DPH,?XSP + 1
   \   00004A   AA82         MOV     R2,DPL
   \   00004C   AB83         MOV     R3,DPH
   \   00004E   7900         MOV     R1,#0x0
   \   000050   12....       LCALL   ??HalUARTOpen?relay
    180          
    181            // If the hardware is application specific - add it here.
    182            // If the hardware is other parts of the device add it in main().
    183            
    184          
    185            // Fill out the endpoint description.
    186            GenericApp_epDesc.endPoint = GENERICAPP_ENDPOINT;
   \   000053   7420         MOV     A,#0x20
   \   000055   90....       MOV     DPTR,#GenericApp_epDesc
   \   000058   F0           MOVX    @DPTR,A
    187            GenericApp_epDesc.task_id = &GenericApp_TaskID;
   \   000059   90....       MOV     DPTR,#(GenericApp_epDesc + 1)
   \   00005C   74..         MOV     A,#(GenericApp_TaskID & 0xff)
   \   00005E   F0           MOVX    @DPTR,A
   \   00005F   A3           INC     DPTR
   \   000060   74..         MOV     A,#((GenericApp_TaskID >> 8) & 0xff)
   \   000062   F0           MOVX    @DPTR,A
    188            GenericApp_epDesc.simpleDesc
    189                      = (SimpleDescriptionFormat_t *)&GenericApp_SimpleDesc;
   \   000063   90....       MOV     DPTR,#(GenericApp_epDesc + 3)
   \   000066   74..         MOV     A,#(GenericApp_SimpleDesc & 0xff)
   \   000068   F0           MOVX    @DPTR,A
   \   000069   A3           INC     DPTR
   \   00006A   74..         MOV     A,#((GenericApp_SimpleDesc >> 8) & 0xff)
   \   00006C   F0           MOVX    @DPTR,A
    190            GenericApp_epDesc.latencyReq = noLatencyReqs;
   \   00006D   E4           CLR     A
   \   00006E   90....       MOV     DPTR,#(GenericApp_epDesc + 5)
   \   000071   F0           MOVX    @DPTR,A
    191          
    192            // Register the endpoint description with the AF
    193            afRegister( &GenericApp_epDesc );
   \   000072                ; Setup parameters for call to function afRegister
   \   000072   7A..         MOV     R2,#(GenericApp_epDesc & 0xff)
   \   000074   7B..         MOV     R3,#((GenericApp_epDesc >> 8) & 0xff)
   \   000076   12....       LCALL   ??afRegister?relay
    194          
    195            // Register for all key events - This app will handle all key events
    196            RegisterForKeys( GenericApp_TaskID );
   \   000079                ; Setup parameters for call to function RegisterForKeys
   \   000079   90....       MOV     DPTR,#GenericApp_TaskID
   \   00007C   E0           MOVX    A,@DPTR
   \   00007D   F9           MOV     R1,A
   \   00007E   12....       LCALL   ??RegisterForKeys?relay
    197            
    198            //HalUARTWrite(0,"Init!\r\n",10);
    199          }
   \   000081   741D         MOV     A,#0x1d
   \   000083   12....       LCALL   ?DEALLOC_XSTACK8
   \   000086   7F01         MOV     R7,#0x1
   \   000088   02....       LJMP    ?BANKED_LEAVE_XDATA
    200          
    201          /*********************************************************************
    202           * @fn      GenericApp_ProcessEvent
    203           *
    204           * @brief   Generic Application Task event processor.  This function
    205           *          is called to process all events for the task.  Events
    206           *          include timers, messages and any other user defined events.
    207           *
    208           * @param   task_id  - The OSAL assigned task ID.
    209           * @param   events - events to process.  This is a bit map and can
    210           *                   contain more than one event.
    211           *
    212           * @return  none
    213           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    214          UINT16 GenericApp_ProcessEvent( byte task_id, UINT16 events )
   \                     GenericApp_ProcessEvent:
    215          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 0
   \   000005   8A..         MOV     ?V0 + 0,R2
   \   000007   8B..         MOV     ?V0 + 1,R3
    216            afIncomingMSGPacket_t *MSGpkt;
    217            afDataConfirm_t *afDataConfirm;
    218          
    219            // Data Confirmation message fields
    220            byte sentEP;
    221            ZStatus_t sentStatus;
    222            byte sentTransID;       // This should match the value sent
    223            (void)task_id;  // Intentionally unreferenced parameter
    224            //printf("\r\nEvent Processing!\r\n");
    225            if ( events & SYS_EVENT_MSG )
   \   000009   7480         MOV     A,#-0x80
   \   00000B   55..         ANL     A,?V0 + 1
   \   00000D   F9           MOV     R1,A
   \   00000E   E4           CLR     A
   \   00000F   7001         JNZ     ??GenericApp_ProcessEvent_0
   \   000011   E9           MOV     A,R1
   \                     ??GenericApp_ProcessEvent_0:
   \   000012   605C         JZ      ??GenericApp_ProcessEvent_1
    226            {
    227              MSGpkt = (afIncomingMSGPacket_t *)osal_msg_receive( GenericApp_TaskID );
   \   000014                ; Setup parameters for call to function osal_msg_receive
   \   000014   800E         SJMP    ??GenericApp_ProcessEvent_2
    228              while ( MSGpkt )
    229              {
    230                switch ( MSGpkt->hdr.event )
    231                {
    232                  case ZDO_CB_MSG:
    233                    GenericApp_ProcessZDOMsgs( (zdoIncomingMsg_t *)MSGpkt );
   \                     ??GenericApp_ProcessEvent_3:
   \   000016                ; Setup parameters for call to function GenericApp_ProcessZDOMsgs
   \   000016   EE           MOV     A,R6
   \   000017   FA           MOV     R2,A
   \   000018   EF           MOV     A,R7
   \   000019   FB           MOV     R3,A
   \   00001A   12....       LCALL   ??GenericApp_ProcessZDOMsgs?relay
    234                    break;
    235          
    236                  case AF_DATA_CONFIRM_CMD:
    237                    // This message is received as a confirmation of a data packet sent.
    238                    // The status is of ZStatus_t type [defined in ZComDef.h]
    239                    // The message fields are defined in AF.h
    240                    afDataConfirm = (afDataConfirm_t *)MSGpkt;
    241                    sentEP = afDataConfirm->endpoint;
    242                    sentStatus = afDataConfirm->hdr.status;
    243                    sentTransID = afDataConfirm->transID;
    244                    (void)sentEP;
    245                    (void)sentTransID;
    246          
    247                    // Action taken when confirmation is received.
    248                    if ( sentStatus != ZSuccess )
    249                    {
    250                      // The data wasn't delivered -- Do something
    251                      //HalUARTWrite(0, "Lost\r\n", 8);
    252                    }
    253                    else {
    254                      //HalUARTWrite(0, "sent\r\n", 8);
    255                    }
    256                    break;
    257          
    258                  case AF_INCOMING_MSG_CMD:
    259                    GenericApp_MessageMSGCB( MSGpkt );
    260                    break;
    261          
    262                  case ZDO_STATE_CHANGE:
    263                    GenericApp_NwkState = (devStates_t)(MSGpkt->hdr.status);
    264                    if ( (GenericApp_NwkState == DEV_ZB_COORD)
    265                        || (GenericApp_NwkState == DEV_ROUTER)
    266                        || (GenericApp_NwkState == DEV_END_DEVICE) )
    267                    {
    268                      // The coordinator won't send message automatically
    269                      /*osal_start_timerEx( GenericApp_TaskID,
    270                                          GENERICAPP_SEND_MSG_EVT,
    271                                        GENERICAPP_SEND_MSG_TIMEOUT );*/
    272                    }
    273                    break;
    274                  default:
    275                    break;
    276                }
    277          
    278                // Release the memory
    279                osal_msg_deallocate( (uint8 *)MSGpkt );
   \                     ??GenericApp_ProcessEvent_4:
   \   00001D                ; Setup parameters for call to function osal_msg_deallocate
   \   00001D   EE           MOV     A,R6
   \   00001E   FA           MOV     R2,A
   \   00001F   EF           MOV     A,R7
   \   000020   FB           MOV     R3,A
   \   000021   12....       LCALL   ??osal_msg_deallocate?relay
    280          
    281                // Next
    282                MSGpkt = (afIncomingMSGPacket_t *)osal_msg_receive( GenericApp_TaskID );
   \   000024                ; Setup parameters for call to function osal_msg_receive
   \                     ??GenericApp_ProcessEvent_2:
   \   000024   90....       MOV     DPTR,#GenericApp_TaskID
   \   000027   E0           MOVX    A,@DPTR
   \   000028   F9           MOV     R1,A
   \   000029   12....       LCALL   ??osal_msg_receive?relay
   \   00002C   8A..         MOV     ?V0 + 2,R2
   \   00002E   8B..         MOV     ?V0 + 3,R3
   \   000030   AE..         MOV     R6,?V0 + 2
   \   000032   AF..         MOV     R7,?V0 + 3
   \   000034   EE           MOV     A,R6
   \   000035   7001         JNZ     ??GenericApp_ProcessEvent_5
   \   000037   EF           MOV     A,R7
   \                     ??GenericApp_ProcessEvent_5:
   \   000038   602D         JZ      ??GenericApp_ProcessEvent_6
   \   00003A   8E82         MOV     DPL,R6
   \   00003C   8F83         MOV     DPH,R7
   \   00003E   E0           MOVX    A,@DPTR
   \   00003F   12....       LCALL   ?UC_SWITCH_SPARSE
   \                     `?<Jumptable for GenericApp_ProcessEvent>_0`:
   \   000042   00           DB        0
   \   000043   04           DB        4
   \   000044   1A           DB        26
   \   000045   ....         DW        ??GenericApp_ProcessEvent_7
   \   000047   D1           DB        209
   \   000048   ....         DW        ??GenericApp_ProcessEvent_8
   \   00004A   D3           DB        211
   \   00004B   ....         DW        ??GenericApp_ProcessEvent_3
   \   00004D   FD           DB        253
   \   00004E   ....         DW        ??GenericApp_ProcessEvent_4
   \   000050   ....         DW        ??GenericApp_ProcessEvent_4
   \                     ??GenericApp_ProcessEvent_7:
   \   000052                ; Setup parameters for call to function GenericApp_MessageMSGCB
   \   000052   EE           MOV     A,R6
   \   000053   FA           MOV     R2,A
   \   000054   EF           MOV     A,R7
   \   000055   FB           MOV     R3,A
   \   000056   12....       LCALL   ??GenericApp_MessageMSGCB?relay
   \   000059   80C2         SJMP    ??GenericApp_ProcessEvent_4
   \                     ??GenericApp_ProcessEvent_8:
   \   00005B   8E82         MOV     DPL,R6
   \   00005D   8F83         MOV     DPH,R7
   \   00005F   A3           INC     DPTR
   \   000060   E0           MOVX    A,@DPTR
   \   000061   90....       MOV     DPTR,#GenericApp_NwkState
   \   000064   F0           MOVX    @DPTR,A
   \   000065   80B6         SJMP    ??GenericApp_ProcessEvent_4
    283              }
    284          
    285              // return unprocessed events
    286              return (events ^ SYS_EVENT_MSG);
   \                     ??GenericApp_ProcessEvent_6:
   \   000067   AA..         MOV     R2,?V0 + 0
   \   000069   7480         MOV     A,#-0x80
   \   00006B   65..         XRL     A,?V0 + 1
   \   00006D   FB           MOV     R3,A
   \   00006E   8017         SJMP    ??GenericApp_ProcessEvent_9
    287            }
    288          
    289            // Send a message out - This event is generated by a timer
    290            //  (setup in GenericApp_Init()).
    291            if ( events & GENERICAPP_SEND_MSG_EVT )
   \                     ??GenericApp_ProcessEvent_1:
   \   000070   EA           MOV     A,R2
   \   000071   A2E0         MOV     C,0xE0 /* A   */.0
   \   000073   5007         JNC     ??GenericApp_ProcessEvent_10
    292            {
    293              // Send "the" message
    294              //GenericApp_SendTheMessage();
    295              // return unprocessed events
    296              return (events ^ GENERICAPP_SEND_MSG_EVT);
   \   000075   7401         MOV     A,#0x1
   \   000077   65..         XRL     A,?V0 + 0
   \   000079   FA           MOV     R2,A
   \   00007A   800B         SJMP    ??GenericApp_ProcessEvent_9
    297            }
    298            
    299            if (events & GENERICAPP_UART_RX_EVT) {
   \                     ??GenericApp_ProcessEvent_10:
   \   00007C   5402         ANL     A,#0x2
   \   00007E   6003         JZ      ??GenericApp_ProcessEvent_11
    300              //HalUARTWrite(0, "RX_EVT", 7);
    301              GenericApp_SerialMSGCB();
   \   000080                ; Setup parameters for call to function GenericApp_SerialMSGCB
   \   000080   12....       LCALL   ??GenericApp_SerialMSGCB?relay
    302            }
    303          
    304            // Discard unknown events
    305            return 0;
   \                     ??GenericApp_ProcessEvent_11:
   \   000083   7A00         MOV     R2,#0x0
   \   000085   7B00         MOV     R3,#0x0
   \                     ??GenericApp_ProcessEvent_9:
   \   000087                REQUIRE ?Subroutine0
   \   000087                ; // Fall through to label ?Subroutine0
    306          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine0:
   \   000000   7F04         MOV     R7,#0x4
   \   000002   02....       LJMP    ?BANKED_LEAVE_XDATA
    307          
    308          /*********************************************************************
    309           * Event Generation Functions
    310           */
    311           
    312          /*********************************************************************
    313           * @fn      GenericApp_ProcessZDOMsgs()
    314           * @brief   Process response messages
    315           * @param   none
    316           * @return  none
    317           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    318          void GenericApp_ProcessZDOMsgs( zdoIncomingMsg_t *inMsg )
   \                     GenericApp_ProcessZDOMsgs:
    319          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
    320            switch ( inMsg->clusterID )
   \   000005   EA           MOV     A,R2
   \   000006   240C         ADD     A,#0xc
   \   000008   F582         MOV     DPL,A
   \   00000A   EB           MOV     A,R3
   \   00000B   3400         ADDC    A,#0x0
   \   00000D   F583         MOV     DPH,A
   \   00000F   E0           MOVX    A,@DPTR
   \   000010   6406         XRL     A,#0x6
   \   000012   7004         JNZ     ??GenericApp_ProcessZDOMsgs_0
   \   000014   A3           INC     DPTR
   \   000015   E0           MOVX    A,@DPTR
   \   000016   6480         XRL     A,#0x80
   \                     ??GenericApp_ProcessZDOMsgs_0:
   \   000018   7051         JNZ     ??GenericApp_ProcessZDOMsgs_1
    321            {
    322              case Match_Desc_rsp:
    323                {
    324                  ZDO_ActiveEndpointRsp_t *pRsp = ZDO_ParseEPListRsp( inMsg );
   \   00001A                ; Setup parameters for call to function ZDO_ParseEPListRsp
   \   00001A   12....       LCALL   ??ZDO_ParseEPListRsp?relay
   \   00001D   8A..         MOV     ?V0 + 0,R2
   \   00001F   8B..         MOV     ?V0 + 1,R3
   \   000021   AE..         MOV     R6,?V0 + 0
   \   000023   AF..         MOV     R7,?V0 + 1
    325                  if ( pRsp )
   \   000025   EE           MOV     A,R6
   \   000026   7001         JNZ     ??GenericApp_ProcessZDOMsgs_2
   \   000028   EF           MOV     A,R7
   \                     ??GenericApp_ProcessZDOMsgs_2:
   \   000029   6040         JZ      ??GenericApp_ProcessZDOMsgs_1
    326                  {
    327                    if ( pRsp->status == ZSuccess && pRsp->cnt )
   \   00002B   8E82         MOV     DPL,R6
   \   00002D   8F83         MOV     DPH,R7
   \   00002F   E0           MOVX    A,@DPTR
   \   000030   7032         JNZ     ??GenericApp_ProcessZDOMsgs_3
   \   000032   A3           INC     DPTR
   \   000033   A3           INC     DPTR
   \   000034   A3           INC     DPTR
   \   000035   E0           MOVX    A,@DPTR
   \   000036   602C         JZ      ??GenericApp_ProcessZDOMsgs_3
    328                    {
    329                      GenericApp_DstAddr.addrMode = (afAddrMode_t)Addr16Bit;
   \   000038   7402         MOV     A,#0x2
   \   00003A   90....       MOV     DPTR,#(GenericApp_DstAddr + 8)
   \   00003D   F0           MOVX    @DPTR,A
    330                      GenericApp_DstAddr.addr.shortAddr = pRsp->nwkAddr;
   \   00003E   8E82         MOV     DPL,R6
   \   000040   8F83         MOV     DPH,R7
   \   000042   A3           INC     DPTR
   \   000043   E0           MOVX    A,@DPTR
   \   000044   F8           MOV     R0,A
   \   000045   A3           INC     DPTR
   \   000046   E0           MOVX    A,@DPTR
   \   000047   F9           MOV     R1,A
   \   000048   90....       MOV     DPTR,#GenericApp_DstAddr
   \   00004B   E8           MOV     A,R0
   \   00004C   F0           MOVX    @DPTR,A
   \   00004D   A3           INC     DPTR
   \   00004E   E9           MOV     A,R1
   \   00004F   F0           MOVX    @DPTR,A
    331                      // Take the first endpoint, Can be changed to search through endpoints
    332                      GenericApp_DstAddr.endPoint = pRsp->epList[0];
   \   000050   8E82         MOV     DPL,R6
   \   000052   8F83         MOV     DPH,R7
   \   000054   A3           INC     DPTR
   \   000055   A3           INC     DPTR
   \   000056   A3           INC     DPTR
   \   000057   A3           INC     DPTR
   \   000058   E0           MOVX    A,@DPTR
   \   000059   90....       MOV     DPTR,#(GenericApp_DstAddr + 9)
   \   00005C   F0           MOVX    @DPTR,A
    333                      // Light LED
    334                      HalLedSet( HAL_LED_4, HAL_LED_MODE_ON );
   \   00005D                ; Setup parameters for call to function HalLedSet
   \   00005D   7A01         MOV     R2,#0x1
   \   00005F   7908         MOV     R1,#0x8
   \   000061   12....       LCALL   ??HalLedSet?relay
    335                    }
    336                    osal_mem_free( pRsp );
   \                     ??GenericApp_ProcessZDOMsgs_3:
   \   000064                ; Setup parameters for call to function osal_mem_free
   \   000064   EE           MOV     A,R6
   \   000065   FA           MOV     R2,A
   \   000066   EF           MOV     A,R7
   \   000067   FB           MOV     R3,A
   \   000068   12....       LCALL   ??osal_mem_free?relay
    337                  }
    338                }
    339                break;
    340            }
    341          }
   \                     ??GenericApp_ProcessZDOMsgs_1:
   \   00006B   7F02         MOV     R7,#0x2
   \   00006D   02....       LJMP    ?BANKED_LEAVE_XDATA
    342          
    343          
    344          /*********************************************************************
    345           * LOCAL FUNCTIONS
    346           */
    347          
    348          /*********************************************************************
    349           * @fn      GenericApp_MessageMSGCB
    350           * @brief   Data message processor callback.  This function processes
    351           *          any incoming data - probably from other devices.  So, based
    352           *          on cluster ID, perform the intended action.
    353           * @param   none
    354           * @return  none
    355           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    356          void GenericApp_MessageMSGCB( afIncomingMSGPacket_t *pkt )
   \                     GenericApp_MessageMSGCB:
    357          {
   \   000000   74F1         MOV     A,#-0xf
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 15
   \   000005                ; Auto size: 14
   \   000005   74F2         MOV     A,#-0xe
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   EA           MOV     A,R2
   \   00000B   FE           MOV     R6,A
   \   00000C   EB           MOV     A,R3
   \   00000D   FF           MOV     R7,A
    358            unsigned char temp_extAddr[8];
    359            unsigned char i = 0;
    360            unsigned char existed = 0;
    361            unsigned char buffer[6] = "";
   \   00000E   85..82       MOV     DPL,?XSP + 0
   \   000011   85..83       MOV     DPH,?XSP + 1
   \   000014   AC82         MOV     R4,DPL
   \   000016   AD83         MOV     R5,DPH
   \   000018   7583..       MOV     DPH,#((`?<Constant "">` >> 8) & 0xff)
   \   00001B   7582..       MOV     DPL,#(`?<Constant "">` & 0xff)
   \   00001E   7406         MOV     A,#0x6
   \   000020   12....       LCALL   ?MOVE_LONG8_XDATA_XDATA
    362            switch ( pkt->clusterId )
   \   000023   8E82         MOV     DPL,R6
   \   000025   8F83         MOV     DPH,R7
   \   000027   A3           INC     DPTR
   \   000028   A3           INC     DPTR
   \   000029   A3           INC     DPTR
   \   00002A   A3           INC     DPTR
   \   00002B   E0           MOVX    A,@DPTR
   \   00002C   6401         XRL     A,#0x1
   \   00002E   7002         JNZ     ??GenericApp_MessageMSGCB_0
   \   000030   A3           INC     DPTR
   \   000031   E0           MOVX    A,@DPTR
   \                     ??GenericApp_MessageMSGCB_0:
   \   000032   6003         JZ      $+5
   \   000034   02....       LJMP    ??GenericApp_MessageMSGCB_1 & 0xFFFF
    363            {
    364              case GENERICAPP_CLUSTERID:
    365                {// "the" message
    366                  (void)APSME_LookupExtAddr(pkt->srcAddr.addr.shortAddr, temp_extAddr);
   \   000037                ; Setup parameters for call to function APSME_LookupExtAddr
   \   000037   7406         MOV     A,#0x6
   \   000039   12....       LCALL   ?XSTACK_DISP0_8
   \   00003C   AC82         MOV     R4,DPL
   \   00003E   AD83         MOV     R5,DPH
   \   000040   8E82         MOV     DPL,R6
   \   000042   8F83         MOV     DPH,R7
   \   000044   A3           INC     DPTR
   \   000045   A3           INC     DPTR
   \   000046   A3           INC     DPTR
   \   000047   A3           INC     DPTR
   \   000048   A3           INC     DPTR
   \   000049   A3           INC     DPTR
   \   00004A   E0           MOVX    A,@DPTR
   \   00004B   FA           MOV     R2,A
   \   00004C   A3           INC     DPTR
   \   00004D   E0           MOVX    A,@DPTR
   \   00004E   FB           MOV     R3,A
   \   00004F   12....       LCALL   ??APSME_LookupExtAddr?relay
    367                  for (i = 0; i < device_count+1; i++) {  // to see whether the device ever connected
   \   000052   75..00       MOV     ?V0 + 0,#0x0
   \   000055   803A         SJMP    ??GenericApp_MessageMSGCB_2
    368                    if (osal_memcmp(EndDeviceInfos[i].extAddr, temp_extAddr, 8)) { //if existed, break;
   \                     ??GenericApp_MessageMSGCB_3:
   \   000057                ; Setup parameters for call to function osal_memcmp
   \   000057   12....       LCALL   ?XSTACK_DISP0_8
   \   00005A   A982         MOV     R1,DPL
   \   00005C   AA83         MOV     R2,DPH
   \   00005E   89..         MOV     ?V0 + 4,R1
   \   000060   8A..         MOV     ?V0 + 5,R2
   \   000062   75..00       MOV     ?V0 + 6,#0x0
   \   000065   78..         MOV     R0,#?V0 + 4
   \   000067   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   00006A   7C08         MOV     R4,#0x8
   \   00006C   7D00         MOV     R5,#0x0
   \   00006E   E5..         MOV     A,?V0 + 0
   \   000070   75F00A       MOV     B,#0xa
   \   000073   A4           MUL     AB
   \   000074   24..         ADD     A,#((EndDeviceInfos + 1) & 0xff)
   \   000076   F5..         MOV     ?V0 + 2,A
   \   000078   E5F0         MOV     A,B
   \   00007A   34..         ADDC    A,#(((EndDeviceInfos + 1) >> 8) & 0xff)
   \   00007C   A9..         MOV     R1,?V0 + 2
   \   00007E   FA           MOV     R2,A
   \   00007F   7B00         MOV     R3,#0x0
   \   000081   12....       LCALL   ??osal_memcmp?relay
   \   000084   7403         MOV     A,#0x3
   \   000086   12....       LCALL   ?DEALLOC_XSTACK8
   \   000089   E9           MOV     A,R1
   \   00008A   6003         JZ      $+5
   \   00008C   02....       LJMP    ??GenericApp_MessageMSGCB_4 & 0xFFFF
    369                      existed = 1;
    370                      //HalUARTWrite(0, "Existed!\r\n",12);
    371                      break;
    372                    }
    373                  }
   \   00008F   05..         INC     ?V0 + 0
   \                     ??GenericApp_MessageMSGCB_2:
   \   000091   85....       MOV     ?V0 + 2,?V0 + 0
   \   000094   90....       MOV     DPTR,#device_count
   \   000097   E0           MOVX    A,@DPTR
   \   000098   F8           MOV     R0,A
   \   000099   7401         MOV     A,#0x1
   \   00009B   28           ADD     A,R0
   \   00009C   08           INC     R0
   \   00009D   E4           CLR     A
   \   00009E   3400         ADDC    A,#0x0
   \   0000A0   F9           MOV     R1,A
   \   0000A1   E5..         MOV     A,?V0 + 2
   \   0000A3   98           SUBB    A,R0
   \   0000A4   E4           CLR     A
   \   0000A5   99           SUBB    A,R1
   \   0000A6   C3           CLR     C
   \   0000A7   65D0         XRL     A,PSW
   \   0000A9   33           RLC     A
   \   0000AA   7406         MOV     A,#0x6
   \   0000AC   40A9         JC      ??GenericApp_MessageMSGCB_3
    374                  if (!existed) {  //not connected before, register
    375                    //HalUARTWrite(0, "New Device!\r\n",15);
    376                    osal_memcpy(EndDeviceInfos[device_count].extAddr, temp_extAddr, 8);
   \   0000AE                ; Setup parameters for call to function osal_memcpy
   \   0000AE   12....       LCALL   ?XSTACK_DISP0_8
   \   0000B1   A982         MOV     R1,DPL
   \   0000B3   AA83         MOV     R2,DPH
   \   0000B5   89..         MOV     ?V0 + 0,R1
   \   0000B7   8A..         MOV     ?V0 + 1,R2
   \   0000B9   75..00       MOV     ?V0 + 2,#0x0
   \   0000BC   78..         MOV     R0,#?V0 + 0
   \   0000BE   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   0000C1   7C08         MOV     R4,#0x8
   \   0000C3   7D00         MOV     R5,#0x0
   \   0000C5   90....       MOV     DPTR,#device_count
   \   0000C8   E0           MOVX    A,@DPTR
   \   0000C9   75F00A       MOV     B,#0xa
   \   0000CC   A4           MUL     AB
   \   0000CD   24..         ADD     A,#((EndDeviceInfos + 1) & 0xff)
   \   0000CF   FA           MOV     R2,A
   \   0000D0   E5F0         MOV     A,B
   \   0000D2   34..         ADDC    A,#(((EndDeviceInfos + 1) >> 8) & 0xff)
   \   0000D4   FB           MOV     R3,A
   \   0000D5   12....       LCALL   ??osal_memcpy?relay
   \   0000D8   7403         MOV     A,#0x3
   \   0000DA   12....       LCALL   ?DEALLOC_XSTACK8
    377                    EndDeviceInfos[device_count].endPoint = pkt->srcAddr.endPoint;
   \   0000DD   EE           MOV     A,R6
   \   0000DE   240F         ADD     A,#0xf
   \   0000E0   F582         MOV     DPL,A
   \   0000E2   EF           MOV     A,R7
   \   0000E3   3400         ADDC    A,#0x0
   \   0000E5   F583         MOV     DPH,A
   \   0000E7   E0           MOVX    A,@DPTR
   \   0000E8   FB           MOV     R3,A
   \   0000E9   90....       MOV     DPTR,#device_count
   \   0000EC   E0           MOVX    A,@DPTR
   \   0000ED   75F00A       MOV     B,#0xa
   \   0000F0   A4           MUL     AB
   \   0000F1   24..         ADD     A,#(EndDeviceInfos & 0xff)
   \   0000F3   F582         MOV     DPL,A
   \   0000F5   E5F0         MOV     A,B
   \   0000F7   34..         ADDC    A,#((EndDeviceInfos >> 8) & 0xff)
   \   0000F9   F583         MOV     DPH,A
   \   0000FB   EB           MOV     A,R3
   \   0000FC   F0           MOVX    @DPTR,A
    378                    EndDeviceInfos[device_count].compressed_addr = GENERICAPP_ENDPOINT | EndDeviceInfos[device_count].endPoint;
   \   0000FD   7420         MOV     A,#0x20
   \   0000FF   4B           ORL     A,R3
   \   000100   A3           INC     DPTR
   \   000101   A3           INC     DPTR
   \   000102   A3           INC     DPTR
   \   000103   A3           INC     DPTR
   \   000104   A3           INC     DPTR
   \   000105   A3           INC     DPTR
   \   000106   A3           INC     DPTR
   \   000107   A3           INC     DPTR
   \   000108   A3           INC     DPTR
   \   000109   F0           MOVX    @DPTR,A
    379                    device_count++;
   \   00010A   90....       MOV     DPTR,#device_count
   \   00010D   E0           MOVX    A,@DPTR
   \   00010E   04           INC     A
   \   00010F   F0           MOVX    @DPTR,A
    380                  }
    381                  if (device_count == 16) { device_count = 0;}  //in case to overflow
   \                     ??GenericApp_MessageMSGCB_4:
   \   000110   90....       MOV     DPTR,#device_count
   \   000113   E0           MOVX    A,@DPTR
   \   000114   6410         XRL     A,#0x10
   \   000116   7002         JNZ     ??GenericApp_MessageMSGCB_5
   \   000118   E4           CLR     A
   \   000119   F0           MOVX    @DPTR,A
    382                  //TO DO: process data received, send it to slave machine
    383                  osal_memcpy(&buffer[0], pkt->cmd.Data, 6);
   \                     ??GenericApp_MessageMSGCB_5:
   \   00011A                ; Setup parameters for call to function osal_memcpy
   \   00011A   EE           MOV     A,R6
   \   00011B   2421         ADD     A,#0x21
   \   00011D   F582         MOV     DPL,A
   \   00011F   EF           MOV     A,R7
   \   000120   3400         ADDC    A,#0x0
   \   000122   F583         MOV     DPH,A
   \   000124   E0           MOVX    A,@DPTR
   \   000125   F5..         MOV     ?V0 + 0,A
   \   000127   A3           INC     DPTR
   \   000128   E0           MOVX    A,@DPTR
   \   000129   F5..         MOV     ?V0 + 1,A
   \   00012B   75..00       MOV     ?V0 + 2,#0x0
   \   00012E   78..         MOV     R0,#?V0 + 0
   \   000130   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   000133   7C06         MOV     R4,#0x6
   \   000135   7D00         MOV     R5,#0x0
   \   000137   7403         MOV     A,#0x3
   \   000139   12....       LCALL   ?XSTACK_DISP0_8
   \   00013C   AA82         MOV     R2,DPL
   \   00013E   AB83         MOV     R3,DPH
   \   000140   12....       LCALL   ??osal_memcpy?relay
   \   000143   7403         MOV     A,#0x3
   \   000145   12....       LCALL   ?DEALLOC_XSTACK8
    384                  str_reverse((char*)&buffer[3], 1);
   \   000148                ; Setup parameters for call to function str_reverse
   \   000148   7C01         MOV     R4,#0x1
   \   00014A   7D00         MOV     R5,#0x0
   \   00014C   7403         MOV     A,#0x3
   \   00014E   12....       LCALL   ?XSTACK_DISP0_8
   \   000151   AA82         MOV     R2,DPL
   \   000153   AB83         MOV     R3,DPH
   \   000155   12....       LCALL   ??str_reverse?relay
    385                  //HalUARTWrite(0, pkt->cmd.Data, 5);//osal_strlen(pkt->cmd.Data)
    386                  HalUARTWrite(0, &buffer[0], 6);
   \   000158                ; Setup parameters for call to function HalUARTWrite
   \   000158   7C06         MOV     R4,#0x6
   \   00015A   7D00         MOV     R5,#0x0
   \   00015C   85..82       MOV     DPL,?XSP + 0
   \   00015F   85..83       MOV     DPH,?XSP + 1
   \   000162   AA82         MOV     R2,DPL
   \   000164   AB83         MOV     R3,DPH
   \   000166   7900         MOV     R1,#0x0
   \   000168   12....       LCALL   ??HalUARTWrite?relay
    387                  break;
    388                }
    389            }
    390          }
   \                     ??GenericApp_MessageMSGCB_1:
   \   00016B   740E         MOV     A,#0xe
   \   00016D   12....       LCALL   ?DEALLOC_XSTACK8
   \   000170   7F07         MOV     R7,#0x7
   \   000172   02....       LJMP    ?BANKED_LEAVE_XDATA
    391          
    392          /*********************************************************************
    393           * @fn      GenericApp_SendTheMessage
    394           * @brief   Send "the" message.
    395           * @param   none
    396           * @return  none
    397           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    398          void GenericApp_SendTheMessage( unsigned char dest_endID, unsigned char cmd, unsigned int data)
   \                     GenericApp_SendTheMessage:
    399          {
   \   000000   74F5         MOV     A,#-0xb
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 11
   \   000005                ; Auto size: 6
   \   000005   74FA         MOV     A,#-0x6
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   E9           MOV     A,R1
   \   00000B   FE           MOV     R6,A
   \   00000C   EA           MOV     A,R2
   \   00000D   FF           MOV     R7,A
   \   00000E   EC           MOV     A,R4
   \   00000F   F8           MOV     R0,A
   \   000010   ED           MOV     A,R5
   \   000011   F9           MOV     R1,A
    400            unsigned char theMessageData[6] = "";
   \   000012   85..82       MOV     DPL,?XSP + 0
   \   000015   85..83       MOV     DPH,?XSP + 1
   \   000018   AC82         MOV     R4,DPL
   \   00001A   AD83         MOV     R5,DPH
   \   00001C   7583..       MOV     DPH,#((`?<Constant "">_1` >> 8) & 0xff)
   \   00001F   7582..       MOV     DPL,#(`?<Constant "">_1` & 0xff)
   \   000022   7406         MOV     A,#0x6
   \   000024   12....       LCALL   ?MOVE_LONG8_XDATA_XDATA
    401            theMessageData[0] = 0xCC;  //beginning check byte
   \   000027   74CC         MOV     A,#-0x34
   \   000029   85..82       MOV     DPL,?XSP + 0
   \   00002C   85..83       MOV     DPH,?XSP + 1
   \   00002F   F0           MOVX    @DPTR,A
    402            theMessageData[1] = EndDeviceInfos[dest_endID].compressed_addr;
   \   000030   EE           MOV     A,R6
   \   000031   75F00A       MOV     B,#0xa
   \   000034   A4           MUL     AB
   \   000035   24..         ADD     A,#(EndDeviceInfos & 0xff)
   \   000037   F5..         MOV     ?V0 + 0,A
   \   000039   E5F0         MOV     A,B
   \   00003B   34..         ADDC    A,#((EndDeviceInfos >> 8) & 0xff)
   \   00003D   F5..         MOV     ?V0 + 1,A
   \   00003F   85..82       MOV     DPL,?V0 + 0
   \   000042   F583         MOV     DPH,A
   \   000044   A3           INC     DPTR
   \   000045   A3           INC     DPTR
   \   000046   A3           INC     DPTR
   \   000047   A3           INC     DPTR
   \   000048   A3           INC     DPTR
   \   000049   A3           INC     DPTR
   \   00004A   A3           INC     DPTR
   \   00004B   A3           INC     DPTR
   \   00004C   A3           INC     DPTR
   \   00004D   E0           MOVX    A,@DPTR
   \   00004E   C0E0         PUSH    A
   \   000050   7401         MOV     A,#0x1
   \   000052   12....       LCALL   ?XSTACK_DISP0_8
   \   000055   D0E0         POP     A
   \   000057   F0           MOVX    @DPTR,A
    403            theMessageData[2] = cmd;
   \   000058   7402         MOV     A,#0x2
   \   00005A   12....       LCALL   ?XSTACK_DISP0_8
   \   00005D   EF           MOV     A,R7
   \   00005E   F0           MOVX    @DPTR,A
    404            osal_buffer_uint16(&theMessageData[3], data);
   \   00005F                ; Setup parameters for call to function osal_buffer_uint16
   \   00005F   E8           MOV     A,R0
   \   000060   FC           MOV     R4,A
   \   000061   E9           MOV     A,R1
   \   000062   FD           MOV     R5,A
   \   000063   7403         MOV     A,#0x3
   \   000065   12....       LCALL   ?XSTACK_DISP0_8
   \   000068   AA82         MOV     R2,DPL
   \   00006A   AB83         MOV     R3,DPH
   \   00006C   12....       LCALL   ??osal_buffer_uint16?relay
    405            theMessageData[5] = 0x33;  //end check byte
   \   00006F   7405         MOV     A,#0x5
   \   000071   12....       LCALL   ?XSTACK_DISP0_8
   \   000074   7433         MOV     A,#0x33
   \   000076   F0           MOVX    @DPTR,A
    406            //set the destination below
    407            GenericApp_DstAddr.addrMode = (afAddrMode_t)Addr64Bit;
   \   000077   7403         MOV     A,#0x3
   \   000079   90....       MOV     DPTR,#(GenericApp_DstAddr + 8)
   \   00007C   F0           MOVX    @DPTR,A
    408            GenericApp_DstAddr.endPoint = EndDeviceInfos[dest_endID].endPoint;
   \   00007D   85..82       MOV     DPL,?V0 + 0
   \   000080   85..83       MOV     DPH,?V0 + 1
   \   000083   E0           MOVX    A,@DPTR
   \   000084   90....       MOV     DPTR,#(GenericApp_DstAddr + 9)
   \   000087   F0           MOVX    @DPTR,A
    409            osal_memcpy(GenericApp_DstAddr.addr.extAddr, EndDeviceInfos[dest_endID].extAddr, 8);
   \   000088                ; Setup parameters for call to function osal_memcpy
   \   000088   85..82       MOV     DPL,?V0 + 0
   \   00008B   85..83       MOV     DPH,?V0 + 1
   \   00008E   A3           INC     DPTR
   \   00008F   A982         MOV     R1,DPL
   \   000091   AA83         MOV     R2,DPH
   \   000093   89..         MOV     ?V0 + 0,R1
   \   000095   8A..         MOV     ?V0 + 1,R2
   \   000097   75..00       MOV     ?V0 + 2,#0x0
   \   00009A   78..         MOV     R0,#?V0 + 0
   \   00009C   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   00009F   7C08         MOV     R4,#0x8
   \   0000A1   7D00         MOV     R5,#0x0
   \   0000A3   7A..         MOV     R2,#(GenericApp_DstAddr & 0xff)
   \   0000A5   7B..         MOV     R3,#((GenericApp_DstAddr >> 8) & 0xff)
   \   0000A7   12....       LCALL   ??osal_memcpy?relay
   \   0000AA   7403         MOV     A,#0x3
   \   0000AC   12....       LCALL   ?DEALLOC_XSTACK8
    410            
    411            if ( AF_DataRequest( &GenericApp_DstAddr, &GenericApp_epDesc,
    412                                 GENERICAPP_CLUSTERID,
    413                                 7,//send one more char or the last char might be missing
    414                                 theMessageData,
    415                                 &GenericApp_TransID,
    416                                 AF_DISCV_ROUTE, AF_DEFAULT_RADIUS ) == afStatus_SUCCESS )                     
   \   0000AF                ; Setup parameters for call to function AF_DataRequest
   \   0000AF   75..1E       MOV     ?V0 + 0,#0x1e
   \   0000B2   78..         MOV     R0,#?V0 + 0
   \   0000B4   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   0000B7   75....       MOV     ?V0 + 0,#(GenericApp_TransID & 0xff)
   \   0000BA   75....       MOV     ?V0 + 1,#((GenericApp_TransID >> 8) & 0xff)
   \   0000BD   78..         MOV     R0,#?V0 + 0
   \   0000BF   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000C2   7403         MOV     A,#0x3
   \   0000C4   12....       LCALL   ?XSTACK_DISP0_8
   \   0000C7   8582..       MOV     ?V0 + 0,DPL
   \   0000CA   8583..       MOV     ?V0 + 1,DPH
   \   0000CD   78..         MOV     R0,#?V0 + 0
   \   0000CF   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000D2   75..07       MOV     ?V0 + 0,#0x7
   \   0000D5   75..00       MOV     ?V0 + 1,#0x0
   \   0000D8   78..         MOV     R0,#?V0 + 0
   \   0000DA   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000DD   75..01       MOV     ?V0 + 0,#0x1
   \   0000E0   78..         MOV     R0,#?V0 + 0
   \   0000E2   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000E5   7920         MOV     R1,#0x20
   \   0000E7   7C..         MOV     R4,#(GenericApp_epDesc & 0xff)
   \   0000E9   7D..         MOV     R5,#((GenericApp_epDesc >> 8) & 0xff)
   \   0000EB   7A..         MOV     R2,#(GenericApp_DstAddr & 0xff)
   \   0000ED   7B..         MOV     R3,#((GenericApp_DstAddr >> 8) & 0xff)
   \   0000EF   12....       LCALL   ??AF_DataRequest?relay
   \   0000F2   7409         MOV     A,#0x9
   \   0000F4   12....       LCALL   ?DEALLOC_XSTACK8
    417            {
    418              // Successfully requested to be sent.
    419              //HalUARTWrite(0, "Sent\r\n", 8);
    420            }
    421            else
    422            {
    423              // Error occurred in request to send.
    424            }
    425          }
   \   0000F7   7406         MOV     A,#0x6
   \   0000F9   12....       LCALL   ?DEALLOC_XSTACK8
   \   0000FC   7F03         MOV     R7,#0x3
   \   0000FE   02....       LJMP    ?BANKED_LEAVE_XDATA
    426          
    427          
    428          //@fn: GenericApp_SerialMSGCB
    429          //@breif: process data received by UART, used to execute cmds from slave machine
    430          //@param: none
    431          //@return: none

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    432          void GenericApp_SerialMSGCB(void)
   \                     GenericApp_SerialMSGCB:
    433          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 7
   \   000005   74F9         MOV     A,#-0x7
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
    434            unsigned char dest_endID = 0; //this number is the index of EndDeviceInfos
    435            unsigned int data = 0;
    436            unsigned char buf [7] = "";
   \   00000A   85..82       MOV     DPL,?XSP + 0
   \   00000D   85..83       MOV     DPH,?XSP + 1
   \   000010   AC82         MOV     R4,DPL
   \   000012   AD83         MOV     R5,DPH
   \   000014   7583..       MOV     DPH,#((`?<Constant "">_2` >> 8) & 0xff)
   \   000017   7582..       MOV     DPL,#(`?<Constant "">_2` & 0xff)
   \   00001A   7407         MOV     A,#0x7
   \   00001C   12....       LCALL   ?MOVE_LONG8_XDATA_XDATA
    437           // printf("UART received!");
    438            HalUARTRead(0, buf, 6);
   \   00001F                ; Setup parameters for call to function HalUARTRead
   \   00001F   7C06         MOV     R4,#0x6
   \   000021   FD           MOV     R5,A
   \   000022   85..82       MOV     DPL,?XSP + 0
   \   000025   85..83       MOV     DPH,?XSP + 1
   \   000028   AA82         MOV     R2,DPL
   \   00002A   AB83         MOV     R3,DPH
   \   00002C   F9           MOV     R1,A
   \   00002D   12....       LCALL   ??HalUARTRead?relay
    439            if ( (buf[1] & GENERICAPP_ENDPOINT) && (buf[0] == 0xCC) && (buf[5] == 0x33)) {  //make sure cmd send to this device
   \   000030   7401         MOV     A,#0x1
   \   000032   12....       LCALL   ?XSTACK_DISP0_8
   \   000035   E0           MOVX    A,@DPTR
   \   000036   A2E5         MOV     C,0xE0 /* A   */.5
   \   000038   5056         JNC     ??GenericApp_SerialMSGCB_0
   \   00003A   85..82       MOV     DPL,?XSP + 0
   \   00003D   85..83       MOV     DPH,?XSP + 1
   \   000040   E0           MOVX    A,@DPTR
   \   000041   64CC         XRL     A,#0xcc
   \   000043   704B         JNZ     ??GenericApp_SerialMSGCB_0
   \   000045   7405         MOV     A,#0x5
   \   000047   12....       LCALL   ?XSTACK_DISP0_8
   \   00004A   E0           MOVX    A,@DPTR
   \   00004B   6433         XRL     A,#0x33
   \   00004D   7041         JNZ     ??GenericApp_SerialMSGCB_0
    440              dest_endID = buf[1] & 0x1F; //get destnation endPoint from uart message
   \   00004F   7401         MOV     A,#0x1
   \   000051   12....       LCALL   ?XSTACK_DISP0_8
   \   000054   E0           MOVX    A,@DPTR
   \   000055   541F         ANL     A,#0x1f
   \   000057   F5..         MOV     ?V0 + 0,A
    441              data = osal_build_uint16(&buf[3]);
   \   000059                ; Setup parameters for call to function osal_build_uint16
   \   000059   7403         MOV     A,#0x3
   \   00005B   12....       LCALL   ?XSTACK_DISP0_8
   \   00005E   AA82         MOV     R2,DPL
   \   000060   AB83         MOV     R3,DPH
   \   000062   12....       LCALL   ??osal_build_uint16?relay
   \   000065   8A..         MOV     ?V0 + 2,R2
   \   000067   8B..         MOV     ?V0 + 3,R3
    442              HalUARTWrite(0, buf, 6);
   \   000069                ; Setup parameters for call to function HalUARTWrite
   \   000069   7C06         MOV     R4,#0x6
   \   00006B   7D00         MOV     R5,#0x0
   \   00006D   85..82       MOV     DPL,?XSP + 0
   \   000070   85..83       MOV     DPH,?XSP + 1
   \   000073   AA82         MOV     R2,DPL
   \   000075   AB83         MOV     R3,DPH
   \   000077   7900         MOV     R1,#0x0
   \   000079   12....       LCALL   ??HalUARTWrite?relay
    443              if (buf[2]&0x80) {  //cmd for coordinator
   \   00007C   7402         MOV     A,#0x2
   \   00007E   12....       LCALL   ?XSTACK_DISP0_8
   \   000081   E0           MOVX    A,@DPTR
   \   000082   A2E7         MOV     C,0xE0 /* A   */.7
   \   000084   400A         JC      ??GenericApp_SerialMSGCB_0
    444                switch (buf[2]) {
    445                  //add cmds here, e.g. case: 0x81...
    446                  default:
    447                  break;
    448                }
    449              } else { //cmd for end device, send it
    450                GenericApp_SendTheMessage(dest_endID, buf[2], data);
   \   000086                ; Setup parameters for call to function GenericApp_SendTheMessage
   \   000086   AC..         MOV     R4,?V0 + 2
   \   000088   AD..         MOV     R5,?V0 + 3
   \   00008A   FA           MOV     R2,A
   \   00008B   A9..         MOV     R1,?V0 + 0
   \   00008D   12....       LCALL   ??GenericApp_SendTheMessage?relay
    451              }
    452            }
    453          }
   \                     ??GenericApp_SerialMSGCB_0:
   \   000090   7407         MOV     A,#0x7
   \   000092   12....       LCALL   ?DEALLOC_XSTACK8
   \   000095   02....       LJMP    ?Subroutine0 & 0xFFFF
    454          
    455          //@fn rt_str_reverse
    456          //@brief message received is reversed, so we need to reverse again using this function
    457          //@para *str the first byte in a string that needs reversed
    458          //@para length the total length that needs to be reversed, 0 included
    459          //e.g a[] = {1,2,3,4}, then rt_str_reverse(&a[0], 3) result in {4, 3, 2, 1}

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    460          void str_reverse(char *str, int length) {
   \                     str_reverse:
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    461            char temp, *end_ptr;
    462            end_ptr = str + length;
   \   000004   EA           MOV     A,R2
   \   000005   2C           ADD     A,R4
   \   000006   F8           MOV     R0,A
   \   000007   EB           MOV     A,R3
   \   000008   3D           ADDC    A,R5
   \   000009   8026         SJMP    ??str_reverse_0
    463            while(end_ptr>str) {
    464              temp = *str;
   \                     ??str_reverse_1:
   \   00000B   8A82         MOV     DPL,R2
   \   00000D   8B83         MOV     DPH,R3
   \   00000F   E0           MOVX    A,@DPTR
   \   000010   FC           MOV     R4,A
    465              *str = *end_ptr;
   \   000011   8882         MOV     DPL,R0
   \   000013   8983         MOV     DPH,R1
   \   000015   E0           MOVX    A,@DPTR
   \   000016   8A82         MOV     DPL,R2
   \   000018   8B83         MOV     DPH,R3
   \   00001A   F0           MOVX    @DPTR,A
    466              *end_ptr = temp;
   \   00001B   EC           MOV     A,R4
   \   00001C   8882         MOV     DPL,R0
   \   00001E   8983         MOV     DPH,R1
   \   000020   F0           MOVX    @DPTR,A
    467              str++;
   \   000021   8A82         MOV     DPL,R2
   \   000023   8B83         MOV     DPH,R3
   \   000025   A3           INC     DPTR
   \   000026   AA82         MOV     R2,DPL
   \   000028   AB83         MOV     R3,DPH
    468              end_ptr--;
   \   00002A   E8           MOV     A,R0
   \   00002B   24FF         ADD     A,#-0x1
   \   00002D   18           DEC     R0
   \   00002E   E9           MOV     A,R1
   \   00002F   34FF         ADDC    A,#-0x1
   \                     ??str_reverse_0:
   \   000031   F9           MOV     R1,A
    469            }
   \   000032   C3           CLR     C
   \   000033   EA           MOV     A,R2
   \   000034   98           SUBB    A,R0
   \   000035   EB           MOV     A,R3
   \   000036   99           SUBB    A,R1
   \   000037   40D2         JC      ??str_reverse_1
    470          }
   \   000039   D083         POP     DPH
   \   00003B   D082         POP     DPL
   \   00003D   02....       LJMP    ?BRET

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??GenericApp_Init?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    GenericApp_Init

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??GenericApp_ProcessEvent?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    GenericApp_ProcessEvent

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??GenericApp_ProcessZDOMsgs?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    GenericApp_ProcessZDOMsgs

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??GenericApp_MessageMSGCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    GenericApp_MessageMSGCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??GenericApp_SendTheMessage?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    GenericApp_SendTheMessage

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??GenericApp_SerialMSGCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    GenericApp_SerialMSGCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??str_reverse?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    str_reverse

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "">`:
   \   000000   00           DB ""
   \   000001   00000000     DB 0, 0, 0, 0, 0
   \            00      

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "">_1`:
   \   000000   00           DB ""
   \   000001   00000000     DB 0, 0, 0, 0, 0
   \            00      

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "">_2`:
   \   000000   00           DB ""
   \   000001   00000000     DB 0, 0, 0, 0, 0, 0
   \            0000    
    471          
    472          /*********************************************************************
    473          *********************************************************************/

   Maximum stack usage in bytes:

     Function                       ISTACK PSTACK XSTACK
     --------                       ------ ------ ------
     GenericApp_Init                    1      0     38
       -> HalUARTOpen                   0      0     76
       -> afRegister                    0      0     76
       -> RegisterForKeys               0      0     76
     GenericApp_MessageMSGCB            2      0     44
       -> APSME_LookupExtAddr           0      0     58
       -> osal_memcmp                   0      0     64
       -> osal_memcpy                   0      0     64
       -> osal_memcpy                   0      0     64
       -> str_reverse                   0      0     58
       -> HalUARTWrite                  0      0     58
     GenericApp_ProcessEvent            0      0     12
       -> osal_msg_receive              0      0     24
       -> GenericApp_ProcessZDOMsgs     0      0     24
       -> osal_msg_deallocate           0      0     24
       -> osal_msg_receive              0      0     24
       -> GenericApp_MessageMSGCB       0      0     24
       -> GenericApp_SerialMSGCB        0      0     24
     GenericApp_ProcessZDOMsgs          0      0     22
       -> ZDO_ParseEPListRsp            0      0     20
       -> HalLedSet                     0      0     20
       -> osal_mem_free                 0      0     20
     GenericApp_SendTheMessage          2      0     45
       -> osal_buffer_uint16            0      0     34
       -> osal_memcpy                   0      0     40
       -> AF_DataRequest                0      0     52
     GenericApp_SerialMSGCB             2      0     31
       -> HalUARTRead                   0      0     38
       -> osal_build_uint16             0      0     38
       -> HalUARTWrite                  0      0     38
       -> GenericApp_SendTheMessage     0      0     38
     str_reverse                        3      0     29


   Segment part sizes:

     Function/Label                    Bytes
     --------------                    -----
     device_count                         1
     GenericApp_ClusterList               2
     GenericApp_SimpleDesc               12
     GenericApp_epDesc                    6
     EndDeviceInfos                     160
     GenericApp_TaskID                    1
     GenericApp_NwkState                  1
     GenericApp_TransID                   1
     GenericApp_DstAddr                  12
     GenericApp_Init                    139
     GenericApp_ProcessEvent            135
     ?Subroutine0                         5
     GenericApp_ProcessZDOMsgs          112
     GenericApp_MessageMSGCB            373
     GenericApp_SendTheMessage          257
     GenericApp_SerialMSGCB             152
     str_reverse                         64
     ??GenericApp_Init?relay              6
     ??GenericApp_ProcessEvent?relay      6
     ??GenericApp_ProcessZDOMsgs?relay    6
     ??GenericApp_MessageMSGCB?relay      6
     ??GenericApp_SendTheMessage?relay    6
     ??GenericApp_SerialMSGCB?relay       6
     ??str_reverse?relay                  6
     ?<Constant "">                       6
     ?<Constant "">_1                     6
     ?<Constant "">_2                     7

 
 1 237 bytes in segment BANKED_CODE
    42 bytes in segment BANK_RELAYS
    33 bytes in segment XDATA_ROM_C
   182 bytes in segment XDATA_Z
 
 1 279 bytes of CODE  memory
    33 bytes of CONST memory
   182 bytes of XDATA memory

Errors: none
Warnings: none
