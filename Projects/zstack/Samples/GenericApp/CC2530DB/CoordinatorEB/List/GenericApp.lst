###############################################################################
#                                                                             #
# IAR C/C++ Compiler V7.60.1.40026 for 8051             08/Apr/2014  22:40:39 #
# Copyright (C) 2004-2010 IAR Systems AB.                                     #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data_rom                                           #
#    Dptr setup         =  1,16                                               #
#    Source file        =  D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\Source\GenericApp.c  #
#    Command line       =  -f D:\zigbee\projects\zstack-cc2530-coordinator\Pr #
#                          ojects\zstack\Samples\GenericApp\CC2530DB\..\..\.. #
#                          \Tools\CC2530DB\f8wCoord.cfg (-DCPU32MHZ           #
#                          -DROOT=__near_func -DMAC_CFG_APP_PENDING_QUEUE=TRU #
#                          E -DMAC_CFG_TX_DATA_MAX=5 -DMAC_CFG_TX_MAX=8       #
#                          -DMAC_CFG_RX_MAX=5 -DZDO_COORDINATOR -DRTR_NWK)    #
#                          -f D:\zigbee\projects\zstack-cc2530-coordinator\Pr #
#                          ojects\zstack\Samples\GenericApp\CC2530DB\..\..\.. #
#                          \Tools\CC2530DB\f8wConfig.cfg (-DZIGBEEPRO         #
#                          -DSECURE=0 -DZG_SECURE_DYNAMIC=0 -DREFLECTOR       #
#                          -DDEFAULT_CHANLIST=0x00000800                      #
#                          -DZDAPP_CONFIG_PAN_ID=0x1111                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DLINK_STATUS_JITTER_MASK=0x007F                   #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3    #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40           #
#                          -DNWK_MAX_BINDING_ENTRIES=4                        #
#                          -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DMAC_MAX_FRAME_SIZE=116                           #
#                          -DZDNWKMGR_MIN_TRANSMISSIONS=20 "-DCONST=const     #
#                          __code" -DGENERIC=__generic                        #
#                          -DRFD_RCVC_ALWAYS_ON=FALSE -DPOLL_RATE=1000        #
#                          -DQUEUED_POLL_RATE=100 -DRESPONSE_POLL_RATE=100)   #
#                          -DREJOIN_POLL_RATE=440 D:\zigbee\projects\zstack-c #
#                          c2530-coordinator\Projects\zstack\Samples\GenericA #
#                          pp\Source\GenericApp.c -D ZAPP_P1 -D MT_TASK -D    #
#                          MT_SYS_FUNC -D MT_ZDO_FUNC -D LCD_SUPPORTED=DEBUG  #
#                          -lC D:\zigbee\projects\zstack-cc2530-coordinator\P #
#                          rojects\zstack\Samples\GenericApp\CC2530DB\Coordin #
#                          atorEB\List\ -lA D:\zigbee\projects\zstack-cc2530- #
#                          coordinator\Projects\zstack\Samples\GenericApp\CC2 #
#                          530DB\CoordinatorEB\List\ --diag_suppress          #
#                          Pe001,Pa010 -o D:\zigbee\projects\zstack-cc2530-co #
#                          ordinator\Projects\zstack\Samples\GenericApp\CC253 #
#                          0DB\CoordinatorEB\Obj\ -e --require_prototypes     #
#                          --no_code_motion --debug --core=plain --dptr=16,1  #
#                          --data_model=large --code_model=banked             #
#                          --calling_convention=xdata_reentrant               #
#                          --place_constants=data_rom --nr_virtual_regs 16    #
#                          -I D:\zigbee\projects\zstack-cc2530-coordinator\Pr #
#                          ojects\zstack\Samples\GenericApp\CC2530DB\ -I      #
#                          D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\Source\  #
#                          -I D:\zigbee\projects\zstack-cc2530-coordinator\Pr #
#                          ojects\zstack\Samples\GenericApp\CC2530DB\..\..\.. #
#                          \ZMain\TI2530DB\ -I D:\zigbee\projects\zstack-cc25 #
#                          30-coordinator\Projects\zstack\Samples\GenericApp\ #
#                          CC2530DB\..\..\..\..\..\Components\hal\include\    #
#                          -I D:\zigbee\projects\zstack-cc2530-coordinator\Pr #
#                          ojects\zstack\Samples\GenericApp\CC2530DB\..\..\.. #
#                          \..\..\Components\hal\target\CC2530EB\ -I          #
#                          D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\mac\include\ -I                     #
#                          D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\mac\high_level\ -I                  #
#                          D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\mac\low_level\srf04\ -I             #
#                          D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\mac\low_level\srf04\single_chip\    #
#                          -I D:\zigbee\projects\zstack-cc2530-coordinator\Pr #
#                          ojects\zstack\Samples\GenericApp\CC2530DB\..\..\.. #
#                          \..\..\Components\mt\ -I                           #
#                          D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\osal\include\ -I                    #
#                          D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\osal\mcu\ccsoc\ -I                  #
#                          D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\services\saddr\ -I                  #
#                          D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\services\sdata\ -I                  #
#                          D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\stack\af\ -I                        #
#                          D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\stack\nwk\ -I                       #
#                          D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\stack\sapi\ -I                      #
#                          D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\stack\sec\ -I                       #
#                          D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\stack\sys\ -I                       #
#                          D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\stack\zdo\ -I                       #
#                          D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\zmac\ -I D:\zigbee\projects\zstack- #
#                          cc2530-coordinator\Projects\zstack\Samples\Generic #
#                          App\CC2530DB\..\..\..\..\..\Components\zmac\f8w\   #
#                          -I "C:\Program Files (x86)\IAR Systems\Embedded    #
#                          Workbench 5.4\8051\INC\" -I "C:\Program Files      #
#                          (x86)\IAR Systems\Embedded Workbench               #
#                          5.4\8051\INC\CLIB\" -Ohz                           #
#    List file          =  D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\Coordinator #
#                          EB\List\GenericApp.lst                             #
#    Object file        =  D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\Coordinator #
#                          EB\Obj\GenericApp.r51                              #
#                                                                             #
#                                                                             #
###############################################################################

D:\zigbee\projects\zstack-cc2530-coordinator\Projects\zstack\Samples\GenericApp\Source\GenericApp.c
      1          /**************************************************************************************************
      2            Filename:       GenericApp.c
      3            Revised:        $Date: 2009-03-18 15:56:27 -0700 (Wed, 18 Mar 2009) $
      4            Revision:       $Revision: 19453 $
      5          
      6            Description:    Generic Application (no Profile).
      7          
      8          
      9            Copyright 2004-2009 Texas Instruments Incorporated. All rights reserved.
     10          
     11            IMPORTANT: Your use of this Software is limited to those specific rights
     12            granted under the terms of a software license agreement between the user
     13            who downloaded the software, his/her employer (which must be your employer)
     14            and Texas Instruments Incorporated (the "License").  You may not use this
     15            Software unless you agree to abide by the terms of the License. The License
     16            limits your use, and you acknowledge, that the Software may not be modified,
     17            copied or distributed unless embedded on a Texas Instruments microcontroller
     18            or used solely and exclusively in conjunction with a Texas Instruments radio
     19            frequency transceiver, which is integrated into your product.  Other than for
     20            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     21            works of, modify, distribute, perform, display or sell this Software and/or
     22            its documentation for any purpose.
     23          
     24            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     25            PROVIDED “AS IS?WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED, 
     26            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE, 
     27            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     28            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     29            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     30            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     31            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     32            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     33            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     34            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     35          
     36            Should you have any questions regarding your right to use this Software,
     37            contact Texas Instruments Incorporated at www.TI.com. 
     38          **************************************************************************************************/
     39          
     40          /*********************************************************************
     41            This application isn't intended to do anything useful, it is
     42            intended to be a simple example of an application's structure.
     43          
     44            This application sends "Hello World" to another "Generic"
     45            application every 15 seconds.  The application will also
     46            receive "Hello World" packets.
     47          
     48            The "Hello World" messages are sent/received as MSG type message.
     49          
     50            This applications doesn't have a profile, so it handles everything
     51            directly - itself.
     52          
     53            Key control:
     54              SW1:
     55              SW2:  initiates end device binding
     56              SW3:
     57              SW4:  initiates a match description request
     58          *********************************************************************/
     59          
     60          /*********************************************************************
     61           * INCLUDES
     62           */
     63          #include "OSAL.h"
     64          #include "AF.h"
     65          #include "ZDApp.h"
     66          #include "ZDObject.h"
     67          #include "ZDProfile.h"
     68          
     69          #include "GenericApp.h"
     70          #include "DebugTrace.h"
     71          #include "mt_uart.h"
     72          
     73          #if !defined( WIN32 )
     74            #include "OnBoard.h"
     75          #endif
     76          
     77          /* HAL */
     78          #include "hal_lcd.h"
     79          #include "hal_led.h"
     80          #include "hal_key.h"
     81          #include "hal_uart.h"
     82          
     83          /*********************************************************************
     84           * MACROS
     85           */
     86          /*********************************************************************
     87           * CONSTANTS
     88           */

   \                                 In  segment XDATA_I, align 1, keep-with-next
     89          unsigned char end_device_1_extAddr[8] = {0x94, 0x85, 0xCB, 0x02, 0x00, 0x4B, 0x12, 0x00};
   \                     end_device_1_extAddr:
   \   000000                DS 8
   \   000008                REQUIRE `?<Initializer for end_device_1_extAddr>`
   \   000008                REQUIRE __INIT_XDATA_I
     90          //unsigned char end_device_2_extAddr[8] = {};
     91          //unsigned char end_device_2_extAddr[8] = {};
     92          /*********************************************************************
     93           * TYPEDEFS
     94           */
     95          
     96          /*********************************************************************
     97           * GLOBAL VARIABLES
     98           */
     99          
    100          // This list should be filled with Application specific Cluster IDs.

   \                                 In  segment XDATA_ROM_C, align 1
    101          const cId_t GenericApp_ClusterList[GENERICAPP_MAX_CLUSTERS] =
   \                     GenericApp_ClusterList:
   \   000000   0100         DW 1
    102          {
    103            GENERICAPP_CLUSTERID
    104          };
    105          

   \                                 In  segment XDATA_ROM_C, align 1
    106          const SimpleDescriptionFormat_t GenericApp_SimpleDesc =
   \                     GenericApp_SimpleDesc:
   \   000000   0A           DB 10
   \   000001   040F0100     DW 3844, 1
   \   000005   0001         DB 0, 1
   \   000007   ....         DW GenericApp_ClusterList
   \   000009   01           DB 1
   \   00000A   ....         DW GenericApp_ClusterList
    107          {
    108            GENERICAPP_ENDPOINT,              //  int Endpoint;
    109            GENERICAPP_PROFID,                //  uint16 AppProfId[2];
    110            GENERICAPP_DEVICEID,              //  uint16 AppDeviceId[2];
    111            GENERICAPP_DEVICE_VERSION,        //  int   AppDevVer:4;
    112            GENERICAPP_FLAGS,                 //  int   AppFlags:4;
    113            GENERICAPP_MAX_CLUSTERS,          //  byte  AppNumInClusters;
    114            (cId_t *)GenericApp_ClusterList,  //  byte *pAppInClusterList;
    115            GENERICAPP_MAX_CLUSTERS,          //  byte  AppNumInClusters;
    116            (cId_t *)GenericApp_ClusterList   //  byte *pAppInClusterList;
    117          };
    118          
    119          // This is the Endpoint/Interface description.  It is defined here, but
    120          // filled-in in GenericApp_Init().  Another way to go would be to fill
    121          // in the structure here and make it a "const" (in code space).  The
    122          // way it's defined in this sample app it is define in RAM.

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    123          endPointDesc_t GenericApp_epDesc;
   \                     GenericApp_epDesc:
   \   000000                DS 6
   \   000006                REQUIRE __INIT_XDATA_Z
    124          
    125          /*********************************************************************
    126           * EXTERNAL VARIABLES
    127           */
    128          
    129          /*********************************************************************
    130           * EXTERNAL FUNCTIONS
    131           */
    132          
    133          /*********************************************************************
    134           * LOCAL VARIABLES
    135           */

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    136          byte GenericApp_TaskID;   // Task ID for internal task/event processing
   \                     GenericApp_TaskID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    137                                    // This variable will be received when
    138                                    // GenericApp_Init() is called.

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    139          devStates_t GenericApp_NwkState;
   \                     GenericApp_NwkState:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    140          
    141          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    142          byte GenericApp_TransID;  // This is the unique message ID (counter)
   \                     GenericApp_TransID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    143          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    144          afAddrType_t GenericApp_DstAddr;
   \                     GenericApp_DstAddr:
   \   000000                DS 12
   \   00000C                REQUIRE __INIT_XDATA_Z
    145          
    146          /*********************************************************************
    147           * LOCAL FUNCTIONS
    148           */
    149          void GenericApp_ProcessZDOMsgs( zdoIncomingMsg_t *inMsg );
    150          void GenericApp_HandleKeys( byte shift, byte keys );
    151          void GenericApp_MessageMSGCB( afIncomingMSGPacket_t *pckt );
    152          void GenericApp_SendTheMessage( void );
    153          void GenericApp_SerialMSGCB(void);
    154          
    155          /*********************************************************************
    156           * NETWORK LAYER CALLBACKS
    157           */
    158          
    159          /*********************************************************************
    160           * PUBLIC FUNCTIONS
    161           */
    162          
    163          /*********************************************************************
    164           * @fn      GenericApp_Init
    165           *
    166           * @brief   Initialization function for the Generic App Task.
    167           *          This is called during initialization and should contain
    168           *          any application specific initialization (ie. hardware
    169           *          initialization/setup, table initialization, power up
    170           *          notificaiton ... ).
    171           *
    172           * @param   task_id - the ID assigned by OSAL.  This ID should be
    173           *                    used to send messages and set timers.
    174           *
    175           * @return  none
    176           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    177          void GenericApp_Init( byte task_id )
   \                     GenericApp_Init:
    178          {
   \   000000   74F5         MOV     A,#-0xb
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 11
   \   000005                ; Auto size: 29
   \   000005   74E3         MOV     A,#-0x1d
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   E9           MOV     A,R1
    179            halUARTCfg_t uartConfig;
    180            GenericApp_TaskID = task_id;
   \   00000B   90....       MOV     DPTR,#GenericApp_TaskID
   \   00000E   F0           MOVX    @DPTR,A
    181            GenericApp_NwkState = DEV_INIT;
   \   00000F   7401         MOV     A,#0x1
   \   000011   90....       MOV     DPTR,#GenericApp_NwkState
   \   000014   F0           MOVX    @DPTR,A
    182            GenericApp_TransID = 0;
   \   000015   E4           CLR     A
   \   000016   90....       MOV     DPTR,#GenericApp_TransID
   \   000019   F0           MOVX    @DPTR,A
    183            
    184            //HalUARTInit();
    185            uartConfig.configured = TRUE;
   \   00001A   7401         MOV     A,#0x1
   \   00001C   85..82       MOV     DPL,?XSP + 0
   \   00001F   85..83       MOV     DPH,?XSP + 1
   \   000022   F0           MOVX    @DPTR,A
    186            uartConfig.baudRate = HAL_UART_BR_115200;
   \   000023   12....       LCALL   ?XSTACK_DISP0_8
   \   000026   7404         MOV     A,#0x4
   \   000028   F0           MOVX    @DPTR,A
    187            uartConfig.flowControl = FALSE;
   \   000029   7402         MOV     A,#0x2
   \   00002B   12....       LCALL   ?XSTACK_DISP0_8
   \   00002E   E4           CLR     A
   \   00002F   F0           MOVX    @DPTR,A
    188            uartConfig.callBackFunc = MT_UartProcessZAppData;
   \   000030   741B         MOV     A,#0x1b
   \   000032   12....       LCALL   ?XSTACK_DISP0_8
   \   000035   74..         MOV     A,#(??MT_UartProcessZAppData?relay & 0xff)
   \   000037   F0           MOVX    @DPTR,A
   \   000038   A3           INC     DPTR
   \   000039   74..         MOV     A,#((??MT_UartProcessZAppData?relay >> 8) & 0xff)
   \   00003B   12....       LCALL   ?Subroutine2 & 0xFFFF
    189            HalUARTOpen(0,&uartConfig);
   \                     ??CrossCallReturnLabel_0:
   \   00003E   AA82         MOV     R2,DPL
   \   000040   AB83         MOV     R3,DPH
   \   000042   7900         MOV     R1,#0x0
   \   000044   12....       LCALL   ??HalUARTOpen?relay
    190          
    191            // Device hardware initialization can be added here or in main() (Zmain.c).
    192            // If the hardware is application specific - add it here.
    193            // If the hardware is other parts of the device add it in main().
    194            //printf("%#x\n",NLME_GetExtAddr());
    195            GenericApp_DstAddr.addrMode = (afAddrMode_t)Addr64Bit;
   \   000047   7403         MOV     A,#0x3
   \   000049   90....       MOV     DPTR,#(GenericApp_DstAddr + 8)
   \   00004C   F0           MOVX    @DPTR,A
    196            GenericApp_DstAddr.endPoint = 11;
   \   00004D   740B         MOV     A,#0xb
   \   00004F   90....       MOV     DPTR,#(GenericApp_DstAddr + 9)
   \   000052   F0           MOVX    @DPTR,A
    197            osal_memcpy(GenericApp_DstAddr.addr.extAddr, end_device_1_extAddr, 8);
   \   000053                ; Setup parameters for call to function osal_memcpy
   \   000053   75....       MOV     ?V0 + 0,#(end_device_1_extAddr & 0xff)
   \   000056   75....       MOV     ?V0 + 1,#((end_device_1_extAddr >> 8) & 0xff)
   \   000059   75..00       MOV     ?V0 + 2,#0x0
   \   00005C   78..         MOV     R0,#?V0 + 0
   \   00005E   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   000061   7C08         MOV     R4,#0x8
   \   000063   7D00         MOV     R5,#0x0
   \   000065   7A..         MOV     R2,#(GenericApp_DstAddr & 0xff)
   \   000067   7B..         MOV     R3,#((GenericApp_DstAddr >> 8) & 0xff)
   \   000069   12....       LCALL   ??osal_memcpy?relay
   \   00006C   7403         MOV     A,#0x3
   \   00006E   12....       LCALL   ?DEALLOC_XSTACK8
    198          
    199            // Fill out the endpoint description.
    200            GenericApp_epDesc.endPoint = GENERICAPP_ENDPOINT;
   \   000071   740A         MOV     A,#0xa
   \   000073   90....       MOV     DPTR,#GenericApp_epDesc
   \   000076   F0           MOVX    @DPTR,A
    201            GenericApp_epDesc.task_id = &GenericApp_TaskID;
   \   000077   90....       MOV     DPTR,#(GenericApp_epDesc + 1)
   \   00007A   74..         MOV     A,#(GenericApp_TaskID & 0xff)
   \   00007C   F0           MOVX    @DPTR,A
   \   00007D   A3           INC     DPTR
   \   00007E   74..         MOV     A,#((GenericApp_TaskID >> 8) & 0xff)
   \   000080   F0           MOVX    @DPTR,A
    202            GenericApp_epDesc.simpleDesc
    203                      = (SimpleDescriptionFormat_t *)&GenericApp_SimpleDesc;
   \   000081   90....       MOV     DPTR,#(GenericApp_epDesc + 3)
   \   000084   74..         MOV     A,#(GenericApp_SimpleDesc & 0xff)
   \   000086   F0           MOVX    @DPTR,A
   \   000087   A3           INC     DPTR
   \   000088   74..         MOV     A,#((GenericApp_SimpleDesc >> 8) & 0xff)
   \   00008A   F0           MOVX    @DPTR,A
    204            GenericApp_epDesc.latencyReq = noLatencyReqs;
   \   00008B   E4           CLR     A
   \   00008C   90....       MOV     DPTR,#(GenericApp_epDesc + 5)
   \   00008F   F0           MOVX    @DPTR,A
    205          
    206            // Register the endpoint description with the AF
    207            afRegister( &GenericApp_epDesc );
   \   000090                ; Setup parameters for call to function afRegister
   \   000090   7A..         MOV     R2,#(GenericApp_epDesc & 0xff)
   \   000092   7B..         MOV     R3,#((GenericApp_epDesc >> 8) & 0xff)
   \   000094   12....       LCALL   ??afRegister?relay
    208          
    209            // Register for all key events - This app will handle all key events
    210            RegisterForKeys( GenericApp_TaskID );
   \   000097                ; Setup parameters for call to function RegisterForKeys
   \   000097   90....       MOV     DPTR,#GenericApp_TaskID
   \   00009A   E0           MOVX    A,@DPTR
   \   00009B   F9           MOV     R1,A
   \   00009C   12....       LCALL   ??RegisterForKeys?relay
    211            
    212            // Update the display
    213          #if defined ( LCD_SUPPORTED )
    214              HalLcdWriteString( "GenericApp", HAL_LCD_LINE_1 );
   \   00009F                ; Setup parameters for call to function HalLcdWriteString
   \   00009F   7901         MOV     R1,#0x1
   \   0000A1   7A..         MOV     R2,#(`?<Constant "GenericApp">` & 0xff)
   \   0000A3   7B..         MOV     R3,#((`?<Constant "GenericApp">` >> 8) & 0xff)
   \   0000A5   12....       LCALL   ??HalLcdWriteString?relay
    215          #endif
    216            ZDO_RegisterForZDOMsg( GenericApp_TaskID, Device_annce);  
   \   0000A8                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   0000A8   7A13         MOV     R2,#0x13
   \   0000AA   7B00         MOV     R3,#0x0
   \   0000AC   90....       MOV     DPTR,#GenericApp_TaskID
   \   0000AF   E0           MOVX    A,@DPTR
   \   0000B0   F9           MOV     R1,A
   \   0000B1   12....       LCALL   ??ZDO_RegisterForZDOMsg?relay
    217            MT_UartAppFlowControl(MT_UART_ZAPP_RX_READY);
   \   0000B4                ; Setup parameters for call to function MT_UartAppFlowControl
   \   0000B4   7901         MOV     R1,#0x1
   \   0000B6   12....       LCALL   ??MT_UartAppFlowControl?relay
    218            //ZDO_RegisterForZDOMsg( GenericApp_TaskID, End_Device_Bind_rsp );
    219            //ZDO_RegisterForZDOMsg( GenericApp_TaskID, Match_Desc_rsp );
    220            //printf("\r\n GenericApp init complete!\r\n");
    221          }
   \   0000B9   741D         MOV     A,#0x1d
   \   0000BB                REQUIRE ?Subroutine0
   \   0000BB                ; // Fall through to label ?Subroutine0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine0:
   \   000000   12....       LCALL   ?DEALLOC_XSTACK8
   \   000003   7F03         MOV     R7,#0x3
   \   000005   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine2:
   \   000000   F0           MOVX    @DPTR,A
   \   000001                ; Setup parameters for call to function HalUARTOpen
   \   000001   85..82       MOV     DPL,?XSP + 0
   \   000004   85..83       MOV     DPH,?XSP + 1
   \   000007   22           RET
    222          
    223          /*********************************************************************
    224           * @fn      GenericApp_ProcessEvent
    225           *
    226           * @brief   Generic Application Task event processor.  This function
    227           *          is called to process all events for the task.  Events
    228           *          include timers, messages and any other user defined events.
    229           *
    230           * @param   task_id  - The OSAL assigned task ID.
    231           * @param   events - events to process.  This is a bit map and can
    232           *                   contain more than one event.
    233           *
    234           * @return  none
    235           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    236          UINT16 GenericApp_ProcessEvent( byte task_id, UINT16 events )
   \                     GenericApp_ProcessEvent:
    237          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
    238            afIncomingMSGPacket_t *MSGpkt;
    239            afDataConfirm_t *afDataConfirm;
    240          
    241            // Data Confirmation message fields
    242            byte sentEP;
    243            ZStatus_t sentStatus;
    244            byte sentTransID;       // This should match the value sent
    245            (void)task_id;  // Intentionally unreferenced parameter
    246            //printf("\r\nEvent Processing!\r\n");
    247            if ( events & SYS_EVENT_MSG )
   \   000009   7480         MOV     A,#-0x80
   \   00000B   5F           ANL     A,R7
   \   00000C   F9           MOV     R1,A
   \   00000D   E4           CLR     A
   \   00000E   7001         JNZ     ??GenericApp_ProcessEvent_0
   \   000010   E9           MOV     A,R1
   \                     ??GenericApp_ProcessEvent_0:
   \   000011   7003         JNZ     $+5
   \   000013   02....       LJMP    ??GenericApp_ProcessEvent_1 & 0xFFFF
    248            {
    249              MSGpkt = (afIncomingMSGPacket_t *)osal_msg_receive( GenericApp_TaskID );
   \   000016                ; Setup parameters for call to function osal_msg_receive
   \   000016   800E         SJMP    ??GenericApp_ProcessEvent_2
    250              while ( MSGpkt )
    251              {
    252                switch ( MSGpkt->hdr.event )
    253                {
    254                  case ZDO_CB_MSG:
    255                    GenericApp_ProcessZDOMsgs( (zdoIncomingMsg_t *)MSGpkt );
   \                     ??GenericApp_ProcessEvent_3:
   \   000018                ; Setup parameters for call to function GenericApp_ProcessZDOMsgs
   \   000018   AA..         MOV     R2,?V0 + 0
   \   00001A   AB..         MOV     R3,?V0 + 1
   \   00001C   12....       LCALL   ??GenericApp_ProcessZDOMsgs?relay
    256                    break;
    257                    
    258                  case KEY_CHANGE:
    259                    GenericApp_HandleKeys( ((keyChange_t *)MSGpkt)->state, ((keyChange_t *)MSGpkt)->keys );
    260                    break;
    261          
    262                  case AF_DATA_CONFIRM_CMD:
    263                    // This message is received as a confirmation of a data packet sent.
    264                    // The status is of ZStatus_t type [defined in ZComDef.h]
    265                    // The message fields are defined in AF.h
    266                    afDataConfirm = (afDataConfirm_t *)MSGpkt;
    267                    sentEP = afDataConfirm->endpoint;
    268                    sentStatus = afDataConfirm->hdr.status;
    269                    sentTransID = afDataConfirm->transID;
    270                    (void)sentEP;
    271                    (void)sentTransID;
    272          
    273                    // Action taken when confirmation is received.
    274                    if ( sentStatus != ZSuccess )
    275                    {
    276                      // The data wasn't delivered -- Do something
    277                      //printf("\r\nData not sent\r\n");
    278                    }
    279                    break;
    280          
    281                  case AF_INCOMING_MSG_CMD:
    282                    GenericApp_MessageMSGCB( MSGpkt );
    283                    break;
    284          
    285                  case ZDO_STATE_CHANGE:
    286                    GenericApp_NwkState = (devStates_t)(MSGpkt->hdr.status);
    287                    if ( (GenericApp_NwkState == DEV_ZB_COORD)
    288                        || (GenericApp_NwkState == DEV_ROUTER)
    289                        || (GenericApp_NwkState == DEV_END_DEVICE) )
    290                    {
    291                      // Start sending "the" message in a regular interval.
    292                      osal_start_timerEx( GenericApp_TaskID,
    293                                          GENERICAPP_SEND_MSG_EVT,
    294                                        GENERICAPP_SEND_MSG_TIMEOUT );
    295                    }
    296                    break;
    297                  case SPI_INCOMING_ZAPP_DATA:
    298                    HalUARTWrite(0, "SPICOM", 7);
    299                    GenericApp_SerialMSGCB();
    300                    break;
    301                  default:
    302                    break;
    303                }
    304          
    305                // Release the memory
    306                osal_msg_deallocate( (uint8 *)MSGpkt );
   \                     ??GenericApp_ProcessEvent_4:
   \   00001F                ; Setup parameters for call to function osal_msg_deallocate
   \   00001F   AA..         MOV     R2,?V0 + 0
   \   000021   AB..         MOV     R3,?V0 + 1
   \   000023   12....       LCALL   ??osal_msg_deallocate?relay
    307          
    308                // Next
    309                MSGpkt = (afIncomingMSGPacket_t *)osal_msg_receive( GenericApp_TaskID );
   \   000026                ; Setup parameters for call to function osal_msg_receive
   \                     ??GenericApp_ProcessEvent_2:
   \   000026   90....       MOV     DPTR,#GenericApp_TaskID
   \   000029   E0           MOVX    A,@DPTR
   \   00002A   F9           MOV     R1,A
   \   00002B   12....       LCALL   ??osal_msg_receive?relay
   \   00002E   8A..         MOV     ?V0 + 0,R2
   \   000030   8B..         MOV     ?V0 + 1,R3
   \   000032   E5..         MOV     A,?V0 + 0
   \   000034   7002         JNZ     ??GenericApp_ProcessEvent_5
   \   000036   E5..         MOV     A,?V0 + 1
   \                     ??GenericApp_ProcessEvent_5:
   \   000038   7003         JNZ     $+5
   \   00003A   02....       LJMP    ??GenericApp_ProcessEvent_6 & 0xFFFF
   \   00003D   85..82       MOV     DPL,?V0 + 0
   \   000040   85..83       MOV     DPH,?V0 + 1
   \   000043   E0           MOVX    A,@DPTR
   \   000044   12....       LCALL   ?UC_SWITCH_SPARSE
   \                     `?<Jumptable for GenericApp_ProcessEvent>_0`:
   \   000047   00           DB        0
   \   000048   06           DB        6
   \   000049   1A           DB        26
   \   00004A   ....         DW        ??GenericApp_ProcessEvent_7
   \   00004C   22           DB        34
   \   00004D   ....         DW        ??GenericApp_ProcessEvent_8
   \   00004F   C0           DB        192
   \   000050   ....         DW        ??GenericApp_ProcessEvent_9
   \   000052   D1           DB        209
   \   000053   ....         DW        ??GenericApp_ProcessEvent_10
   \   000055   D3           DB        211
   \   000056   ....         DW        ??GenericApp_ProcessEvent_3
   \   000058   FD           DB        253
   \   000059   ....         DW        ??GenericApp_ProcessEvent_4
   \   00005B   ....         DW        ??GenericApp_ProcessEvent_4
   \                     ??GenericApp_ProcessEvent_9:
   \   00005D                ; Setup parameters for call to function GenericApp_HandleKeys
   \   00005D   85..82       MOV     DPL,?V0 + 0
   \   000060   85..83       MOV     DPH,?V0 + 1
   \   000063   A3           INC     DPTR
   \   000064   A3           INC     DPTR
   \   000065   A3           INC     DPTR
   \   000066   E0           MOVX    A,@DPTR
   \   000067   FA           MOV     R2,A
   \   000068   85..82       MOV     DPL,?V0 + 0
   \   00006B   85..83       MOV     DPH,?V0 + 1
   \   00006E   A3           INC     DPTR
   \   00006F   A3           INC     DPTR
   \   000070   E0           MOVX    A,@DPTR
   \   000071   F9           MOV     R1,A
   \   000072   12....       LCALL   ??GenericApp_HandleKeys?relay
   \   000075   80A8         SJMP    ??GenericApp_ProcessEvent_4
   \                     ??GenericApp_ProcessEvent_7:
   \   000077                ; Setup parameters for call to function GenericApp_MessageMSGCB
   \   000077   AA..         MOV     R2,?V0 + 0
   \   000079   AB..         MOV     R3,?V0 + 1
   \   00007B   12....       LCALL   ??GenericApp_MessageMSGCB?relay
   \   00007E   809F         SJMP    ??GenericApp_ProcessEvent_4
   \                     ??GenericApp_ProcessEvent_10:
   \   000080   85..82       MOV     DPL,?V0 + 0
   \   000083   85..83       MOV     DPH,?V0 + 1
   \   000086   A3           INC     DPTR
   \   000087   E0           MOVX    A,@DPTR
   \   000088   90....       MOV     DPTR,#GenericApp_NwkState
   \   00008B   F0           MOVX    @DPTR,A
   \   00008C   6409         XRL     A,#0x9
   \   00008E   600A         JZ      ??GenericApp_ProcessEvent_11
   \   000090   E0           MOVX    A,@DPTR
   \   000091   6407         XRL     A,#0x7
   \   000093   6005         JZ      ??GenericApp_ProcessEvent_11
   \   000095   E0           MOVX    A,@DPTR
   \   000096   6406         XRL     A,#0x6
   \   000098   7085         JNZ     ??GenericApp_ProcessEvent_4
   \                     ??GenericApp_ProcessEvent_11:
   \   00009A                ; Setup parameters for call to function osal_start_timerEx
   \   00009A   7C88         MOV     R4,#-0x78
   \   00009C   7D13         MOV     R5,#0x13
   \   00009E   7A01         MOV     R2,#0x1
   \   0000A0   7B00         MOV     R3,#0x0
   \   0000A2   90....       MOV     DPTR,#GenericApp_TaskID
   \   0000A5   E0           MOVX    A,@DPTR
   \   0000A6   F9           MOV     R1,A
   \   0000A7   12....       LCALL   ??osal_start_timerEx?relay
   \   0000AA   02....       LJMP    ??GenericApp_ProcessEvent_4 & 0xFFFF
   \                     ??GenericApp_ProcessEvent_8:
   \   0000AD                ; Setup parameters for call to function HalUARTWrite
   \   0000AD   7C07         MOV     R4,#0x7
   \   0000AF   7D00         MOV     R5,#0x0
   \   0000B1   7A..         MOV     R2,#(`?<Constant "SPICOM">` & 0xff)
   \   0000B3   7B..         MOV     R3,#((`?<Constant "SPICOM">` >> 8) & 0xff)
   \   0000B5   7900         MOV     R1,#0x0
   \   0000B7   12....       LCALL   ??HalUARTWrite?relay
   \   0000BA                ; Setup parameters for call to function GenericApp_SerialMSGCB
   \   0000BA   12....       LCALL   ??GenericApp_SerialMSGCB?relay
   \   0000BD   02....       LJMP    ??GenericApp_ProcessEvent_4 & 0xFFFF
    310              }
    311          
    312              // return unprocessed events
    313              return (events ^ SYS_EVENT_MSG);
   \                     ??GenericApp_ProcessEvent_6:
   \   0000C0   EE           MOV     A,R6
   \   0000C1   FA           MOV     R2,A
   \   0000C2   7480         MOV     A,#-0x80
   \   0000C4   6F           XRL     A,R7
   \                     ??GenericApp_ProcessEvent_12:
   \   0000C5   FB           MOV     R3,A
   \   0000C6   8037         SJMP    ??GenericApp_ProcessEvent_13
    314            }
    315          
    316            // Send a message out - This event is generated by a timer
    317            //  (setup in GenericApp_Init()).
    318            if ( events & GENERICAPP_SEND_MSG_EVT )
   \                     ??GenericApp_ProcessEvent_1:
   \   0000C8   EE           MOV     A,R6
   \   0000C9   A2E0         MOV     C,0xE0 /* A   */.0
   \   0000CB   501A         JNC     ??GenericApp_ProcessEvent_14
    319            {
    320              // Send "the" message
    321              GenericApp_SendTheMessage();
   \   0000CD                ; Setup parameters for call to function GenericApp_SendTheMessage
   \   0000CD   12....       LCALL   ??GenericApp_SendTheMessage?relay
    322          
    323              // Setup to send message again
    324              osal_start_timerEx( GenericApp_TaskID,
    325                                  GENERICAPP_SEND_MSG_EVT,
    326                                GENERICAPP_SEND_MSG_TIMEOUT );
   \   0000D0                ; Setup parameters for call to function osal_start_timerEx
   \   0000D0   7C88         MOV     R4,#-0x78
   \   0000D2   7D13         MOV     R5,#0x13
   \   0000D4   7A01         MOV     R2,#0x1
   \   0000D6   7B00         MOV     R3,#0x0
   \   0000D8   90....       MOV     DPTR,#GenericApp_TaskID
   \   0000DB   E0           MOVX    A,@DPTR
   \   0000DC   F9           MOV     R1,A
   \   0000DD   12....       LCALL   ??osal_start_timerEx?relay
    327          
    328              // return unprocessed events
    329              return (events ^ GENERICAPP_SEND_MSG_EVT);
   \   0000E0   7401         MOV     A,#0x1
   \   0000E2   6E           XRL     A,R6
   \   0000E3   FA           MOV     R2,A
   \   0000E4   EF           MOV     A,R7
   \   0000E5   80DE         SJMP    ??GenericApp_ProcessEvent_12
    330            }
    331            
    332            if (events & GENERICAPP_UART_RX_EVT) {
   \                     ??GenericApp_ProcessEvent_14:
   \   0000E7   5402         ANL     A,#0x2
   \   0000E9   6010         JZ      ??GenericApp_ProcessEvent_15
    333              HalUARTWrite(0, "RX_EVT", 7);
   \   0000EB                ; Setup parameters for call to function HalUARTWrite
   \   0000EB   7C07         MOV     R4,#0x7
   \   0000ED   7D00         MOV     R5,#0x0
   \   0000EF   7A..         MOV     R2,#(`?<Constant "RX_EVT">` & 0xff)
   \   0000F1   7B..         MOV     R3,#((`?<Constant "RX_EVT">` >> 8) & 0xff)
   \   0000F3   7900         MOV     R1,#0x0
   \   0000F5   12....       LCALL   ??HalUARTWrite?relay
    334              GenericApp_SerialMSGCB();
   \   0000F8                ; Setup parameters for call to function GenericApp_SerialMSGCB
   \   0000F8   12....       LCALL   ??GenericApp_SerialMSGCB?relay
    335            }
    336          
    337            // Discard unknown events
    338            return 0;
   \                     ??GenericApp_ProcessEvent_15:
   \   0000FB   7A00         MOV     R2,#0x0
   \   0000FD   7B00         MOV     R3,#0x0
   \                     ??GenericApp_ProcessEvent_13:
   \   0000FF   7F04         MOV     R7,#0x4
   \   000101   02....       LJMP    ?BANKED_LEAVE_XDATA
    339          }
    340          
    341          /*********************************************************************
    342           * Event Generation Functions
    343           */
    344          
    345          /*********************************************************************
    346           * @fn      GenericApp_ProcessZDOMsgs()
    347           *
    348           * @brief   Process response messages
    349           *
    350           * @param   none
    351           *
    352           * @return  none
    353           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    354          void GenericApp_ProcessZDOMsgs( zdoIncomingMsg_t *inMsg )
   \                     GenericApp_ProcessZDOMsgs:
    355          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 11
   \   000005   74F5         MOV     A,#-0xb
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   EA           MOV     A,R2
   \   00000B   FE           MOV     R6,A
   \   00000C   EB           MOV     A,R3
   \   00000D   FF           MOV     R7,A
    356            switch ( inMsg->clusterID )
   \   00000E   EE           MOV     A,R6
   \   00000F   240C         ADD     A,#0xc
   \   000011   F582         MOV     DPL,A
   \   000013   EF           MOV     A,R7
   \   000014   3400         ADDC    A,#0x0
   \   000016   F583         MOV     DPH,A
   \   000018   E0           MOVX    A,@DPTR
   \   000019   F5..         MOV     ?V0 + 0,A
   \   00001B   A3           INC     DPTR
   \   00001C   E0           MOVX    A,@DPTR
   \   00001D   F5..         MOV     ?V0 + 1,A
   \   00001F   78..         MOV     R0,#?V0 + 0
   \   000021   12....       LCALL   ?US_SWITCH_SPARSE
   \                     `?<Jumptable for GenericApp_ProcessZDOMsgs>_0`:
   \   000024   0000         DW        0
   \   000026   0300         DW        3
   \   000028   1300         DW        19
   \   00002A   ....         DW        ??GenericApp_ProcessZDOMsgs_0
   \   00002C   0680         DW        32774
   \   00002E   ....         DW        ??GenericApp_ProcessZDOMsgs_1
   \   000030   2080         DW        32800
   \   000032   ....         DW        ??GenericApp_ProcessZDOMsgs_2
   \   000034   ....         DW        ??GenericApp_ProcessZDOMsgs_3
    357            {
    358              case Device_annce:
    359                {
    360                  ZDO_DeviceAnnce_t msg;
    361                  ZDO_ParseDeviceAnnce(inMsg, &msg);  //parse incoming message
   \                     ??GenericApp_ProcessZDOMsgs_0:
   \   000036                ; Setup parameters for call to function ZDO_ParseDeviceAnnce
   \   000036   85..82       MOV     DPL,?XSP + 0
   \   000039   85..83       MOV     DPH,?XSP + 1
   \   00003C   AC82         MOV     R4,DPL
   \   00003E   AD83         MOV     R5,DPH
   \   000040   12....       LCALL   ??ZDO_ParseDeviceAnnce?relay
    362                  //GenericApp_DstAddr.addr.shortAddr = msg.nwkAddr;
    363                  //osal_memcpy(GenericApp_DstAddr.addr.extAddr, msg.extAddr, 8);
    364                }
    365              case End_Device_Bind_rsp:
    366                if ( ZDO_ParseBindRsp( inMsg ) == ZSuccess )
   \                     ??GenericApp_ProcessZDOMsgs_2:
   \   000043   EE           MOV     A,R6
   \   000044   2413         ADD     A,#0x13
   \   000046   F582         MOV     DPL,A
   \   000048   EF           MOV     A,R7
   \   000049   3400         ADDC    A,#0x0
   \   00004B   F583         MOV     DPH,A
   \   00004D   E0           MOVX    A,@DPTR
   \   00004E   F8           MOV     R0,A
   \   00004F   A3           INC     DPTR
   \   000050   E0           MOVX    A,@DPTR
   \   000051   F583         MOV     DPH,A
   \   000053   8882         MOV     DPL,R0
   \   000055   E0           MOVX    A,@DPTR
   \   000056   7009         JNZ     ??GenericApp_ProcessZDOMsgs_4
    367                {
    368                  // Light LED
    369                  HalLedSet( HAL_LED_4, HAL_LED_MODE_ON );
   \   000058                ; Setup parameters for call to function HalLedSet
   \   000058   7A01         MOV     R2,#0x1
   \                     ??GenericApp_ProcessZDOMsgs_5:
   \   00005A   7908         MOV     R1,#0x8
   \   00005C   12....       LCALL   ??HalLedSet?relay
   \   00005F   8055         SJMP    ??GenericApp_ProcessZDOMsgs_3
    370                }
    371          #if defined(BLINK_LEDS)
    372                else
    373                {
    374                  // Flash LED to show failure
    375                  HalLedSet ( HAL_LED_4, HAL_LED_MODE_FLASH );
   \                     ??GenericApp_ProcessZDOMsgs_4:
   \   000061                ; Setup parameters for call to function HalLedSet
   \   000061   7A04         MOV     R2,#0x4
   \   000063   80F5         SJMP    ??GenericApp_ProcessZDOMsgs_5
    376                }
    377          #endif
    378                break;
    379          
    380              case Match_Desc_rsp:
    381                {
    382                  ZDO_ActiveEndpointRsp_t *pRsp = ZDO_ParseEPListRsp( inMsg );
   \                     ??GenericApp_ProcessZDOMsgs_1:
   \   000065                ; Setup parameters for call to function ZDO_ParseEPListRsp
   \   000065   12....       LCALL   ??ZDO_ParseEPListRsp?relay
   \   000068   8A..         MOV     ?V0 + 0,R2
   \   00006A   8B..         MOV     ?V0 + 1,R3
   \   00006C   AE..         MOV     R6,?V0 + 0
   \   00006E   AF..         MOV     R7,?V0 + 1
    383                  if ( pRsp )
   \   000070   EE           MOV     A,R6
   \   000071   7001         JNZ     ??GenericApp_ProcessZDOMsgs_6
   \   000073   EF           MOV     A,R7
   \                     ??GenericApp_ProcessZDOMsgs_6:
   \   000074   6040         JZ      ??GenericApp_ProcessZDOMsgs_3
    384                  {
    385                    if ( pRsp->status == ZSuccess && pRsp->cnt )
   \   000076   8E82         MOV     DPL,R6
   \   000078   8F83         MOV     DPH,R7
   \   00007A   E0           MOVX    A,@DPTR
   \   00007B   7032         JNZ     ??GenericApp_ProcessZDOMsgs_7
   \   00007D   A3           INC     DPTR
   \   00007E   A3           INC     DPTR
   \   00007F   A3           INC     DPTR
   \   000080   E0           MOVX    A,@DPTR
   \   000081   602C         JZ      ??GenericApp_ProcessZDOMsgs_7
    386                    {
    387                      GenericApp_DstAddr.addrMode = (afAddrMode_t)Addr16Bit;
   \   000083   7402         MOV     A,#0x2
   \   000085   90....       MOV     DPTR,#(GenericApp_DstAddr + 8)
   \   000088   F0           MOVX    @DPTR,A
    388                      GenericApp_DstAddr.addr.shortAddr = pRsp->nwkAddr;
   \   000089   8E82         MOV     DPL,R6
   \   00008B   8F83         MOV     DPH,R7
   \   00008D   A3           INC     DPTR
   \   00008E   E0           MOVX    A,@DPTR
   \   00008F   F8           MOV     R0,A
   \   000090   A3           INC     DPTR
   \   000091   E0           MOVX    A,@DPTR
   \   000092   F9           MOV     R1,A
   \   000093   90....       MOV     DPTR,#GenericApp_DstAddr
   \   000096   E8           MOV     A,R0
   \   000097   F0           MOVX    @DPTR,A
   \   000098   A3           INC     DPTR
   \   000099   E9           MOV     A,R1
   \   00009A   F0           MOVX    @DPTR,A
    389                      // Take the first endpoint, Can be changed to search through endpoints
    390                      GenericApp_DstAddr.endPoint = pRsp->epList[0];
   \   00009B   8E82         MOV     DPL,R6
   \   00009D   8F83         MOV     DPH,R7
   \   00009F   A3           INC     DPTR
   \   0000A0   A3           INC     DPTR
   \   0000A1   A3           INC     DPTR
   \   0000A2   A3           INC     DPTR
   \   0000A3   E0           MOVX    A,@DPTR
   \   0000A4   90....       MOV     DPTR,#(GenericApp_DstAddr + 9)
   \   0000A7   F0           MOVX    @DPTR,A
    391          
    392                      // Light LED
    393                      HalLedSet( HAL_LED_4, HAL_LED_MODE_ON );
   \   0000A8                ; Setup parameters for call to function HalLedSet
   \   0000A8   7A01         MOV     R2,#0x1
   \   0000AA   7908         MOV     R1,#0x8
   \   0000AC   12....       LCALL   ??HalLedSet?relay
    394                    }
    395                    osal_mem_free( pRsp );
   \                     ??GenericApp_ProcessZDOMsgs_7:
   \   0000AF                ; Setup parameters for call to function osal_mem_free
   \   0000AF   EE           MOV     A,R6
   \   0000B0   FA           MOV     R2,A
   \   0000B1   EF           MOV     A,R7
   \   0000B2   FB           MOV     R3,A
   \   0000B3   12....       LCALL   ??osal_mem_free?relay
    396                  }
    397                }
    398                break;
    399            }
    400          }
   \                     ??GenericApp_ProcessZDOMsgs_3:
   \   0000B6                REQUIRE ?Subroutine1
   \   0000B6                ; // Fall through to label ?Subroutine1

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine1:
   \   000000   740B         MOV     A,#0xb
   \   000002   12....       LCALL   ?DEALLOC_XSTACK8
   \   000005   7F02         MOV     R7,#0x2
   \   000007   02....       LJMP    ?BANKED_LEAVE_XDATA
    401          
    402          /*********************************************************************
    403           * @fn      GenericApp_HandleKeys
    404           *
    405           * @brief   Handles all key events for this device.
    406           *
    407           * @param   shift - true if in shift/alt.
    408           * @param   keys - bit field for key events. Valid entries:
    409           *                 HAL_KEY_SW_4
    410           *                 HAL_KEY_SW_3
    411           *                 HAL_KEY_SW_2
    412           *                 HAL_KEY_SW_1
    413           *
    414           * @return  none
    415           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    416          void GenericApp_HandleKeys( byte shift, byte keys )
   \                     GenericApp_HandleKeys:
    417          {
   \   000000   74F5         MOV     A,#-0xb
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 11
   \   000005                ; Auto size: 9
   \   000005   74F7         MOV     A,#-0x9
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   E9           MOV     A,R1
   \   00000B   FE           MOV     R6,A
   \   00000C   EA           MOV     A,R2
   \   00000D   FF           MOV     R7,A
    418            zAddrType_t dstAddr;
    419            
    420            // Shift is used to make each button/switch dual purpose.
    421            if ( shift )
   \   00000E   EE           MOV     A,R6
   \   00000F   6003         JZ      $+5
   \   000011   02....       LJMP    ??GenericApp_HandleKeys_0 & 0xFFFF
    422            {
    423              if ( keys & HAL_KEY_SW_1 )
    424              {
    425              }
    426              if ( keys & HAL_KEY_SW_2 )
    427              {
    428              }
    429              if ( keys & HAL_KEY_SW_3 )
    430              {
    431              }
    432              if ( keys & HAL_KEY_SW_4 )
    433              {
    434              }
    435            }
    436            else
    437            {
    438              if ( keys & HAL_KEY_SW_1 )
    439              {
    440              }
    441          
    442              if ( keys & HAL_KEY_SW_2 )
   \   000014   EF           MOV     A,R7
   \   000015   A2E1         MOV     C,0xE0 /* A   */.1
   \   000017   5069         JNC     ??GenericApp_HandleKeys_1
    443              {
    444                HalLedSet ( HAL_LED_4, HAL_LED_MODE_OFF );
   \   000019                ; Setup parameters for call to function HalLedSet
   \   000019   7A00         MOV     R2,#0x0
   \   00001B   7908         MOV     R1,#0x8
   \   00001D   12....       LCALL   ??HalLedSet?relay
    445          
    446                // Initiate an End Device Bind Request for the mandatory endpoint
    447                dstAddr.addrMode = Addr16Bit;
   \   000020   7408         MOV     A,#0x8
   \   000022   12....       LCALL   ?XSTACK_DISP0_8
   \   000025   7402         MOV     A,#0x2
   \   000027   12....       LCALL   ?Subroutine2 & 0xFFFF
    448                dstAddr.addr.shortAddr = 0x0000; // Coordinator
   \                     ??CrossCallReturnLabel_1:
   \   00002A   E4           CLR     A
   \   00002B   F0           MOVX    @DPTR,A
   \   00002C   A3           INC     DPTR
   \   00002D   F0           MOVX    @DPTR,A
    449                ZDP_EndDeviceBindReq( &dstAddr, NLME_GetShortAddr(), 
    450                                      GenericApp_epDesc.endPoint,
    451                                      GENERICAPP_PROFID,
    452                                      GENERICAPP_MAX_CLUSTERS, (cId_t *)GenericApp_ClusterList,
    453                                      GENERICAPP_MAX_CLUSTERS, (cId_t *)GenericApp_ClusterList,
    454                                      FALSE );
   \   00002E                ; Setup parameters for call to function NLME_GetShortAddr
   \   00002E   12....       LCALL   ??NLME_GetShortAddr?relay
   \   000031   8A..         MOV     ?V0 + 0,R2
   \   000033   8B..         MOV     ?V0 + 1,R3
   \   000035   AC..         MOV     R4,?V0 + 0
   \   000037   AD..         MOV     R5,?V0 + 1
   \   000039   75....       MOV     ?V0 + 0,#(GenericApp_ClusterList & 0xff)
   \   00003C   75....       MOV     ?V0 + 1,#((GenericApp_ClusterList >> 8) & 0xff)
   \   00003F                ; Setup parameters for call to function ZDP_EndDeviceBindReq
   \   00003F   75..00       MOV     ?V0 + 2,#0x0
   \   000042   78..         MOV     R0,#?V0 + 2
   \   000044   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000047   78..         MOV     R0,#?V0 + 0
   \   000049   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00004C   75..01       MOV     ?V0 + 2,#0x1
   \   00004F   78..         MOV     R0,#?V0 + 2
   \   000051   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000054   78..         MOV     R0,#?V0 + 0
   \   000056   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000059   75..01       MOV     ?V0 + 0,#0x1
   \   00005C   78..         MOV     R0,#?V0 + 0
   \   00005E   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000061   75..04       MOV     ?V0 + 0,#0x4
   \   000064   75..0F       MOV     ?V0 + 1,#0xf
   \   000067   78..         MOV     R0,#?V0 + 0
   \   000069   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00006C   90....       MOV     DPTR,#GenericApp_epDesc
   \   00006F   E0           MOVX    A,@DPTR
   \   000070   F9           MOV     R1,A
   \   000071   7409         MOV     A,#0x9
   \   000073   12....       LCALL   ?XSTACK_DISP0_8
   \   000076   AA82         MOV     R2,DPL
   \   000078   AB83         MOV     R3,DPH
   \   00007A   12....       LCALL   ??ZDP_EndDeviceBindReq?relay
   \   00007D   7409         MOV     A,#0x9
   \   00007F   12....       LCALL   ?DEALLOC_XSTACK8
    455              }
    456          
    457              if ( keys & HAL_KEY_SW_3 )
    458              {
    459              }
    460          
    461              if ( keys & HAL_KEY_SW_4 )
   \                     ??GenericApp_HandleKeys_1:
   \   000082   EF           MOV     A,R7
   \   000083   A2E3         MOV     C,0xE0 /* A   */.3
   \   000085   5058         JNC     ??GenericApp_HandleKeys_0
    462              {
    463                HalLedSet ( HAL_LED_4, HAL_LED_MODE_OFF );
   \   000087                ; Setup parameters for call to function HalLedSet
   \   000087   7A00         MOV     R2,#0x0
   \   000089   7908         MOV     R1,#0x8
   \   00008B   12....       LCALL   ??HalLedSet?relay
    464                // Initiate a Match Description Request (Service Discovery)
    465                dstAddr.addrMode = AddrBroadcast;
   \   00008E   7408         MOV     A,#0x8
   \   000090   12....       LCALL   ?XSTACK_DISP0_8
   \   000093   740F         MOV     A,#0xf
   \   000095   12....       LCALL   ?Subroutine2 & 0xFFFF
    466                dstAddr.addr.shortAddr = NWK_BROADCAST_SHORTADDR;
   \                     ??CrossCallReturnLabel_2:
   \   000098   74FF         MOV     A,#-0x1
   \   00009A   F0           MOVX    @DPTR,A
   \   00009B   A3           INC     DPTR
   \   00009C   F0           MOVX    @DPTR,A
    467                ZDP_MatchDescReq( &dstAddr, NWK_BROADCAST_SHORTADDR,
    468                                  GENERICAPP_PROFID,
    469                                  GENERICAPP_MAX_CLUSTERS, (cId_t *)GenericApp_ClusterList,
    470                                  GENERICAPP_MAX_CLUSTERS, (cId_t *)GenericApp_ClusterList,
    471                                  FALSE );
   \   00009D   75....       MOV     ?V0 + 0,#(GenericApp_ClusterList & 0xff)
   \   0000A0   75....       MOV     ?V0 + 1,#((GenericApp_ClusterList >> 8) & 0xff)
   \   0000A3                ; Setup parameters for call to function ZDP_MatchDescReq
   \   0000A3   75..00       MOV     ?V0 + 2,#0x0
   \   0000A6   78..         MOV     R0,#?V0 + 2
   \   0000A8   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   0000AB   78..         MOV     R0,#?V0 + 0
   \   0000AD   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000B0   75..01       MOV     ?V0 + 2,#0x1
   \   0000B3   78..         MOV     R0,#?V0 + 2
   \   0000B5   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   0000B8   78..         MOV     R0,#?V0 + 0
   \   0000BA   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000BD   75..04       MOV     ?V0 + 0,#0x4
   \   0000C0   75..0F       MOV     ?V0 + 1,#0xf
   \   0000C3   78..         MOV     R0,#?V0 + 0
   \   0000C5   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000C8   7901         MOV     R1,#0x1
   \   0000CA   7CFF         MOV     R4,#-0x1
   \   0000CC   7DFF         MOV     R5,#-0x1
   \   0000CE   7408         MOV     A,#0x8
   \   0000D0   12....       LCALL   ?XSTACK_DISP0_8
   \   0000D3   AA82         MOV     R2,DPL
   \   0000D5   AB83         MOV     R3,DPH
   \   0000D7   12....       LCALL   ??ZDP_MatchDescReq?relay
   \   0000DA   7408         MOV     A,#0x8
   \   0000DC   12....       LCALL   ?DEALLOC_XSTACK8
    472              }
    473            }
    474          }
   \                     ??GenericApp_HandleKeys_0:
   \   0000DF   7409         MOV     A,#0x9
   \   0000E1   02....       LJMP    ?Subroutine0 & 0xFFFF
    475          
    476          /*********************************************************************
    477           * LOCAL FUNCTIONS
    478           */
    479          
    480          /*********************************************************************
    481           * @fn      GenericApp_MessageMSGCB
    482           *
    483           * @brief   Data message processor callback.  This function processes
    484           *          any incoming data - probably from other devices.  So, based
    485           *          on cluster ID, perform the intended action.
    486           *
    487           * @param   none
    488           *
    489           * @return  none
    490           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    491          void GenericApp_MessageMSGCB( afIncomingMSGPacket_t *pkt )
   \                     GenericApp_MessageMSGCB:
    492          {
   \   000000   74F5         MOV     A,#-0xb
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 11
   \   000005                ; Auto size: 8
   \   000005   74F8         MOV     A,#-0x8
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   EA           MOV     A,R2
   \   00000B   FE           MOV     R6,A
   \   00000C   EB           MOV     A,R3
   \   00000D   FF           MOV     R7,A
    493            unsigned char ext_addr[8];
    494            //printf("\r\nMsg Received!\r\n");
    495            switch ( pkt->clusterId )
   \   00000E   8E82         MOV     DPL,R6
   \   000010   8F83         MOV     DPH,R7
   \   000012   A3           INC     DPTR
   \   000013   A3           INC     DPTR
   \   000014   A3           INC     DPTR
   \   000015   A3           INC     DPTR
   \   000016   E0           MOVX    A,@DPTR
   \   000017   6401         XRL     A,#0x1
   \   000019   7002         JNZ     ??GenericApp_MessageMSGCB_0
   \   00001B   A3           INC     DPTR
   \   00001C   E0           MOVX    A,@DPTR
   \                     ??GenericApp_MessageMSGCB_0:
   \   00001D   7072         JNZ     ??GenericApp_MessageMSGCB_1
    496            {
    497              case GENERICAPP_CLUSTERID:
    498                {// "the" message
    499                (void)APSME_LookupExtAddr(pkt->srcAddr.addr.shortAddr, ext_addr);
   \   00001F                ; Setup parameters for call to function APSME_LookupExtAddr
   \   00001F   85..82       MOV     DPL,?XSP + 0
   \   000022   85..83       MOV     DPH,?XSP + 1
   \   000025   AC82         MOV     R4,DPL
   \   000027   AD83         MOV     R5,DPH
   \   000029   8E82         MOV     DPL,R6
   \   00002B   8F83         MOV     DPH,R7
   \   00002D   A3           INC     DPTR
   \   00002E   A3           INC     DPTR
   \   00002F   A3           INC     DPTR
   \   000030   A3           INC     DPTR
   \   000031   A3           INC     DPTR
   \   000032   A3           INC     DPTR
   \   000033   12....       LCALL   ??Subroutine4_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_3:
   \   000036   12....       LCALL   ??APSME_LookupExtAddr?relay
    500                if (osal_memcmp(ext_addr, end_device_1_extAddr, 8)) {
   \   000039                ; Setup parameters for call to function osal_memcmp
   \   000039   75....       MOV     ?V0 + 0,#(end_device_1_extAddr & 0xff)
   \   00003C   75....       MOV     ?V0 + 1,#((end_device_1_extAddr >> 8) & 0xff)
   \   00003F   75..00       MOV     ?V0 + 2,#0x0
   \   000042   78..         MOV     R0,#?V0 + 0
   \   000044   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   000047   7C08         MOV     R4,#0x8
   \   000049   7D00         MOV     R5,#0x0
   \   00004B   7403         MOV     A,#0x3
   \   00004D   12....       LCALL   ?XSTACK_DISP0_8
   \   000050   A982         MOV     R1,DPL
   \   000052   AA83         MOV     R2,DPH
   \   000054   7B00         MOV     R3,#0x0
   \   000056   12....       LCALL   ??osal_memcmp?relay
   \   000059   7403         MOV     A,#0x3
   \   00005B   12....       LCALL   ?DEALLOC_XSTACK8
    501                  //printf("This is from end device 1\r\n");
    502                }
    503                HalUARTWrite(0, pkt->cmd.Data, osal_strlen(pkt->cmd.Data)+1);
                                                                  ^
Warning[Pe167]: argument of type "unsigned char *" is incompatible with
          parameter of type "char *"
   \   00005E   EE           MOV     A,R6
   \   00005F   2421         ADD     A,#0x21
   \   000061   F8           MOV     R0,A
   \   000062   EF           MOV     A,R7
   \   000063   3400         ADDC    A,#0x0
   \   000065   F9           MOV     R1,A
   \   000066   E8           MOV     A,R0
   \   000067   FE           MOV     R6,A
   \   000068   E9           MOV     A,R1
   \   000069   FF           MOV     R7,A
   \   00006A                ; Setup parameters for call to function osal_strlen
   \   00006A   12....       LCALL   ?Subroutine3 & 0xFFFF
   \                     ??CrossCallReturnLabel_4:
   \   00006D   12....       LCALL   ??osal_strlen?relay
   \   000070   8A..         MOV     ?V0 + 0,R2
   \   000072   8B..         MOV     ?V0 + 1,R3
   \   000074   A8..         MOV     R0,?V0 + 0
   \   000076   A9..         MOV     R1,?V0 + 1
   \   000078                ; Setup parameters for call to function HalUARTWrite
   \   000078   7401         MOV     A,#0x1
   \   00007A   28           ADD     A,R0
   \   00007B   FC           MOV     R4,A
   \   00007C   E4           CLR     A
   \   00007D   39           ADDC    A,R1
   \   00007E   FD           MOV     R5,A
   \   00007F   12....       LCALL   ?Subroutine3 & 0xFFFF
   \                     ??CrossCallReturnLabel_5:
   \   000082   7900         MOV     R1,#0x0
   \   000084   12....       LCALL   ??HalUARTWrite?relay
    504          #if defined( LCD_SUPPORTED )
    505                HalLcdWriteScreen( (char*)pkt->cmd.Data, "rcvd" );
   \   000087                ; Setup parameters for call to function HalLcdWriteScreen
   \   000087   7C..         MOV     R4,#(`?<Constant "rcvd">` & 0xff)
   \   000089   7D..         MOV     R5,#((`?<Constant "rcvd">` >> 8) & 0xff)
   \   00008B   12....       LCALL   ?Subroutine3 & 0xFFFF
   \                     ??CrossCallReturnLabel_6:
   \   00008E   12....       LCALL   ??HalLcdWriteScreen?relay
    506          #elif defined( WIN32 )
    507                WPRINTSTR( pkt->cmd.Data );
    508          #endif
    509                break;
    510                }
    511            }
    512          }
   \                     ??GenericApp_MessageMSGCB_1:
   \   000091   7408         MOV     A,#0x8
   \   000093   02....       LJMP    ?Subroutine0 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine3:
   \   000000   8E82         MOV     DPL,R6
   \   000002   8F83         MOV     DPH,R7
   \   000004                REQUIRE ??Subroutine4_0
   \   000004                ; // Fall through to label ??Subroutine4_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine4_0:
   \   000000   E0           MOVX    A,@DPTR
   \   000001   FA           MOV     R2,A
   \   000002   A3           INC     DPTR
   \   000003   E0           MOVX    A,@DPTR
   \   000004   FB           MOV     R3,A
   \   000005   22           RET
    513          
    514          /*********************************************************************
    515           * @fn      GenericApp_SendTheMessage
    516           *
    517           * @brief   Send "the" message.
    518           *
    519           * @param   none
    520           *
    521           * @return  none
    522           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    523          void GenericApp_SendTheMessage( void )
   \                     GenericApp_SendTheMessage:
    524          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 11
   \   000005   74F5         MOV     A,#-0xb
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
    525            char theMessageData[] = "Hell World";
   \   00000A   85..82       MOV     DPL,?XSP + 0
   \   00000D   85..83       MOV     DPH,?XSP + 1
   \   000010   AC82         MOV     R4,DPL
   \   000012   AD83         MOV     R5,DPH
   \   000014   7583..       MOV     DPH,#((`?<Constant "Hell World">` >> 8) & 0xff)
   \   000017   7582..       MOV     DPL,#(`?<Constant "Hell World">` & 0xff)
   \   00001A   740B         MOV     A,#0xb
   \   00001C   12....       LCALL   ?MOVE_LONG8_XDATA_XDATA
    526            //unsigned char short_addr[2];
    527            //printf("\r\nHello world sent\r\n"); 
    528          
    529            if ( AF_DataRequest( &GenericApp_DstAddr, &GenericApp_epDesc,
    530                                 GENERICAPP_CLUSTERID,
    531                                 (byte)osal_strlen( theMessageData ) + 1,
    532                                 (byte *)&theMessageData,
    533                                 &GenericApp_TransID,
    534                                 AF_DISCV_ROUTE, AF_DEFAULT_RADIUS ) == afStatus_SUCCESS )
   \   00001F                ; Setup parameters for call to function AF_DataRequest
   \   00001F   75..1E       MOV     ?V0 + 0,#0x1e
   \   000022   78..         MOV     R0,#?V0 + 0
   \   000024   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000027   75....       MOV     ?V0 + 0,#(GenericApp_TransID & 0xff)
   \   00002A   75....       MOV     ?V0 + 1,#((GenericApp_TransID >> 8) & 0xff)
   \   00002D   78..         MOV     R0,#?V0 + 0
   \   00002F   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000032   7403         MOV     A,#0x3
   \   000034   12....       LCALL   ?XSTACK_DISP0_8
   \   000037   8582..       MOV     ?V0 + 0,DPL
   \   00003A   8583..       MOV     ?V0 + 1,DPH
   \   00003D   78..         MOV     R0,#?V0 + 0
   \   00003F   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000042                ; Setup parameters for call to function osal_strlen
   \   000042   7405         MOV     A,#0x5
   \   000044   12....       LCALL   ?XSTACK_DISP0_8
   \   000047   AA82         MOV     R2,DPL
   \   000049   AB83         MOV     R3,DPH
   \   00004B   12....       LCALL   ??osal_strlen?relay
   \   00004E   EA           MOV     A,R2
   \   00004F   F8           MOV     R0,A
   \   000050   7401         MOV     A,#0x1
   \   000052   28           ADD     A,R0
   \   000053   F5..         MOV     ?V0 + 0,A
   \   000055   E4           CLR     A
   \   000056   3400         ADDC    A,#0x0
   \   000058   F5..         MOV     ?V0 + 1,A
   \   00005A   78..         MOV     R0,#?V0 + 0
   \   00005C   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00005F   75..01       MOV     ?V0 + 0,#0x1
   \   000062   75..00       MOV     ?V0 + 1,#0x0
   \   000065   78..         MOV     R0,#?V0 + 0
   \   000067   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00006A   7920         MOV     R1,#0x20
   \   00006C   7C..         MOV     R4,#(GenericApp_epDesc & 0xff)
   \   00006E   7D..         MOV     R5,#((GenericApp_epDesc >> 8) & 0xff)
   \   000070   7A..         MOV     R2,#(GenericApp_DstAddr & 0xff)
   \   000072   7B..         MOV     R3,#((GenericApp_DstAddr >> 8) & 0xff)
   \   000074   12....       LCALL   ??AF_DataRequest?relay
   \   000077   7409         MOV     A,#0x9
   \   000079   12....       LCALL   ?DEALLOC_XSTACK8
    535            {
    536              // Successfully requested to be sent.
    537              //osal_buffer_uint16(short_addr, GenericApp_DstAddr.addr.shortAddr);
    538             // printf("\r\nMsg Sent Successfully!\r\n");
    539             // printf("short address:");
    540             // printf("%04x", GenericApp_DstAddr.addr.shortAddr);
    541            }
    542            else
    543            {
    544              // Error occurred in request to send.
    545            //  printf("\r\nMsg Not Sent!\r\n");
    546            }
    547          }
   \   00007C   02....       LJMP    ?Subroutine1 & 0xFFFF
    548          

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    549          void GenericApp_SerialMSGCB(void)
   \                     GenericApp_SerialMSGCB:
    550          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 5
   \   000004   74FB         MOV     A,#-0x5
   \   000006   12....       LCALL   ?ALLOC_XSTACK8
    551            unsigned char buf [5] = "";
   \   000009   85..82       MOV     DPL,?XSP + 0
   \   00000C   85..83       MOV     DPH,?XSP + 1
   \   00000F   AC82         MOV     R4,DPL
   \   000011   AD83         MOV     R5,DPH
   \   000013   7583..       MOV     DPH,#((`?<Constant "">` >> 8) & 0xff)
   \   000016   7582..       MOV     DPL,#(`?<Constant "">` & 0xff)
   \   000019   7405         MOV     A,#0x5
   \   00001B   12....       LCALL   ?MOVE_LONG8_XDATA_XDATA
    552           // printf("UART received!");
    553            HalUARTRead(0, buf, 4);
   \   00001E                ; Setup parameters for call to function HalUARTRead
   \   00001E   7C04         MOV     R4,#0x4
   \   000020   FD           MOV     R5,A
   \   000021   85..82       MOV     DPL,?XSP + 0
   \   000024   85..83       MOV     DPH,?XSP + 1
   \   000027   AA82         MOV     R2,DPL
   \   000029   AB83         MOV     R3,DPH
   \   00002B   F9           MOV     R1,A
   \   00002C   12....       LCALL   ??HalUARTRead?relay
    554            HalUARTWrite(0, buf, 4);
   \   00002F                ; Setup parameters for call to function HalUARTWrite
   \   00002F   7C04         MOV     R4,#0x4
   \   000031   7D00         MOV     R5,#0x0
   \   000033   85..82       MOV     DPL,?XSP + 0
   \   000036   85..83       MOV     DPH,?XSP + 1
   \   000039   AA82         MOV     R2,DPL
   \   00003B   AB83         MOV     R3,DPH
   \   00003D   7900         MOV     R1,#0x0
   \   00003F   12....       LCALL   ??HalUARTWrite?relay
    555            HalUARTWrite(0, "Hello", 6);
   \   000042                ; Setup parameters for call to function HalUARTWrite
   \   000042   7C06         MOV     R4,#0x6
   \   000044   7D00         MOV     R5,#0x0
   \   000046   7A..         MOV     R2,#(`?<Constant "Hello">` & 0xff)
   \   000048   7B..         MOV     R3,#((`?<Constant "Hello">` >> 8) & 0xff)
   \   00004A   7900         MOV     R1,#0x0
   \   00004C   12....       LCALL   ??HalUARTWrite?relay
    556            MT_UartAppFlowControl(MT_UART_ZAPP_RX_READY);
   \   00004F                ; Setup parameters for call to function MT_UartAppFlowControl
   \   00004F   7901         MOV     R1,#0x1
   \   000051   12....       LCALL   ??MT_UartAppFlowControl?relay
    557          }
   \   000054   7405         MOV     A,#0x5
   \   000056   12....       LCALL   ?DEALLOC_XSTACK8
   \   000059   D083         POP     DPH
   \   00005B   D082         POP     DPL
   \   00005D   02....       LJMP    ?BRET

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for end_device_1_extAddr>`:
   \   000000   9485CB02     DB 148, 133, 203, 2, 0, 75, 18, 0
   \            004B1200

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??GenericApp_Init?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    GenericApp_Init

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??GenericApp_ProcessEvent?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    GenericApp_ProcessEvent

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??GenericApp_ProcessZDOMsgs?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    GenericApp_ProcessZDOMsgs

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??GenericApp_HandleKeys?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    GenericApp_HandleKeys

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??GenericApp_MessageMSGCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    GenericApp_MessageMSGCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??GenericApp_SendTheMessage?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    GenericApp_SendTheMessage

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??GenericApp_SerialMSGCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    GenericApp_SerialMSGCB

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "GenericApp">`:
   \   000000   47656E65     DB "GenericApp"
   \            72696341
   \            707000  

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "SPICOM">`:
   \   000000   53504943     DB "SPICOM"
   \            4F4D00  

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "RX_EVT">`:
   \   000000   52585F45     DB "RX_EVT"
   \            565400  

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "rcvd">`:
   \   000000   72637664     DB "rcvd"
   \            00      

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "Hell World">`:
   \   000000   48656C6C     DB "Hell World"
   \            20576F72
   \            6C6400  

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "">`:
   \   000000   00           DB ""
   \   000001   00000000     DB 0, 0, 0, 0

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "Hello">`:
   \   000000   48656C6C     DB "Hello"
   \            6F00    
    558          
    559          /*********************************************************************
    560          *********************************************************************/

   Maximum stack usage in bytes:

     Function                       ISTACK PSTACK XSTACK
     --------                       ------ ------ ------
     GenericApp_HandleKeys              1      0     41
       -> HalLedSet                     0      0     40
       -> NLME_GetShortAddr             0      0     40
       -> ZDP_EndDeviceBindReq          0      0     58
       -> HalLedSet                     0      0     40
       -> ZDP_MatchDescReq              0      0     56
     GenericApp_Init                    1      0     43
       -> HalUARTOpen                   0      0     80
       -> osal_memcpy                   0      0     86
       -> afRegister                    0      0     80
       -> RegisterForKeys               0      0     80
       -> HalLcdWriteString             0      0     80
       -> ZDO_RegisterForZDOMsg         0      0     80
       -> MT_UartAppFlowControl         0      0     80
     GenericApp_MessageMSGCB            0      0     34
       -> APSME_LookupExtAddr           0      0     38
       -> osal_memcmp                   0      0     44
       -> osal_strlen                   0      0     38
       -> HalUARTWrite                  0      0     38
       -> HalLcdWriteScreen             0      0     38
     GenericApp_ProcessEvent            0      0     12
       -> osal_msg_receive              0      0     24
       -> GenericApp_ProcessZDOMsgs     0      0     24
       -> osal_msg_deallocate           0      0     24
       -> osal_msg_receive              0      0     24
       -> GenericApp_HandleKeys         0      0     24
       -> GenericApp_MessageMSGCB       0      0     24
       -> osal_start_timerEx            0      0     24
       -> HalUARTWrite                  0      0     24
       -> GenericApp_SerialMSGCB        0      0     24
       -> GenericApp_SendTheMessage     0      0     24
       -> osal_start_timerEx            0      0     24
       -> HalUARTWrite                  0      0     24
       -> GenericApp_SerialMSGCB        0      0     24
     GenericApp_ProcessZDOMsgs          0      0     33
       -> ZDO_ParseDeviceAnnce          0      0     42
       -> HalLedSet                     0      0     42
       -> HalLedSet                     0      0     42
       -> ZDO_ParseEPListRsp            0      0     42
       -> HalLedSet                     0      0     42
       -> osal_mem_free                 0      0     42
     GenericApp_SendTheMessage          2      0     42
       -> osal_strlen                   0      0     52
       -> AF_DataRequest                0      0     60
     GenericApp_SerialMSGCB             4      0     17
       -> HalUARTRead                   4      0     10
       -> HalUARTWrite                  4      0     10
       -> HalUARTWrite                  4      0     10
       -> MT_UartAppFlowControl         4      0     10


   Segment part sizes:

     Function/Label                          Bytes
     --------------                          -----
     end_device_1_extAddr                       8
     GenericApp_ClusterList                     2
     GenericApp_SimpleDesc                     12
     GenericApp_epDesc                          6
     GenericApp_TaskID                          1
     GenericApp_NwkState                        1
     GenericApp_TransID                         1
     GenericApp_DstAddr                        12
     GenericApp_Init                          187
     ?Subroutine0                               8
     ?Subroutine2                               8
     GenericApp_ProcessEvent                  260
     GenericApp_ProcessZDOMsgs                182
     ?Subroutine1                              10
     GenericApp_HandleKeys                    228
     GenericApp_MessageMSGCB                  150
     ?Subroutine3                               4
     ??Subroutine4_0                            6
     GenericApp_SendTheMessage                127
     GenericApp_SerialMSGCB                    96
     ?<Initializer for end_device_1_extAddr>    8
     ??GenericApp_Init?relay                    6
     ??GenericApp_ProcessEvent?relay            6
     ??GenericApp_ProcessZDOMsgs?relay          6
     ??GenericApp_HandleKeys?relay              6
     ??GenericApp_MessageMSGCB?relay            6
     ??GenericApp_SendTheMessage?relay          6
     ??GenericApp_SerialMSGCB?relay             6
     ?<Constant "GenericApp">                  11
     ?<Constant "SPICOM">                       7
     ?<Constant "RX_EVT">                       7
     ?<Constant "rcvd">                         5
     ?<Constant "Hell World">                  11
     ?<Constant "">                             5
     ?<Constant "Hello">                        6

 
 1 266 bytes in segment BANKED_CODE
    42 bytes in segment BANK_RELAYS
     8 bytes in segment XDATA_I
     8 bytes in segment XDATA_ID
    66 bytes in segment XDATA_ROM_C
    21 bytes in segment XDATA_Z
 
 1 316 bytes of CODE  memory
    66 bytes of CONST memory
    29 bytes of XDATA memory

Errors: none
Warnings: 1
