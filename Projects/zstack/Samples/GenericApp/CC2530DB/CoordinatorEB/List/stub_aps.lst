###############################################################################
#                                                                             #
# IAR C/C++ Compiler V7.60.1.40026 for 8051             09/Apr/2014  09:37:47 #
# Copyright (C) 2004-2010 IAR Systems AB.                                     #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data_rom                                           #
#    Dptr setup         =  1,16                                               #
#    Source file        =  D:\zigbee\projects\zstack-cc2530-coordinator\Compo #
#                          nents\stack\nwk\stub_aps.c                         #
#    Command line       =  -f D:\zigbee\projects\zstack-cc2530-coordinator\Pr #
#                          ojects\zstack\Samples\GenericApp\CC2530DB\..\..\.. #
#                          \Tools\CC2530DB\f8wCoord.cfg (-DCPU32MHZ           #
#                          -DROOT=__near_func -DMAC_CFG_APP_PENDING_QUEUE=TRU #
#                          E -DMAC_CFG_TX_DATA_MAX=5 -DMAC_CFG_TX_MAX=8       #
#                          -DMAC_CFG_RX_MAX=5 -DZDO_COORDINATOR -DRTR_NWK)    #
#                          -f D:\zigbee\projects\zstack-cc2530-coordinator\Pr #
#                          ojects\zstack\Samples\GenericApp\CC2530DB\..\..\.. #
#                          \Tools\CC2530DB\f8wConfig.cfg (-DZIGBEEPRO         #
#                          -DSECURE=0 -DZG_SECURE_DYNAMIC=0 -DREFLECTOR       #
#                          -DDEFAULT_CHANLIST=0x00000800                      #
#                          -DZDAPP_CONFIG_PAN_ID=0x1111                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DLINK_STATUS_JITTER_MASK=0x007F                   #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3    #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40           #
#                          -DNWK_MAX_BINDING_ENTRIES=4                        #
#                          -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DMAC_MAX_FRAME_SIZE=116                           #
#                          -DZDNWKMGR_MIN_TRANSMISSIONS=20 "-DCONST=const     #
#                          __code" -DGENERIC=__generic                        #
#                          -DRFD_RCVC_ALWAYS_ON=FALSE -DPOLL_RATE=1000        #
#                          -DQUEUED_POLL_RATE=100 -DRESPONSE_POLL_RATE=100)   #
#                          -DREJOIN_POLL_RATE=440 D:\zigbee\projects\zstack-c #
#                          c2530-coordinator\Components\stack\nwk\stub_aps.c  #
#                          -D ZAPP_P1 -D MT_TASK -D MT_SYS_FUNC -D            #
#                          MT_ZDO_FUNC -D HAL_UART -D HAL_UART=TRUE -D        #
#                          HAL_DMA=TRUE -D HAL_LCD=FALSE -D HAL_KEY=FALSE     #
#                          -lC D:\zigbee\projects\zstack-cc2530-coordinator\P #
#                          rojects\zstack\Samples\GenericApp\CC2530DB\Coordin #
#                          atorEB\List\ -lA D:\zigbee\projects\zstack-cc2530- #
#                          coordinator\Projects\zstack\Samples\GenericApp\CC2 #
#                          530DB\CoordinatorEB\List\ --diag_suppress          #
#                          Pe001,Pa010 -o D:\zigbee\projects\zstack-cc2530-co #
#                          ordinator\Projects\zstack\Samples\GenericApp\CC253 #
#                          0DB\CoordinatorEB\Obj\ -e --require_prototypes     #
#                          --no_code_motion --debug --core=plain --dptr=16,1  #
#                          --data_model=large --code_model=banked             #
#                          --calling_convention=xdata_reentrant               #
#                          --place_constants=data_rom --nr_virtual_regs 16    #
#                          -I D:\zigbee\projects\zstack-cc2530-coordinator\Pr #
#                          ojects\zstack\Samples\GenericApp\CC2530DB\ -I      #
#                          D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\Source\  #
#                          -I D:\zigbee\projects\zstack-cc2530-coordinator\Pr #
#                          ojects\zstack\Samples\GenericApp\CC2530DB\..\..\.. #
#                          \ZMain\TI2530DB\ -I D:\zigbee\projects\zstack-cc25 #
#                          30-coordinator\Projects\zstack\Samples\GenericApp\ #
#                          CC2530DB\..\..\..\..\..\Components\hal\include\    #
#                          -I D:\zigbee\projects\zstack-cc2530-coordinator\Pr #
#                          ojects\zstack\Samples\GenericApp\CC2530DB\..\..\.. #
#                          \..\..\Components\hal\target\CC2530EB\ -I          #
#                          D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\mac\include\ -I                     #
#                          D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\mac\high_level\ -I                  #
#                          D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\mac\low_level\srf04\ -I             #
#                          D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\mac\low_level\srf04\single_chip\    #
#                          -I D:\zigbee\projects\zstack-cc2530-coordinator\Pr #
#                          ojects\zstack\Samples\GenericApp\CC2530DB\..\..\.. #
#                          \..\..\Components\mt\ -I                           #
#                          D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\osal\include\ -I                    #
#                          D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\osal\mcu\ccsoc\ -I                  #
#                          D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\services\saddr\ -I                  #
#                          D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\services\sdata\ -I                  #
#                          D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\stack\af\ -I                        #
#                          D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\stack\nwk\ -I                       #
#                          D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\stack\sapi\ -I                      #
#                          D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\stack\sec\ -I                       #
#                          D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\stack\sys\ -I                       #
#                          D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\stack\zdo\ -I                       #
#                          D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\zmac\ -I D:\zigbee\projects\zstack- #
#                          cc2530-coordinator\Projects\zstack\Samples\Generic #
#                          App\CC2530DB\..\..\..\..\..\Components\zmac\f8w\   #
#                          -I "C:\Program Files (x86)\IAR Systems\Embedded    #
#                          Workbench 5.4\8051\INC\" -I "C:\Program Files      #
#                          (x86)\IAR Systems\Embedded Workbench               #
#                          5.4\8051\INC\CLIB\" -Ohz                           #
#    List file          =  D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\Coordinator #
#                          EB\List\stub_aps.lst                               #
#    Object file        =  D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\Coordinator #
#                          EB\Obj\stub_aps.r51                                #
#                                                                             #
#                                                                             #
###############################################################################

D:\zigbee\projects\zstack-cc2530-coordinator\Components\stack\nwk\stub_aps.c
      1          /**************************************************************************************************
      2            Filename:       stub_aps.c
      3            Revised:        $Date: 2008-1-04 13:13:13 -0700 (Fri, 04 Jan 2008) $
      4            Revision:       $Revision: 1 $
      5          
      6            Description:    Stub APS processing functions
      7          
      8          
      9            Copyright 2008 - 2009 Texas Instruments Incorporated. All rights reserved.
     10          
     11            IMPORTANT: Your use of this Software is limited to those specific rights
     12            granted under the terms of a software license agreement between the user
     13            who downloaded the software, his/her employer (which must be your employer)
     14            and Texas Instruments Incorporated (the "License").  You may not use this
     15            Software unless you agree to abide by the terms of the License. The License
     16            limits your use, and you acknowledge, that the Software may not be modified,
     17            copied or distributed unless embedded on a Texas Instruments microcontroller
     18            or used solely and exclusively in conjunction with a Texas Instruments radio
     19            frequency transceiver, which is integrated into your product.  Other than for
     20            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     21            works of, modify, distribute, perform, display or sell this Software and/or
     22            its documentation for any purpose.
     23          
     24            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     25            PROVIDED “AS IS” WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED,
     26            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE,
     27            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     28            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     29            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     30            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     31            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     32            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     33            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     34            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     35          
     36            Should you have any questions regarding your right to use this Software,
     37            contact Texas Instruments Incorporated at www.TI.com.
     38          **************************************************************************************************/
     39          
     40          /*********************************************************************
     41           * INCLUDES
     42           */
     43          #include "osal.h"
     44          #include "mac_spec.h"
     45          #include "nwk_util.h"
     46          #include "AF.h"
     47          
     48          #include "stub_aps.h"
     49          
     50          /*********************************************************************
     51           * MACROS
     52           */
     53          
     54          /*********************************************************************
     55           * CONSTANTS
     56           */
     57          
     58          // Stub NWK header length
     59          #define STUB_NWK_HDR_LEN                2
     60          
     61          // Start of the Stub APS header in the Inter-PAN frame
     62          #define STUB_APS_HDR_FRAME_CTRL         STUB_NWK_HDR_LEN
     63          
     64          // Stub APS event identifiers
     65          #define CHANNEL_CHANGE_EVT              0x0001
     66          
     67          #define CHANNEL_CHANGE_RETRY_TIMEOUT    100
     68          
     69          /*********************************************************************
     70           * TYPEDEFS
     71           */
     72          typedef struct
     73          {
     74            zAddrType_t addr;
     75            uint16 panId;
     76          } pan_t;
     77          
     78          /*********************************************************************
     79           * GLOBAL VARIABLES
     80           */
     81          

   \                                 In  segment XDATA_I, align 1, keep-with-next
     82          uint8 StubAPS_TaskID = 0xFF;    // Task ID for internal task/event processing
   \                     StubAPS_TaskID:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for StubAPS_TaskID>`
   \   000001                REQUIRE __INIT_XDATA_I
     83          
     84          /*********************************************************************
     85           * EXTERNAL VARIABLES
     86           */
     87          
     88          
     89          /*********************************************************************
     90           * EXTERNAL FUNCTIONS
     91           */
     92          
     93          
     94          /*********************************************************************
     95           * LOCAL VARIABLES
     96           */
     97          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
     98          static uint8 newChannel;
   \                     newChannel:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
     99          static uint8 channelChangeInProgress = FALSE;
   \                     channelChangeInProgress:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    100          
    101          // Application info

   \                                 In  segment XDATA_I, align 1, keep-with-next
    102          static uint8 appTaskID = 0xFF;  // Application task id
   \                     appTaskID:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for appTaskID>`
   \   000001                REQUIRE __INIT_XDATA_I

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    103          static uint8 appEndPoint = 0;   // Application endpoint
   \                     appEndPoint:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    104          
    105          
    106          /*********************************************************************
    107           * LOCAL FUNCTIONS
    108           */
    109          
    110          static void StubNWK_ParseMsg( uint8 *buf, uint8 bufLength, NLDE_FrameFormat_t *snff );
    111          static void StubAPS_ParseMsg( NLDE_FrameFormat_t *snff, aps_FrameFormat_t *saff );
    112          static void StubNWK_BuildMsg( uint8 *nwkHdr );
    113          static void StubAPS_BuildMsg( uint8 *apsHdr, uint8 frmCtrl, uint16 groupID, APSDE_DataReq_t *req );
    114          static ZStatus_t StubAPS_BuildFrameControl( uint8 *frmCtrl, zAddrType_t *dstAddr, 
    115                                                      uint16 *groupID, APSDE_DataReq_t *req );
    116          static ZStatus_t StubAPS_SetNewChannel( uint8 channel );
    117          static void StubAPS_NotifyApp( uint8 status );
    118          
    119          uint8 StubAPS_ZMacCallback( uint8 *msgPtr );
    120          
    121          /*********************************************************************
    122           * @fn      StubAPS_Init()
    123           *
    124           * @brief   Initialize stub APS layer
    125           *
    126           * @param   task_id - Task identifier for the desired task
    127           *
    128           * @return  none
    129           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    130          void StubAPS_Init( uint8 task_id )
   \                     StubAPS_Init:
    131          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    132            StubAPS_TaskID = task_id;
   \   000004   E9           MOV     A,R1
   \   000005   90....       MOV     DPTR,#StubAPS_TaskID
   \   000008   F0           MOVX    @DPTR,A
    133              
    134            // register with ZMAC
    135            pZMac_AppCallback = StubAPS_ZMacCallback;
   \   000009   90....       MOV     DPTR,#pZMac_AppCallback
   \   00000C   74..         MOV     A,#(??StubAPS_ZMacCallback?relay & 0xff)
   \   00000E   F0           MOVX    @DPTR,A
   \   00000F   A3           INC     DPTR
   \   000010   74..         MOV     A,#((??StubAPS_ZMacCallback?relay >> 8) & 0xff)
   \   000012   F0           MOVX    @DPTR,A
    136            
    137          } /* StubAPS_Init() */
   \   000013   02....       LJMP    ??Subroutine21_0 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine21_0:
   \   000000   D083         POP     DPH
   \   000002   D082         POP     DPL
   \   000004   02....       LJMP    ?BRET
    138          
    139          /*********************************************************************
    140           * @fn      StubAPS_ProcessEvent()
    141           *
    142           * @brief   Main event loop for Stub APS task. This function should be called
    143           *          at periodic intervals when event occur.
    144           *
    145           * @param   task_id - Task ID
    146           * @param   events  - Bitmap of events
    147           *
    148           * @return  none
    149           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    150          UINT16 StubAPS_ProcessEvent( uint8 task_id, uint16 events )
   \                     StubAPS_ProcessEvent:
    151          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 1
   \   000005   74FF         MOV     A,#-0x1
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   8A..         MOV     ?V0 + 0,R2
   \   00000C   8B..         MOV     ?V0 + 1,R3
    152            (void)task_id; // Intentionally unreferenced parameter
    153            
    154            if ( events & SYS_EVENT_MSG )
   \   00000E   7480         MOV     A,#-0x80
   \   000010   55..         ANL     A,?V0 + 1
   \   000012   F9           MOV     R1,A
   \   000013   E4           CLR     A
   \   000014   7001         JNZ     ??StubAPS_ProcessEvent_0
   \   000016   E9           MOV     A,R1
   \                     ??StubAPS_ProcessEvent_0:
   \   000017   704B         JNZ     ??StubAPS_ProcessEvent_1
    155            {
    156              osal_event_hdr_t *msg_ptr;
    157          
    158              while ( (msg_ptr = (osal_event_hdr_t *)osal_msg_receive( StubAPS_TaskID )) != NULL )
    159              {
    160                if ( msg_ptr->event == MAC_MCPS_DATA_CNF )
    161                {
    162                  INTERP_DataConfirm( (ZMacDataCnf_t *)msg_ptr );
    163                }
    164                else if ( msg_ptr->event == MAC_MCPS_DATA_IND )
    165                {
    166                  INTERP_DataIndication( (macMcpsDataInd_t *)msg_ptr );
    167                }
    168                
    169                osal_msg_deallocate( (uint8 *)msg_ptr );
    170              }
    171              
    172              // Return unproccessed events
    173              return ( events ^ SYS_EVENT_MSG );
    174            }
    175          
    176            if ( events & CHANNEL_CHANGE_EVT )
   \   000019   EA           MOV     A,R2
   \   00001A   A2E0         MOV     C,0xE0 /* A   */.0
   \   00001C   5073         JNC     ??StubAPS_ProcessEvent_2
    177            {
    178              // try to change to the new channel
    179              ZStatus_t status = StubAPS_SetNewChannel( newChannel );
   \   00001E                ; Setup parameters for call to function StubAPS_SetNewChannel
   \   00001E   90....       MOV     DPTR,#newChannel
   \   000021   E0           MOVX    A,@DPTR
   \   000022   F9           MOV     R1,A
   \   000023   12....       LCALL   ??StubAPS_SetNewChannel?relay
   \   000026   E9           MOV     A,R1
   \   000027   FE           MOV     R6,A
    180              if ( status != ZSuccess )
   \   000028   6003         JZ      ??CrossCallReturnLabel_0
    181              {
    182                // turn MAC receiver back on
    183                uint8 rxOnIdle = true;
   \   00002A   12....       LCALL   ?Subroutine4 & 0xFFFF
    184                ZMacSetReq( ZMacRxOnIdle, &rxOnIdle );
    185             
    186                // set NWK task to run
    187                nwk_setStateIdle( FALSE );
    188                
    189                channelChangeInProgress = FALSE;
    190              }
    191              
    192              // notify the application
    193              StubAPS_NotifyApp( status );
   \                     ??CrossCallReturnLabel_0:
   \   00002D                ; Setup parameters for call to function osal_msg_allocate
   \   00002D   7A02         MOV     R2,#0x2
   \   00002F   7B00         MOV     R3,#0x0
   \   000031   12....       LCALL   ??osal_msg_allocate?relay
   \   000034   EA           MOV     A,R2
   \   000035   7001         JNZ     ??StubAPS_ProcessEvent_3
   \   000037   EB           MOV     A,R3
   \                     ??StubAPS_ProcessEvent_3:
   \   000038   6012         JZ      ??StubAPS_ProcessEvent_4
   \   00003A   7433         MOV     A,#0x33
   \   00003C   8A82         MOV     DPL,R2
   \   00003E   8B83         MOV     DPH,R3
   \   000040   F0           MOVX    @DPTR,A
   \   000041   EE           MOV     A,R6
   \   000042   A3           INC     DPTR
   \   000043   F0           MOVX    @DPTR,A
   \   000044                ; Setup parameters for call to function osal_msg_send
   \   000044   90....       MOV     DPTR,#appTaskID
   \   000047   E0           MOVX    A,@DPTR
   \   000048   F9           MOV     R1,A
   \   000049   12....       LCALL   ??osal_msg_send?relay
    194              
    195              return ( events ^ CHANNEL_CHANGE_EVT );
   \                     ??StubAPS_ProcessEvent_4:
   \   00004C   7401         MOV     A,#0x1
   \   00004E   65..         XRL     A,?V0 + 0
   \   000050   FA           MOV     R2,A
   \   000051   AB..         MOV     R3,?V0 + 1
   \   000053   8040         SJMP    ??StubAPS_ProcessEvent_5
    196            }
   \                     ??StubAPS_ProcessEvent_6:
   \   000055   E0           MOVX    A,@DPTR
   \   000056   640D         XRL     A,#0xd
   \   000058   7003         JNZ     ??StubAPS_ProcessEvent_7
   \   00005A                ; Setup parameters for call to function INTERP_DataIndication
   \   00005A   12....       LCALL   ??INTERP_DataIndication?relay
   \                     ??StubAPS_ProcessEvent_7:
   \   00005D                ; Setup parameters for call to function osal_msg_deallocate
   \   00005D   EE           MOV     A,R6
   \   00005E   FA           MOV     R2,A
   \   00005F   EF           MOV     A,R7
   \   000060   FB           MOV     R3,A
   \   000061   12....       LCALL   ??osal_msg_deallocate?relay
   \                     ??StubAPS_ProcessEvent_1:
   \   000064                ; Setup parameters for call to function osal_msg_receive
   \   000064   90....       MOV     DPTR,#StubAPS_TaskID
   \   000067   E0           MOVX    A,@DPTR
   \   000068   F9           MOV     R1,A
   \   000069   12....       LCALL   ??osal_msg_receive?relay
   \   00006C   8A..         MOV     ?V0 + 2,R2
   \   00006E   8B..         MOV     ?V0 + 3,R3
   \   000070   AE..         MOV     R6,?V0 + 2
   \   000072   AF..         MOV     R7,?V0 + 3
   \   000074   EE           MOV     A,R6
   \   000075   7001         JNZ     ??StubAPS_ProcessEvent_8
   \   000077   EF           MOV     A,R7
   \                     ??StubAPS_ProcessEvent_8:
   \   000078   600E         JZ      ??StubAPS_ProcessEvent_9
   \   00007A   8E82         MOV     DPL,R6
   \   00007C   8F83         MOV     DPH,R7
   \   00007E   E0           MOVX    A,@DPTR
   \   00007F   640C         XRL     A,#0xc
   \   000081   70D2         JNZ     ??StubAPS_ProcessEvent_6
   \   000083                ; Setup parameters for call to function INTERP_DataConfirm
   \   000083   12....       LCALL   ??INTERP_DataConfirm?relay
   \   000086   80D5         SJMP    ??StubAPS_ProcessEvent_7
   \                     ??StubAPS_ProcessEvent_9:
   \   000088   AA..         MOV     R2,?V0 + 0
   \   00008A   7480         MOV     A,#-0x80
   \   00008C   65..         XRL     A,?V0 + 1
   \   00008E   FB           MOV     R3,A
   \   00008F   8004         SJMP    ??StubAPS_ProcessEvent_5
    197            
    198            // If reach here, the events are unknown
    199            // Discard or make more handlers
    200            return 0;
   \                     ??StubAPS_ProcessEvent_2:
   \   000091   7A00         MOV     R2,#0x0
   \   000093   7B00         MOV     R3,#0x0
   \                     ??StubAPS_ProcessEvent_5:
   \   000095   7401         MOV     A,#0x1
   \   000097   12....       LCALL   ?DEALLOC_XSTACK8
   \   00009A   7F04         MOV     R7,#0x4
   \   00009C   02....       LJMP    ?BANKED_LEAVE_XDATA
    201          
    202          } /* StubAPS_ProcessEvent() */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine17:
   \   000000   85..82       MOV     DPL,?XSP + 0
   \   000003   85..83       MOV     DPH,?XSP + 1
   \   000006   F0           MOVX    @DPTR,A
   \   000007                ; Setup parameters for call to function ZMacSetReq
   \   000007                ; Setup parameters for call to function ZMacSetReq
   \   000007                ; Setup parameters for call to function ZMacSetReq
   \   000007                ; Setup parameters for call to function ZMacSetReq
   \   000007                ; Setup parameters for call to function ZMacSetReq
   \   000007   AA82         MOV     R2,DPL
   \   000009   AB83         MOV     R3,DPH
   \   00000B   7952         MOV     R1,#0x52
   \   00000D   12....       LCALL   ??ZMacSetReq?relay
   \   000010   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine4:
   \   000000   7401         MOV     A,#0x1
   \   000002   12....       LCALL   ?Subroutine17 & 0xFFFF
   \                     ??CrossCallReturnLabel_36:
   \   000005                ; Setup parameters for call to function nwk_setStateIdle
   \   000005                ; Setup parameters for call to function nwk_setStateIdle
   \   000005   7900         MOV     R1,#0x0
   \   000007   12....       LCALL   ??nwk_setStateIdle?relay
   \   00000A   E4           CLR     A
   \   00000B   90....       MOV     DPTR,#channelChangeInProgress
   \   00000E   F0           MOVX    @DPTR,A
   \   00000F   22           RET
    203          
    204          
    205          /*********************************************************************
    206           * @fn          StubNWK_ParseMsg
    207           *
    208           * @brief       Call this function to parse an incoming Stub NWK frame.
    209           *
    210           * @param       buf - pointer incoming message buffer
    211           * @param       bufLength - length of incoming message
    212           * @param       snff  - pointer Frame Format Parameters
    213           *
    214           * @return      pointer to network packet, NULL if error
    215           */
    216          static void StubNWK_ParseMsg( uint8 *buf, uint8 bufLength, NLDE_FrameFormat_t *snff )
    217          {
    218            uint16 fc;
    219          
    220            osal_memset( snff, 0, sizeof(NLDE_FrameFormat_t) );
    221            
    222            snff->bufLength = bufLength;
    223          
    224            // get the frame control
    225            fc = BUILD_UINT16( buf[NWK_HDR_FRAME_CTRL_LSB], buf[NWK_HDR_FRAME_CTRL_MSB] );
    226            
    227            // parse the frame control
    228            NLDE_ParseFrameControl( fc, snff );
    229            
    230            snff->hdrLen = STUB_NWK_HDR_LEN;
    231            
    232            // Stub NWK payload
    233            snff->nsdu = buf + snff->hdrLen;
    234            snff->nsduLength = snff->bufLength - snff->hdrLen;
    235          
    236          } /* StubNWK_ParseMsg */
    237          
    238          /*********************************************************************
    239           * @fn          StubAPS_ParseMsg
    240           *
    241           * @brief       Call this function to parse an incoming Stub APS frame.
    242           *
    243           * @param       naff  - pointer Stub NWK Frame Format Parameters
    244           * @param       saff  - pointer Stub APS Format Parameters
    245           *
    246           * @return      none
    247           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    248          static void StubAPS_ParseMsg( NLDE_FrameFormat_t *snff, aps_FrameFormat_t *saff )
   \                     StubAPS_ParseMsg:
    249          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   \   000005   8A..         MOV     ?V0 + 0,R2
   \   000007   8B..         MOV     ?V0 + 1,R3
   \   000009   EC           MOV     A,R4
   \   00000A   FE           MOV     R6,A
   \   00000B   ED           MOV     A,R5
   \   00000C   FF           MOV     R7,A
    250            uint8 fcb;
    251            uint8 *asdu;
    252            
    253            osal_memset( saff, 0, sizeof(aps_FrameFormat_t) );
   \   00000D                ; Setup parameters for call to function osal_memset
   \   00000D   7C15         MOV     R4,#0x15
   \   00000F   7D00         MOV     R5,#0x0
   \   000011   7900         MOV     R1,#0x0
   \   000013   EE           MOV     A,R6
   \   000014   FA           MOV     R2,A
   \   000015   EF           MOV     A,R7
   \   000016   FB           MOV     R3,A
   \   000017   12....       LCALL   ??osal_memset?relay
    254            
    255            saff->asduLength = snff->nsduLength;
   \   00001A   12....       LCALL   ?Subroutine13 & 0xFFFF
   \                     ??CrossCallReturnLabel_17:
   \   00001D   C0E0         PUSH    A
   \   00001F   EE           MOV     A,R6
   \   000020   2410         ADD     A,#0x10
   \   000022   12....       LCALL   ??Subroutine19_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_24:
   \   000025   D0E0         POP     A
   \   000027   F0           MOVX    @DPTR,A
    256            asdu = snff->nsdu;
   \   000028   E5..         MOV     A,?V0 + 0
   \   00002A   241D         ADD     A,#0x1d
   \   00002C   F582         MOV     DPL,A
   \   00002E   E5..         MOV     A,?V0 + 1
   \   000030   12....       LCALL   ?Subroutine8 & 0xFFFF
    257            saff->macDestAddr = snff->macDstAddr;
   \                     ??CrossCallReturnLabel_49:
   \   000033   E5..         MOV     A,?V0 + 0
   \   000035   240D         ADD     A,#0xd
   \   000037   F582         MOV     DPL,A
   \   000039   E5..         MOV     A,?V0 + 1
   \   00003B   12....       LCALL   ?Subroutine14 & 0xFFFF
   \                     ??CrossCallReturnLabel_19:
   \   00003E   8E82         MOV     DPL,R6
   \   000040   8F83         MOV     DPH,R7
   \   000042   A3           INC     DPTR
   \   000043   A3           INC     DPTR
   \   000044   A3           INC     DPTR
   \   000045   A3           INC     DPTR
   \   000046   A3           INC     DPTR
   \   000047   A3           INC     DPTR
   \   000048   A3           INC     DPTR
   \   000049   A3           INC     DPTR
   \   00004A   A3           INC     DPTR
   \   00004B   A3           INC     DPTR
   \   00004C   EA           MOV     A,R2
   \   00004D   F0           MOVX    @DPTR,A
   \   00004E   A3           INC     DPTR
   \   00004F   EB           MOV     A,R3
   \   000050   F0           MOVX    @DPTR,A
    258            
    259            // First byte is Frame Control.
    260            saff->FrmCtrl = *asdu++;
   \   000051   8882         MOV     DPL,R0
   \   000053   8983         MOV     DPH,R1
   \   000055   E0           MOVX    A,@DPTR
   \   000056   FA           MOV     R2,A
   \   000057   8E82         MOV     DPL,R6
   \   000059   8F83         MOV     DPH,R7
   \   00005B   F0           MOVX    @DPTR,A
   \   00005C   8882         MOV     DPL,R0
   \   00005E   8983         MOV     DPH,R1
   \   000060   A3           INC     DPTR
   \   000061   A882         MOV     R0,DPL
   \   000063   A983         MOV     R1,DPH
    261          
    262            fcb = saff->FrmCtrl & APS_FRAME_TYPE_MASK;
    263            if ( fcb == STUB_APS_FRAME )
   \   000065   7403         MOV     A,#0x3
   \   000067   5A           ANL     A,R2
   \   000068   6403         XRL     A,#0x3
   \   00006A   7033         JNZ     ??CrossCallReturnLabel_22
    264            {
    265              fcb = saff->FrmCtrl & APS_DELIVERYMODE_MASK;
   \   00006C   8E82         MOV     DPL,R6
   \   00006E   8F83         MOV     DPH,R7
   \   000070   E0           MOVX    A,@DPTR
   \   000071   540C         ANL     A,#0xc
   \   000073   FA           MOV     R2,A
    266              if ( fcb == APS_FC_DM_BROADCAST )
   \   000074   7408         MOV     A,#0x8
   \   000076   6A           XRL     A,R2
   \   000077   7008         JNZ     ??StubAPS_ParseMsg_0
    267                saff->wasBroadcast = true;
   \   000079   12....       LCALL   ?Subroutine16 & 0xFFFF
   \                     ??CrossCallReturnLabel_30:
   \   00007C   7401         MOV     A,#0x1
   \   00007E   F0           MOVX    @DPTR,A
   \   00007F   8010         SJMP    ??CrossCallReturnLabel_23
    268              else
    269                saff->wasBroadcast = false;
   \                     ??StubAPS_ParseMsg_0:
   \   000081   12....       LCALL   ?Subroutine16 & 0xFFFF
   \                     ??CrossCallReturnLabel_31:
   \   000084   E4           CLR     A
   \   000085   F0           MOVX    @DPTR,A
    270              
    271              if ( fcb == APS_FC_DM_GROUP )
   \   000086   740C         MOV     A,#0xc
   \   000088   6A           XRL     A,R2
   \   000089   7006         JNZ     ??CrossCallReturnLabel_23
    272              {
    273                saff->GroupID = BUILD_UINT16( asdu[0], asdu[1] );
   \   00008B   12....       LCALL   ?Subroutine7 & 0xFFFF
    274                asdu += sizeof( uint16 );
    275              }
   \                     ??CrossCallReturnLabel_4:
   \   00008E   12....       LCALL   ??Subroutine18_0 & 0xFFFF
    276              
    277              // Pull out the Cluster ID
    278              saff->ClusterID = BUILD_UINT16( asdu[0], asdu[1] );
   \                     ??CrossCallReturnLabel_23:
   \   000091   12....       LCALL   ?Subroutine7 & 0xFFFF
   \                     ??CrossCallReturnLabel_5:
   \   000094   12....       LCALL   ?Subroutine3 & 0xFFFF
    279              asdu += sizeof( uint16 );
    280          
    281              // Pull out the profile ID
    282              saff->ProfileID = BUILD_UINT16( asdu[0], asdu[1] );
   \                     ??CrossCallReturnLabel_21:
   \   000097   12....       LCALL   ?Subroutine7 & 0xFFFF
    283              asdu += 2;
    284            }
   \                     ??CrossCallReturnLabel_6:
   \   00009A   A3           INC     DPTR
   \   00009B   A3           INC     DPTR
   \   00009C   12....       LCALL   ?Subroutine3 & 0xFFFF
    285            
    286            saff->asdu = asdu;
   \                     ??CrossCallReturnLabel_22:
   \   00009F   EE           MOV     A,R6
   \   0000A0   240E         ADD     A,#0xe
   \   0000A2   12....       LCALL   ??Subroutine19_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_25:
   \   0000A5   E8           MOV     A,R0
   \   0000A6   F0           MOVX    @DPTR,A
   \   0000A7   A3           INC     DPTR
   \   0000A8   E9           MOV     A,R1
   \   0000A9   F0           MOVX    @DPTR,A
   \   0000AA   EE           MOV     A,R6
   \   0000AB   2410         ADD     A,#0x10
   \   0000AD   FA           MOV     R2,A
   \   0000AE   EF           MOV     A,R7
   \   0000AF   3400         ADDC    A,#0x0
   \   0000B1   FB           MOV     R3,A
   \   0000B2   E5..         MOV     A,?V0 + 0
   \   0000B4   241D         ADD     A,#0x1d
   \   0000B6   F582         MOV     DPL,A
   \   0000B8   E5..         MOV     A,?V0 + 1
   \   0000BA   12....       LCALL   ??Subroutine22_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_37:
   \   0000BD   FC           MOV     R4,A
   \   0000BE   8A82         MOV     DPL,R2
   \   0000C0   8B83         MOV     DPH,R3
   \   0000C2   E0           MOVX    A,@DPTR
   \   0000C3   C3           CLR     C
   \   0000C4   98           SUBB    A,R0
   \   0000C5   2C           ADD     A,R4
   \   0000C6   FC           MOV     R4,A
   \   0000C7   F0           MOVX    @DPTR,A
    287            saff->asduLength -= (uint8) (asdu - snff->nsdu);
    288            saff->apsHdrLen = snff->nsduLength - saff->asduLength;
   \   0000C8   12....       LCALL   ?Subroutine13 & 0xFFFF
   \                     ??CrossCallReturnLabel_18:
   \   0000CB   C3           CLR     C
   \   0000CC   9C           SUBB    A,R4
   \   0000CD   C0E0         PUSH    A
   \   0000CF   EE           MOV     A,R6
   \   0000D0   240D         ADD     A,#0xd
   \   0000D2   12....       LCALL   ??Subroutine19_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_26:
   \   0000D5   D0E0         POP     A
   \   0000D7   F0           MOVX    @DPTR,A
    289            
    290          } /* StubAPS_ParseMsg */
   \   0000D8   7F02         MOV     R7,#0x2
   \   0000DA   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine13:
   \   000000   E5..         MOV     A,?V0 + 0
   \   000002   2417         ADD     A,#0x17
   \   000004   F582         MOV     DPL,A
   \   000006   E5..         MOV     A,?V0 + 1
   \   000008   3400         ADDC    A,#0x0
   \   00000A   F583         MOV     DPH,A
   \   00000C   E0           MOVX    A,@DPTR
   \   00000D   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine7:
   \   000000   8882         MOV     DPL,R0
   \   000002   8983         MOV     DPH,R1
   \   000004   E0           MOVX    A,@DPTR
   \   000005   FC           MOV     R4,A
   \   000006   A3           INC     DPTR
   \   000007   E0           MOVX    A,@DPTR
   \   000008   FB           MOV     R3,A
   \   000009   EC           MOV     A,R4
   \   00000A   8E82         MOV     DPL,R6
   \   00000C   8F83         MOV     DPH,R7
   \   00000E   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine3:
   \   000000   A3           INC     DPTR
   \   000001   A3           INC     DPTR
   \   000002                REQUIRE ??Subroutine18_0
   \   000002                ; // Fall through to label ??Subroutine18_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine18_0:
   \   000000   A3           INC     DPTR
   \   000001   A3           INC     DPTR
   \   000002   A3           INC     DPTR
   \   000003   A3           INC     DPTR
   \   000004   F0           MOVX    @DPTR,A
   \   000005   A3           INC     DPTR
   \   000006   EB           MOV     A,R3
   \   000007   F0           MOVX    @DPTR,A
   \   000008   E8           MOV     A,R0
   \   000009   2402         ADD     A,#0x2
   \   00000B   08           INC     R0
   \   00000C   08           INC     R0
   \   00000D   E9           MOV     A,R1
   \   00000E   3400         ADDC    A,#0x0
   \   000010   F9           MOV     R1,A
   \   000011   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine16:
   \   000000   EE           MOV     A,R6
   \   000001   240C         ADD     A,#0xc
   \   000003                REQUIRE ??Subroutine19_0
   \   000003                ; // Fall through to label ??Subroutine19_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine19_0:
   \   000000   F582         MOV     DPL,A
   \   000002   EF           MOV     A,R7
   \   000003   3400         ADDC    A,#0x0
   \   000005   F583         MOV     DPH,A
   \   000007   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine22_0:
   \   000000   3400         ADDC    A,#0x0
   \   000002   F583         MOV     DPH,A
   \   000004   E0           MOVX    A,@DPTR
   \   000005   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine14:
   \   000000   3400         ADDC    A,#0x0
   \   000002   F583         MOV     DPH,A
   \   000004   E0           MOVX    A,@DPTR
   \   000005   FA           MOV     R2,A
   \   000006   A3           INC     DPTR
   \   000007   E0           MOVX    A,@DPTR
   \   000008   FB           MOV     R3,A
   \   000009   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine8:
   \   000000   3400         ADDC    A,#0x0
   \   000002   F583         MOV     DPH,A
   \   000004                REQUIRE ??Subroutine23_0
   \   000004                ; // Fall through to label ??Subroutine23_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine23_0:
   \   000000   E0           MOVX    A,@DPTR
   \   000001   F8           MOV     R0,A
   \   000002   A3           INC     DPTR
   \   000003   E0           MOVX    A,@DPTR
   \   000004   F9           MOV     R1,A
   \   000005   22           RET
    291          
    292          /******************************************************************************
    293           * @fn          StubAPS_BuildFrameControl
    294           *
    295           * @brief       This function builds Stub APS Frame Control and the destination
    296           *              address parameter for the MCPS-DATA Request.
    297           *
    298           * @param       frmCtrl - frame control
    299           * @param       dstAddr - destination address for MCPS-DATA Request
    300           * @param       groupID - group id
    301           * @param       req - APSDE_DataReq_t
    302           *
    303           * @return      ZStatus_t
    304           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    305          static ZStatus_t StubAPS_BuildFrameControl( uint8 *frmCtrl, zAddrType_t *dstAddr, 
   \                     StubAPS_BuildFrameControl:
    306                                                      uint16 *groupID, APSDE_DataReq_t *req )
    307          { 
   \   000000   74F5         MOV     A,#-0xb
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 11
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   F8           MOV     R0,A
   \   000007   EB           MOV     A,R3
   \   000008   F9           MOV     R1,A
   \   000009   EC           MOV     A,R4
   \   00000A   FA           MOV     R2,A
   \   00000B   ED           MOV     A,R5
   \   00000C   FB           MOV     R3,A
   \   00000D   740B         MOV     A,#0xb
   \   00000F   12....       LCALL   ?XSTACK_DISP0_8
   \   000012   12....       LCALL   ?Subroutine10 & 0xFFFF
   \                     ??CrossCallReturnLabel_9:
   \   000015   EC           MOV     A,R4
   \   000016   FE           MOV     R6,A
   \   000017   ED           MOV     A,R5
   \   000018   FF           MOV     R7,A
   \   000019   740D         MOV     A,#0xd
   \   00001B   12....       LCALL   ?XSTACK_DISP0_8
   \   00001E   12....       LCALL   ?Subroutine10 & 0xFFFF
    308            // Security
    309            if ( req->txOptions & APS_TX_OPTIONS_SECURITY_ENABLE )
   \                     ??CrossCallReturnLabel_10:
   \   000021   EC           MOV     A,R4
   \   000022   2415         ADD     A,#0x15
   \   000024   F582         MOV     DPL,A
   \   000026   ED           MOV     A,R5
   \   000027   12....       LCALL   ??Subroutine22_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_38:
   \   00002A   A2E0         MOV     C,0xE0 /* A   */.0
   \   00002C   5005         JNC     ??StubAPS_BuildFrameControl_0
    310              return ( ZApsNotSupported );
   \                     ??StubAPS_BuildFrameControl_1:
   \   00002E   79B6         MOV     R1,#-0x4a
   \   000030   02....       LJMP    ??StubAPS_BuildFrameControl_2 & 0xFFFF
    311              
    312            // Ack request
    313            if ( req->txOptions & APS_TX_OPTIONS_ACK )
   \                     ??StubAPS_BuildFrameControl_0:
   \   000033   5404         ANL     A,#0x4
   \   000035   70F7         JNZ     ??StubAPS_BuildFrameControl_1
    314              return ( ZApsNotSupported );
    315            
    316             // Fragmentation
    317            if ( req->txOptions & APS_TX_OPTIONS_PERMIT_FRAGMENT )
   \   000037   E0           MOVX    A,@DPTR
   \   000038   5408         ANL     A,#0x8
   \   00003A   70F2         JNZ     ??StubAPS_BuildFrameControl_1
    318              return ( ZApsNotSupported );
    319            
    320            // set delivery mode
    321            if ( req->dstAddr.addrMode == AddrNotPresent )
   \   00003C   8C82         MOV     DPL,R4
   \   00003E   8D83         MOV     DPH,R5
   \   000040   A3           INC     DPTR
   \   000041   A3           INC     DPTR
   \   000042   A3           INC     DPTR
   \   000043   A3           INC     DPTR
   \   000044   A3           INC     DPTR
   \   000045   A3           INC     DPTR
   \   000046   A3           INC     DPTR
   \   000047   A3           INC     DPTR
   \   000048   E0           MOVX    A,@DPTR
   \   000049   60E3         JZ      ??StubAPS_BuildFrameControl_1
    322              return ( ZApsNotSupported ); // No REFLECTOR
    323          
    324            // set frame type
    325            *frmCtrl = STUB_APS_FRAME;
   \   00004B   7403         MOV     A,#0x3
   \   00004D   8882         MOV     DPL,R0
   \   00004F   8983         MOV     DPH,R1
   \   000051   F0           MOVX    @DPTR,A
    326            
    327            // set DstAddrMode of MCPS-DATA Request to DstAddrMode of INTERP-Data Request
    328            dstAddr->addrMode = req->dstAddr.addrMode;
   \   000052   EC           MOV     A,R4
   \   000053   2408         ADD     A,#0x8
   \   000055   F5..         MOV     ?V0 + 0,A
   \   000057   ED           MOV     A,R5
   \   000058   3400         ADDC    A,#0x0
   \   00005A   F5..         MOV     ?V0 + 1,A
   \   00005C   85..82       MOV     DPL,?V0 + 0
   \   00005F   F583         MOV     DPH,A
   \   000061   E0           MOVX    A,@DPTR
   \   000062   8A82         MOV     DPL,R2
   \   000064   8B83         MOV     DPH,R3
   \   000066   A3           INC     DPTR
   \   000067   A3           INC     DPTR
   \   000068   A3           INC     DPTR
   \   000069   A3           INC     DPTR
   \   00006A   A3           INC     DPTR
   \   00006B   A3           INC     DPTR
   \   00006C   A3           INC     DPTR
   \   00006D   A3           INC     DPTR
   \   00006E   F0           MOVX    @DPTR,A
    329          
    330            // set DstAddr of MCPS-DATA Request to DstAddr of INTERP-Data Request
    331            if ( req->dstAddr.addrMode == AddrBroadcast )
   \   00006F   85..82       MOV     DPL,?V0 + 0
   \   000072   85..83       MOV     DPH,?V0 + 1
   \   000075   E0           MOVX    A,@DPTR
   \   000076   640F         XRL     A,#0xf
   \   000078   7017         JNZ     ??StubAPS_BuildFrameControl_3
    332            {
    333              *frmCtrl |= APS_FC_DM_BROADCAST;
   \   00007A   8882         MOV     DPL,R0
   \   00007C   8983         MOV     DPH,R1
   \   00007E   E0           MOVX    A,@DPTR
   \   00007F   D2E3         SETB    0xE0 /* A   */.3
   \   000081   12....       LCALL   ?Subroutine6 & 0xFFFF
    334              
    335              // set DstAddrMode of MCPS-DATA Request to short address
    336              dstAddr->addrMode = Addr16Bit;
    337              dstAddr->addr.shortAddr = req->dstAddr.addr.shortAddr;
   \                     ??CrossCallReturnLabel_2:
   \   000084   8C82         MOV     DPL,R4
   \   000086   8D83         MOV     DPH,R5
    338            }
   \                     ??StubAPS_BuildFrameControl_4:
   \   000088   12....       LCALL   ??Subroutine23_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_45:
   \   00008B   8A82         MOV     DPL,R2
   \   00008D   8B83         MOV     DPH,R3
   \   00008F   8056         SJMP    ??StubAPS_BuildFrameControl_5
    339            else if ( req->dstAddr.addrMode == Addr16Bit )
   \                     ??StubAPS_BuildFrameControl_3:
   \   000091   8C82         MOV     DPL,R4
   \   000093   8D83         MOV     DPH,R5
   \   000095   A3           INC     DPTR
   \   000096   A3           INC     DPTR
   \   000097   A3           INC     DPTR
   \   000098   A3           INC     DPTR
   \   000099   A3           INC     DPTR
   \   00009A   A3           INC     DPTR
   \   00009B   A3           INC     DPTR
   \   00009C   A3           INC     DPTR
   \   00009D   E0           MOVX    A,@DPTR
   \   00009E   6402         XRL     A,#0x2
   \   0000A0   8C82         MOV     DPL,R4
   \   0000A2   8D83         MOV     DPH,R5
   \   0000A4   60E2         JZ      ??StubAPS_BuildFrameControl_4
    340            {
    341              *frmCtrl |= APS_FC_DM_UNICAST;
    342              dstAddr->addr.shortAddr = req->dstAddr.addr.shortAddr;
    343            }
    344            else if ( req->dstAddr.addrMode == Addr64Bit )
   \   0000A6   A3           INC     DPTR
   \   0000A7   A3           INC     DPTR
   \   0000A8   A3           INC     DPTR
   \   0000A9   A3           INC     DPTR
   \   0000AA   A3           INC     DPTR
   \   0000AB   A3           INC     DPTR
   \   0000AC   A3           INC     DPTR
   \   0000AD   A3           INC     DPTR
   \   0000AE   E0           MOVX    A,@DPTR
   \   0000AF   6403         XRL     A,#0x3
   \   0000B1   7005         JNZ     ??StubAPS_BuildFrameControl_6
    345            {
    346              *frmCtrl |= APS_FC_DM_UNICAST;
    347              osal_cpyExtAddr( dstAddr->addr.extAddr, req->dstAddr.addr.extAddr );
   \   0000B3                ; Setup parameters for call to function sAddrExtCpy
   \   0000B3   12....       LCALL   ??sAddrExtCpy?relay
   \   0000B6   8034         SJMP    ??StubAPS_BuildFrameControl_7
    348            }
    349            else if ( req->dstAddr.addrMode == AddrGroup )
   \                     ??StubAPS_BuildFrameControl_6:
   \   0000B8   8C82         MOV     DPL,R4
   \   0000BA   8D83         MOV     DPH,R5
   \   0000BC   A3           INC     DPTR
   \   0000BD   A3           INC     DPTR
   \   0000BE   A3           INC     DPTR
   \   0000BF   A3           INC     DPTR
   \   0000C0   A3           INC     DPTR
   \   0000C1   A3           INC     DPTR
   \   0000C2   A3           INC     DPTR
   \   0000C3   A3           INC     DPTR
   \   0000C4   E0           MOVX    A,@DPTR
   \   0000C5   6401         XRL     A,#0x1
   \   0000C7   7023         JNZ     ??StubAPS_BuildFrameControl_7
    350            {
    351              *frmCtrl |= APS_FC_DM_GROUP;
   \   0000C9   8882         MOV     DPL,R0
   \   0000CB   8983         MOV     DPH,R1
   \   0000CD   E0           MOVX    A,@DPTR
   \   0000CE   440C         ORL     A,#0xc
   \   0000D0   12....       LCALL   ?Subroutine6 & 0xFFFF
    352              
    353              // set DstAddrMode of MCPS-DATA Request to short address
    354              dstAddr->addrMode = Addr16Bit;
    355              
    356              // set DstAddr of MCPS-DATA Request to 0xFFFF
    357              dstAddr->addr.shortAddr = NWK_BROADCAST_SHORTADDR_DEVALL;
   \                     ??CrossCallReturnLabel_3:
   \   0000D3   8A82         MOV     DPL,R2
   \   0000D5   8B83         MOV     DPH,R3
   \   0000D7   74FF         MOV     A,#-0x1
   \   0000D9   F0           MOVX    @DPTR,A
   \   0000DA   A3           INC     DPTR
   \   0000DB   F0           MOVX    @DPTR,A
    358              
    359              // set Group ID to DstAddr of INTERP-Data Request
    360              *groupID = req->dstAddr.addr.shortAddr;
   \   0000DC   8C82         MOV     DPL,R4
   \   0000DE   8D83         MOV     DPH,R5
   \   0000E0   12....       LCALL   ??Subroutine23_0 & 0xFFFF
    361            }
   \                     ??CrossCallReturnLabel_46:
   \   0000E3   8E82         MOV     DPL,R6
   \   0000E5   8F83         MOV     DPH,R7
   \                     ??StubAPS_BuildFrameControl_5:
   \   0000E7   E8           MOV     A,R0
   \   0000E8   F0           MOVX    @DPTR,A
   \   0000E9   A3           INC     DPTR
   \   0000EA   E9           MOV     A,R1
   \   0000EB   F0           MOVX    @DPTR,A
    362            
    363            return ( ZSuccess );
   \                     ??StubAPS_BuildFrameControl_7:
   \   0000EC   7900         MOV     R1,#0x0
   \                     ??StubAPS_BuildFrameControl_2:
   \   0000EE                REQUIRE ?Subroutine1
   \   0000EE                ; // Fall through to label ?Subroutine1
    364            
    365          } /* StubAPS_BuildFrameControl */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine1:
   \   000000   7F03         MOV     R7,#0x3
   \   000002   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine6:
   \   000000   F0           MOVX    @DPTR,A
   \   000001   7402         MOV     A,#0x2
   \   000003   8A82         MOV     DPL,R2
   \   000005   8B83         MOV     DPH,R3
   \   000007   A3           INC     DPTR
   \   000008   A3           INC     DPTR
   \   000009   A3           INC     DPTR
   \   00000A   A3           INC     DPTR
   \   00000B   A3           INC     DPTR
   \   00000C   A3           INC     DPTR
   \   00000D   A3           INC     DPTR
   \   00000E   A3           INC     DPTR
   \   00000F   F0           MOVX    @DPTR,A
   \   000010   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine10:
   \   000000   E0           MOVX    A,@DPTR
   \   000001   FC           MOV     R4,A
   \   000002   A3           INC     DPTR
   \   000003   E0           MOVX    A,@DPTR
   \   000004   FD           MOV     R5,A
   \   000005   22           RET
    366          
    367          /******************************************************************************
    368           * @fn          StubNWK_BuildMsg
    369           *
    370           * @brief       This function builds a Stub NWK frame.
    371           *
    372           * @param       nwkHdr - stub NWK header
    373           *
    374           * @return      none
    375           */
    376          static void StubNWK_BuildMsg( uint8 *nwkHdr )
    377          {
    378            uint16 frmCtrl = 0;
    379            uint8  protoVer = NLME_GetProtocolVersion();
    380          
    381            // frame type
    382            frmCtrl |= (STUB_NWK_FRAME_TYPE << NWK_FC_FRAME_TYPE);
    383          
    384            // protocol version
    385            frmCtrl |= (protoVer << NWK_FC_PROT_VERSION);
    386            
    387            // set Stub NWK header
    388            *nwkHdr++ = LO_UINT16( frmCtrl );
    389            *nwkHdr++ = HI_UINT16( frmCtrl );
    390            
    391          } /* StubNWK_BuildMsg */
    392          
    393          /******************************************************************************
    394           * @fn          StubAPS_BuildMsg
    395           *
    396           * @brief       This function builds a Stub APS frame.
    397           *
    398           * @param       apsHdr - stub APS header
    399           * @param       frmCtrl - stub APS frame control
    400           * @param       groupID - group id
    401           * @param       req - APSDE_DataReq_t
    402           *
    403           * @return      none
    404           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    405          static void StubAPS_BuildMsg( uint8 *apsHdr, uint8 frmCtrl, uint16 groupID, APSDE_DataReq_t *req )
   \                     StubAPS_BuildMsg:
    406          {
   \   000000   74F1         MOV     A,#-0xf
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 15
   \   000005                ; Auto size: 0
   \   000005   89..         MOV     ?V0 + 0,R1
   \   000007   740F         MOV     A,#0xf
   \   000009   12....       LCALL   ?XSTACK_DISP0_8
   \   00000C   E0           MOVX    A,@DPTR
   \   00000D   FE           MOV     R6,A
   \   00000E   A3           INC     DPTR
   \   00000F   E0           MOVX    A,@DPTR
   \   000010   FF           MOV     R7,A
    407            // add frame type
    408            *apsHdr++ = frmCtrl;
   \   000011   8A82         MOV     DPL,R2
   \   000013   8B83         MOV     DPH,R3
   \   000015   E9           MOV     A,R1
   \   000016   F0           MOVX    @DPTR,A
   \   000017   A3           INC     DPTR
   \   000018   AA82         MOV     R2,DPL
   \   00001A   AB83         MOV     R3,DPH
    409              
    410            // add Group ID
    411            if ( ( frmCtrl & APS_DELIVERYMODE_MASK ) == APS_FC_DM_GROUP )
   \   00001C   740C         MOV     A,#0xc
   \   00001E   55..         ANL     A,?V0 + 0
   \   000020   640C         XRL     A,#0xc
   \   000022   700A         JNZ     ??StubAPS_BuildMsg_0
    412            {
    413              *apsHdr++ = LO_UINT16( groupID );
   \   000024   EC           MOV     A,R4
   \   000025   F0           MOVX    @DPTR,A
   \   000026   A3           INC     DPTR
    414              *apsHdr++ = HI_UINT16( groupID );
   \   000027   ED           MOV     A,R5
   \   000028   F0           MOVX    @DPTR,A
   \   000029   A3           INC     DPTR
   \   00002A   0A           INC     R2
   \   00002B   0A           INC     R2
   \   00002C   AB83         MOV     R3,DPH
    415            }
    416          
    417            // add clusterID
    418            *apsHdr++ = LO_UINT16( req->clusterID );
   \                     ??StubAPS_BuildMsg_0:
   \   00002E   EE           MOV     A,R6
   \   00002F   240D         ADD     A,#0xd
   \   000031   F8           MOV     R0,A
   \   000032   12....       LCALL   ?Subroutine12 & 0xFFFF
   \                     ??CrossCallReturnLabel_15:
   \   000035   AA82         MOV     R2,DPL
   \   000037   12....       LCALL   ?Subroutine9 & 0xFFFF
    419            *apsHdr++ = HI_UINT16( req->clusterID );
    420            
    421            // add profile ID
    422            *apsHdr++ = LO_UINT16( req->profileID );
   \                     ??CrossCallReturnLabel_7:
   \   00003A   240F         ADD     A,#0xf
   \   00003C   08           INC     R0
   \   00003D   08           INC     R0
   \   00003E   12....       LCALL   ?Subroutine12 & 0xFFFF
   \                     ??CrossCallReturnLabel_16:
   \   000041   0A           INC     R2
   \   000042   12....       LCALL   ?Subroutine9 & 0xFFFF
    423            *apsHdr++ = HI_UINT16( req->profileID );
    424              
    425            // copy ASDU data into frame
    426            osal_memcpy ( apsHdr, req->asdu, req->asduLen );
   \                     ??CrossCallReturnLabel_8:
   \   000045   2413         ADD     A,#0x13
   \   000047   12....       LCALL   ?Subroutine15 & 0xFFFF
   \                     ??CrossCallReturnLabel_41:
   \   00004A   F5..         MOV     ?V0 + 4,A
   \   00004C   A3           INC     DPTR
   \   00004D   E0           MOVX    A,@DPTR
   \   00004E   F5..         MOV     ?V0 + 5,A
   \   000050   75..00       MOV     ?V0 + 6,#0x0
   \   000053   78..         MOV     R0,#?V0 + 4
   \   000055   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   000058   EE           MOV     A,R6
   \   000059   2411         ADD     A,#0x11
   \   00005B   12....       LCALL   ??Subroutine19_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_27:
   \   00005E   12....       LCALL   ?Subroutine10 & 0xFFFF
   \                     ??CrossCallReturnLabel_11:
   \   000061   12....       LCALL   ??osal_memcpy?relay
   \   000064   7403         MOV     A,#0x3
   \   000066   12....       LCALL   ?DEALLOC_XSTACK8
    427            
    428          } /* StubAPS_BuildMsg */
   \   000069   7F07         MOV     R7,#0x7
   \   00006B   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine12:
   \   000000   EF           MOV     A,R7
   \   000001   3400         ADDC    A,#0x0
   \   000003   F9           MOV     R1,A
   \   000004   8882         MOV     DPL,R0
   \   000006   8983         MOV     DPH,R1
   \   000008   E0           MOVX    A,@DPTR
   \   000009   8A82         MOV     DPL,R2
   \   00000B   8B83         MOV     DPH,R3
   \   00000D   F0           MOVX    @DPTR,A
   \   00000E   A3           INC     DPTR
   \   00000F   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine9:
   \   000000   AB83         MOV     R3,DPH
   \   000002   8882         MOV     DPL,R0
   \   000004   8983         MOV     DPH,R1
   \   000006   A3           INC     DPTR
   \   000007   E0           MOVX    A,@DPTR
   \   000008   8A82         MOV     DPL,R2
   \   00000A   8B83         MOV     DPH,R3
   \   00000C   F0           MOVX    @DPTR,A
   \   00000D   A3           INC     DPTR
   \   00000E   0A           INC     R2
   \   00000F   AB83         MOV     R3,DPH
   \   000011                ; Setup parameters for call to function osal_memcpy
   \   000011   EE           MOV     A,R6
   \   000012   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine15:
   \   000000   F582         MOV     DPL,A
   \   000002   EF           MOV     A,R7
   \   000003                REQUIRE ??Subroutine22_0
   \   000003                ; // Fall through to label ??Subroutine22_0
    429          
    430          /******************************************************************************
    431           * @fn          StubAPS_setNewChannel
    432           *
    433           * @brief       This function changes the device's channel.
    434           *
    435           * @param       none
    436           *
    437           * @return      ZStatus_t
    438           */ 

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    439          static ZStatus_t StubAPS_SetNewChannel( uint8 channel )
   \                     StubAPS_SetNewChannel:
    440          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 2
   \   000004   74FE         MOV     A,#-0x2
   \   000006   12....       LCALL   ?ALLOC_XSTACK8
   \   000009   7401         MOV     A,#0x1
   \   00000B   12....       LCALL   ?XSTACK_DISP0_8
   \   00000E   E9           MOV     A,R1
   \   00000F   F0           MOVX    @DPTR,A
    441            uint8 rxOnIdle;
    442            
    443            // make sure MAC has nothing to transmit
    444            if ( ( nwkDB_CountTypes( NWK_DATABUF_SENT ) == 0 ) && ZMacStateIdle() )
   \   000010                ; Setup parameters for call to function nwkDB_CountTypes
   \   000010   7902         MOV     R1,#0x2
   \   000012   12....       LCALL   ??nwkDB_CountTypes?relay
   \   000015   E9           MOV     A,R1
   \   000016   7021         JNZ     ??StubAPS_SetNewChannel_0
   \   000018                ; Setup parameters for call to function ZMacStateIdle
   \   000018   12....       LCALL   ??ZMacStateIdle?relay
   \   00001B   E9           MOV     A,R1
   \   00001C   601B         JZ      ??StubAPS_SetNewChannel_0
    445            {
    446              // set the new channel
    447              ZMacSetReq( ZMacChannel, &channel );
   \   00001E                ; Setup parameters for call to function ZMacSetReq
   \   00001E   7401         MOV     A,#0x1
   \   000020   12....       LCALL   ?XSTACK_DISP0_8
   \   000023   AA82         MOV     R2,DPL
   \   000025   AB83         MOV     R3,DPH
   \   000027   79E1         MOV     R1,#-0x1f
   \   000029   12....       LCALL   ??ZMacSetReq?relay
    448          
    449              // turn MAC receiver back on
    450              rxOnIdle = true;
   \   00002C   7401         MOV     A,#0x1
   \   00002E   12....       LCALL   ??Subroutine20_0 & 0xFFFF
    451              ZMacSetReq( ZMacRxOnIdle, &rxOnIdle );
    452            
    453              channelChangeInProgress = FALSE;
   \                     ??CrossCallReturnLabel_34:
   \   000031   E4           CLR     A
   \   000032   90....       MOV     DPTR,#channelChangeInProgress
   \   000035   F0           MOVX    @DPTR,A
    454              
    455              return ( ZSuccess );
   \   000036   F9           MOV     R1,A
   \   000037   8002         SJMP    ??StubAPS_SetNewChannel_1
    456            }
    457            
    458            return ( ZFailure );
   \                     ??StubAPS_SetNewChannel_0:
   \   000039   7901         MOV     R1,#0x1
   \                     ??StubAPS_SetNewChannel_1:
   \   00003B   02....       LJMP    ?Subroutine0 & 0xFFFF
    459            
    460          } /* StubAPS_setNewChannel */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine20_0:
   \   000000   12....       LCALL   ?Subroutine17 & 0xFFFF
   \                     ??CrossCallReturnLabel_35:
   \   000003   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine0:
   \   000000   7402         MOV     A,#0x2
   \   000002   12....       LCALL   ?DEALLOC_XSTACK8
   \   000005                REQUIRE ??Subroutine21_0
   \   000005                ; // Fall through to label ??Subroutine21_0
    461          
    462          
    463          /******************************************************************************
    464           * @fn          StubAPS_NotifyApp
    465           *
    466           * @brief       This function sends an OSAL message to the Application task.
    467           *
    468           * @param       status - command status
    469           *
    470           * @return      none
    471           */
    472          static void StubAPS_NotifyApp( uint8 status )
    473          {
    474            osal_event_hdr_t *msgPtr;
    475            
    476            // Notify the application task
    477            msgPtr = (osal_event_hdr_t *)osal_msg_allocate( sizeof(osal_event_hdr_t) );
    478            if ( msgPtr )
    479            {
    480              msgPtr->event = SAPS_CHANNEL_CHANGE;
    481              msgPtr->status = status;
    482              
    483              osal_msg_send( appTaskID, (uint8 *)msgPtr );
    484            }
    485            
    486          } /* StubAPS_NotifyApp */
    487          
    488          /******************************************************************************
    489           *
    490           *  External APIs provided to the Application.
    491           */
    492          
    493          /******************************************************************************
    494           * @fn          StubAPS_SetInterPanChannel
    495           *
    496           * @brief       This function changes the device's channel for inter-PAN communication.
    497           *
    498           * @param       channel - new channel
    499           *
    500           * @return      ZStatus_t
    501           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    502          ZStatus_t StubAPS_SetInterPanChannel( uint8 channel )
   \                     StubAPS_SetInterPanChannel:
    503          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 2
   \   000005   74FE         MOV     A,#-0x2
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   E9           MOV     A,R1
   \   00000B   FE           MOV     R6,A
    504            uint8 currChannel;
    505            uint8 rxOnIdle;
    506            
    507            if ( channelChangeInProgress )
   \   00000C   90....       MOV     DPTR,#channelChangeInProgress
   \   00000F   E0           MOVX    A,@DPTR
   \   000010   6004         JZ      ??StubAPS_SetInterPanChannel_0
    508              return ( ZFailure );
   \   000012   7901         MOV     R1,#0x1
   \   000014   8047         SJMP    ??StubAPS_SetInterPanChannel_1
    509          
    510            ZMacGetReq( ZMacChannel, &currChannel );
   \                     ??StubAPS_SetInterPanChannel_0:
   \   000016                ; Setup parameters for call to function ZMacGetReq
   \   000016   7401         MOV     A,#0x1
   \   000018   12....       LCALL   ?XSTACK_DISP0_8
   \   00001B   AA82         MOV     R2,DPL
   \   00001D   AB83         MOV     R3,DPH
   \   00001F   79E1         MOV     R1,#-0x1f
   \   000021   12....       LCALL   ??ZMacGetReq?relay
    511            if ( currChannel == channel )
   \   000024   7401         MOV     A,#0x1
   \   000026   12....       LCALL   ?XSTACK_DISP0_8
   \   000029   E0           MOVX    A,@DPTR
   \   00002A   6E           XRL     A,R6
   \   00002B   7004         JNZ     ??StubAPS_SetInterPanChannel_2
    512            {
    513              // inter PANs communication within the same channel
    514              return ( ZSuccess );
   \                     ??StubAPS_SetInterPanChannel_3:
   \   00002D   7900         MOV     R1,#0x0
   \   00002F   802C         SJMP    ??StubAPS_SetInterPanChannel_1
    515            }
    516            
    517            // go into channel transition state
    518            channelChangeInProgress = TRUE;
   \                     ??StubAPS_SetInterPanChannel_2:
   \   000031   7401         MOV     A,#0x1
   \   000033   90....       MOV     DPTR,#channelChangeInProgress
   \   000036   F0           MOVX    @DPTR,A
    519            
    520            // set NWK task to idle
    521            nwk_setStateIdle( TRUE );
   \   000037                ; Setup parameters for call to function nwk_setStateIdle
   \   000037   F9           MOV     R1,A
   \   000038   12....       LCALL   ??nwk_setStateIdle?relay
    522            
    523            // turn MAC receiver off
    524            rxOnIdle = false;
   \   00003B   12....       LCALL   ?Subroutine5 & 0xFFFF
    525            ZMacSetReq( ZMacRxOnIdle, &rxOnIdle );
    526          
    527            // try to change to the new channel
    528            if ( StubAPS_SetNewChannel( channel ) == ZSuccess )
   \                     ??CrossCallReturnLabel_32:
   \   00003E                ; Setup parameters for call to function StubAPS_SetNewChannel
   \   00003E   EE           MOV     A,R6
   \   00003F   F9           MOV     R1,A
   \   000040   12....       LCALL   ??StubAPS_SetNewChannel?relay
   \   000043   E9           MOV     A,R1
   \   000044   60E7         JZ      ??StubAPS_SetInterPanChannel_3
    529              return ( ZSuccess );
    530              
    531            // save the new channel for retry
    532            newChannel = channel;
   \   000046   EE           MOV     A,R6
   \   000047   90....       MOV     DPTR,#newChannel
   \   00004A   F0           MOVX    @DPTR,A
    533            
    534            // ask StubAPS task to retry it later
    535            osal_start_timerEx( StubAPS_TaskID, CHANNEL_CHANGE_EVT, CHANNEL_CHANGE_RETRY_TIMEOUT );
   \   00004B                ; Setup parameters for call to function osal_start_timerEx
   \   00004B   7C64         MOV     R4,#0x64
   \   00004D   7D00         MOV     R5,#0x0
   \   00004F   7A01         MOV     R2,#0x1
   \   000051   7B00         MOV     R3,#0x0
   \   000053   90....       MOV     DPTR,#StubAPS_TaskID
   \   000056   E0           MOVX    A,@DPTR
   \   000057   F9           MOV     R1,A
   \   000058   12....       LCALL   ??osal_start_timerEx?relay
    536              
    537            return ( ZApsNotAllowed );
   \   00005B   79BA         MOV     R1,#-0x46
   \                     ??StubAPS_SetInterPanChannel_1:
   \   00005D   7402         MOV     A,#0x2
   \   00005F                REQUIRE ?Subroutine2
   \   00005F                ; // Fall through to label ?Subroutine2
    538            
    539          } /* StubAPS_SetInterPanChannel */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine2:
   \   000000   12....       LCALL   ?DEALLOC_XSTACK8
   \   000003   7F01         MOV     R7,#0x1
   \   000005   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine5:
   \   000000   E4           CLR     A
   \   000001                REQUIRE ??Subroutine20_0
   \   000001                ; // Fall through to label ??Subroutine20_0
    540          
    541          /******************************************************************************
    542           * @fn          StubAPS_SetIntraPanChannel
    543           *
    544           * @brief       This function sets the device's channel back to the NIB channel.
    545           *
    546           * @param       none
    547           *
    548           * @return      ZStatus_t
    549           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    550          ZStatus_t StubAPS_SetIntraPanChannel( void )
   \                     StubAPS_SetIntraPanChannel:
    551          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 2
   \   000004   74FE         MOV     A,#-0x2
   \   000006   12....       LCALL   ?ALLOC_XSTACK8
    552            uint8 currChannel;
    553            uint8 rxOnIdle;
    554            
    555            if ( channelChangeInProgress )
   \   000009   90....       MOV     DPTR,#channelChangeInProgress
   \   00000C   E0           MOVX    A,@DPTR
   \   00000D   6004         JZ      ??StubAPS_SetIntraPanChannel_0
    556              return ( ZFailure );
   \   00000F   7901         MOV     R1,#0x1
   \   000011   8036         SJMP    ??StubAPS_SetIntraPanChannel_1
    557            
    558            ZMacGetReq( ZMacChannel, &currChannel );
   \                     ??StubAPS_SetIntraPanChannel_0:
   \   000013                ; Setup parameters for call to function ZMacGetReq
   \   000013   7401         MOV     A,#0x1
   \   000015   12....       LCALL   ?XSTACK_DISP0_8
   \   000018   AA82         MOV     R2,DPL
   \   00001A   AB83         MOV     R3,DPH
   \   00001C   79E1         MOV     R1,#-0x1f
   \   00001E   12....       LCALL   ??ZMacGetReq?relay
    559            if ( currChannel == _NIB.nwkLogicalChannel )
   \   000021   7401         MOV     A,#0x1
   \   000023   12....       LCALL   ?XSTACK_DISP0_8
   \   000026   E0           MOVX    A,@DPTR
   \   000027   FA           MOV     R2,A
   \   000028   90....       MOV     DPTR,#(_NIB + 22)
   \   00002B   E0           MOVX    A,@DPTR
   \   00002C   6A           XRL     A,R2
   \   00002D   7004         JNZ     ??StubAPS_SetIntraPanChannel_2
    560              return ( ZSuccess );
   \   00002F   7900         MOV     R1,#0x0
   \   000031   8016         SJMP    ??StubAPS_SetIntraPanChannel_1
    561            
    562            channelChangeInProgress = TRUE;
   \                     ??StubAPS_SetIntraPanChannel_2:
   \   000033   7401         MOV     A,#0x1
   \   000035   90....       MOV     DPTR,#channelChangeInProgress
   \   000038   F0           MOVX    @DPTR,A
    563            
    564            // turn MAC receiver off
    565            rxOnIdle = false;
   \   000039   12....       LCALL   ?Subroutine5 & 0xFFFF
    566            ZMacSetReq( ZMacRxOnIdle, &rxOnIdle );
    567            
    568            // set the NIB channel
    569            ZMacSetReq( ZMacChannel, &(_NIB.nwkLogicalChannel) );
   \                     ??CrossCallReturnLabel_33:
   \   00003C                ; Setup parameters for call to function ZMacSetReq
   \   00003C   7A..         MOV     R2,#((_NIB + 22) & 0xff)
   \   00003E   7B..         MOV     R3,#(((_NIB + 22) >> 8) & 0xff)
   \   000040   79E1         MOV     R1,#-0x1f
   \   000042   12....       LCALL   ??ZMacSetReq?relay
    570            
    571            // turn MAC receiver back on
    572            rxOnIdle = true;
   \   000045   12....       LCALL   ?Subroutine4 & 0xFFFF
    573            ZMacSetReq( ZMacRxOnIdle, &rxOnIdle );
    574             
    575            // set NWK task to run
    576            nwk_setStateIdle( FALSE );
    577            
    578            channelChangeInProgress = FALSE;
    579            
    580            return ( ZSuccess );
   \                     ??CrossCallReturnLabel_1:
   \   000048   F9           MOV     R1,A
   \                     ??StubAPS_SetIntraPanChannel_1:
   \   000049   80..         SJMP    ?Subroutine0
    581            
    582          } /* StubAPS_SetIntraPanChannel */
    583          
    584          /******************************************************************************
    585           * @fn          StubAPS_InterPan
    586           *
    587           * @brief       This function checks to see if a PAN is an Inter-PAN.
    588           *
    589           * @param       panId - PAN ID
    590           * @param       endPoint - endpoint
    591           *
    592           * @return      TRUE if PAN is Inter-PAN, FALSE otherwise
    593           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    594          uint8 StubAPS_InterPan( uint16 panId, uint8 endPoint )
   \                     StubAPS_InterPan:
    595          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 1
   \   000005   74FF         MOV     A,#-0x1
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   EA           MOV     A,R2
   \   00000B   FE           MOV     R6,A
   \   00000C   EB           MOV     A,R3
   \   00000D   FF           MOV     R7,A
   \   00000E   89..         MOV     ?V0 + 0,R1
    596            uint8 currChannel;
    597            
    598            if ( panId != 0 )
   \   000010   EE           MOV     A,R6
   \   000011   7001         JNZ     ??StubAPS_InterPan_0
   \   000013   EF           MOV     A,R7
   \                     ??StubAPS_InterPan_0:
   \   000014   6034         JZ      ??StubAPS_InterPan_1
    599            {
    600              ZMacGetReq( ZMacChannel, &currChannel );
   \   000016                ; Setup parameters for call to function ZMacGetReq
   \   000016   85..82       MOV     DPL,?XSP + 0
   \   000019   85..83       MOV     DPH,?XSP + 1
   \   00001C   AA82         MOV     R2,DPL
   \   00001E   AB83         MOV     R3,DPH
   \   000020   79E1         MOV     R1,#-0x1f
   \   000022   12....       LCALL   ??ZMacGetReq?relay
    601              if ( currChannel != _NIB.nwkLogicalChannel )
   \   000025   85..82       MOV     DPL,?XSP + 0
   \   000028   85..83       MOV     DPH,?XSP + 1
   \   00002B   E0           MOVX    A,@DPTR
   \   00002C   FA           MOV     R2,A
   \   00002D   90....       MOV     DPTR,#(_NIB + 22)
   \   000030   E0           MOVX    A,@DPTR
   \   000031   6A           XRL     A,R2
   \   000032   6004         JZ      ??StubAPS_InterPan_2
    602              {
    603                // different Channels
    604                return ( TRUE );
   \                     ??StubAPS_InterPan_3:
   \   000034   7901         MOV     R1,#0x1
   \   000036   8014         SJMP    ??StubAPS_InterPan_4
    605              }
    606            
    607              // same Channels
    608              if ( panId != _NIB.nwkPanId )
   \                     ??StubAPS_InterPan_2:
   \   000038   90....       MOV     DPTR,#(_NIB + 33)
   \   00003B   E0           MOVX    A,@DPTR
   \   00003C   6E           XRL     A,R6
   \   00003D   7003         JNZ     ??StubAPS_InterPan_5
   \   00003F   A3           INC     DPTR
   \   000040   E0           MOVX    A,@DPTR
   \   000041   6F           XRL     A,R7
   \                     ??StubAPS_InterPan_5:
   \   000042   70F0         JNZ     ??StubAPS_InterPan_3
    609              {
    610                // different PAN IDs
    611                return ( TRUE );
    612              }
    613            
    614              // same Channels and same PAN IDs
    615              if ( endPoint == STUBAPS_INTER_PAN_EP )
   \   000044   74FE         MOV     A,#-0x2
   \   000046   65..         XRL     A,?V0 + 0
   \   000048   60EA         JZ      ??StubAPS_InterPan_3
    616              {
    617                // Inter-PAN endpoint
    618                return ( TRUE );
    619              }
    620            }
    621            
    622            return ( FALSE );
   \                     ??StubAPS_InterPan_1:
   \   00004A   7900         MOV     R1,#0x0
   \                     ??StubAPS_InterPan_4:
   \   00004C   7401         MOV     A,#0x1
   \   00004E   02....       LJMP    ?Subroutine2 & 0xFFFF
    623            
    624          } /* StubAPS_InterPan */
    625          
    626          /******************************************************************************
    627           * @fn          StubAPS_RegisterApp
    628           *
    629           * @brief       This function registers the Application with the Stub APS layer.
    630           *
    631           *              NOTE: Since Stub APS messages don't include the application
    632           *                    endpoint, the application has to register its endpoint
    633           *                    with Stub APS.
    634           *
    635           * @param       epDesc - application's endpoint descriptor
    636           *
    637           * @return      none
    638           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    639          void StubAPS_RegisterApp( endPointDesc_t *epDesc )
   \                     StubAPS_RegisterApp:
    640          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    641            appTaskID = *epDesc->task_id;
   \   000004   8A82         MOV     DPL,R2
   \   000006   8B83         MOV     DPH,R3
   \   000008   12....       LCALL   ?Subroutine11 & 0xFFFF
   \                     ??CrossCallReturnLabel_13:
   \   00000B   E0           MOVX    A,@DPTR
   \   00000C   90....       MOV     DPTR,#appTaskID
   \   00000F   F0           MOVX    @DPTR,A
    642            appEndPoint = epDesc->endPoint;
   \   000010   8A82         MOV     DPL,R2
   \   000012   8B83         MOV     DPH,R3
   \   000014   E0           MOVX    A,@DPTR
   \   000015   90....       MOV     DPTR,#appEndPoint
   \   000018   F0           MOVX    @DPTR,A
    643            
    644          } /* StubAPS_RegisterApp */
   \   000019   80..         SJMP    ??Subroutine21_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine11:
   \   000000   A3           INC     DPTR
   \   000001   E0           MOVX    A,@DPTR
   \   000002   F8           MOV     R0,A
   \   000003   A3           INC     DPTR
   \   000004   E0           MOVX    A,@DPTR
   \   000005   F583         MOV     DPH,A
   \   000007   8882         MOV     DPL,R0
   \   000009   22           RET
    645          
    646          /******************************************************************************
    647           * @fn          StubAPS_ZMacCallback
    648           *
    649           * @brief       This function accepts an inter-PAN message from ZMac.
    650           *
    651           * @param       msgPtr - received message
    652           *
    653           * @return      TRUE if message is processed. FALSE otherwise.
    654           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    655          uint8 StubAPS_ZMacCallback( uint8 *msgPtr )
   \                     StubAPS_ZMacCallback:
    656          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    657            uint16 nwk_fc;
    658            uint8  aps_fc;
    659            uint8  frameType;
    660            uint8 *buf = NULL;
    661            uint8  event = ((osal_event_hdr_t *)msgPtr)->event;
   \   000004   8A82         MOV     DPL,R2
   \   000006   8B83         MOV     DPH,R3
   \   000008   E0           MOVX    A,@DPTR
   \   000009   FC           MOV     R4,A
    662          
    663            if ( event == MAC_MCPS_DATA_IND )
   \   00000A   740D         MOV     A,#0xd
   \   00000C   6C           XRL     A,R4
   \   00000D   600A         JZ      ??CrossCallReturnLabel_14
    664            {
    665              buf = ((macMcpsDataInd_t *)msgPtr)->msdu.p;
    666            }
    667            else if ( event == MAC_MCPS_DATA_CNF )
   \   00000F   740C         MOV     A,#0xc
   \   000011   6C           XRL     A,R4
   \   000012   701D         JNZ     ??StubAPS_ZMacCallback_0
    668            {
    669              buf = ((macMcpsDataCnf_t *)msgPtr)->pDataReq->msdu.p;
   \   000014   A3           INC     DPTR
   \   000015   A3           INC     DPTR
   \   000016   12....       LCALL   ?Subroutine11 & 0xFFFF
    670            }
   \                     ??CrossCallReturnLabel_14:
   \   000019   A3           INC     DPTR
   \   00001A   A3           INC     DPTR
   \   00001B   12....       LCALL   ??Subroutine23_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_47:
   \   00001E   8882         MOV     DPL,R0
   \   000020   8983         MOV     DPH,R1
    671            
    672            if ( buf )
   \   000022   E582         MOV     A,DPL
   \   000024   7002         JNZ     ??StubAPS_ZMacCallback_1
   \   000026   E583         MOV     A,DPH
   \                     ??StubAPS_ZMacCallback_1:
   \   000028   6007         JZ      ??StubAPS_ZMacCallback_0
    673            {
    674              // get the NWK frame control
    675              nwk_fc = BUILD_UINT16( buf[NWK_HDR_FRAME_CTRL_LSB], buf[NWK_HDR_FRAME_CTRL_MSB] );
    676            
    677              // frame type
    678              frameType = (uint8)((nwk_fc >> NWK_FC_FRAME_TYPE) & NWK_FC_FRAME_TYPE_MASK);
    679            
    680              // check if incoming frame is of the right type
    681              if ( frameType != STUB_NWK_FRAME_TYPE )
   \   00002A   E0           MOVX    A,@DPTR
   \   00002B   5403         ANL     A,#0x3
   \   00002D   6403         XRL     A,#0x3
   \   00002F   6004         JZ      ??StubAPS_ZMacCallback_2
    682              {
    683                // message doesn't belong to Stub APS
    684                return ( FALSE );
   \                     ??StubAPS_ZMacCallback_0:
   \   000031   7900         MOV     R1,#0x0
   \   000033   8013         SJMP    ??StubAPS_ZMacCallback_3
    685              }
    686           
    687              // get the APS frame control
    688              aps_fc = buf[STUB_APS_HDR_FRAME_CTRL];
    689            
    690              // frame type
    691              frameType = aps_fc & APS_FRAME_TYPE_MASK;
    692              
    693              // check if incoming frame is of the right type
    694              if ( frameType != STUB_APS_FRAME )
   \                     ??StubAPS_ZMacCallback_2:
   \   000035   A3           INC     DPTR
   \   000036   A3           INC     DPTR
   \   000037   E0           MOVX    A,@DPTR
   \   000038   5403         ANL     A,#0x3
   \   00003A   6403         XRL     A,#0x3
   \   00003C   70F3         JNZ     ??StubAPS_ZMacCallback_0
    695              {
    696                // message doesn't belong to Stub APS
    697                return ( FALSE );
    698              }
    699              
    700              // message belongs to Stub APS
    701              osal_msg_send( StubAPS_TaskID, (uint8 *)msgPtr );
   \   00003E                ; Setup parameters for call to function osal_msg_send
   \   00003E   90....       MOV     DPTR,#StubAPS_TaskID
   \   000041   E0           MOVX    A,@DPTR
   \   000042   F9           MOV     R1,A
   \   000043   12....       LCALL   ??osal_msg_send?relay
    702           
    703              return ( TRUE );
   \   000046   7901         MOV     R1,#0x1
    704            }
   \                     ??StubAPS_ZMacCallback_3:
   \   000048   80..         SJMP    ??Subroutine21_0
    705            
    706            // message doesn't belong to Stub APS
    707            return ( FALSE );
    708              
    709          } /* StubAPS_ZMacCallback */
    710          
    711          /******************************************************************************
    712           *
    713           *  Stub APS Inter-PAN interface INTERP and its callbacks.
    714           */
    715          
    716          /******************************************************************************
    717           * @fn          INTERP_DataReq
    718           *
    719           * @brief       This function requests the transfer of data from the next
    720           *              higher layer to a single peer entity.
    721           *
    722           * @param       req - APSDE_DataReq_t
    723           *
    724           * @return      ZStatus_t
    725           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    726          ZStatus_t INTERP_DataReq( APSDE_DataReq_t *req )
   \                     INTERP_DataReq:
    727          {
   \   000000   74F2         MOV     A,#-0xe
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 14
   \   000005                ; Auto size: 33
   \   000005   74DF         MOV     A,#-0x21
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   8A..         MOV     ?V0 + 2,R2
   \   00000C   8B..         MOV     ?V0 + 3,R3
    728            uint8 apsFrmCtrl;
    729            uint16 groupID = 0;
   \   00000E   7401         MOV     A,#0x1
   \   000010   12....       LCALL   ?XSTACK_DISP0_8
   \   000013   E4           CLR     A
   \   000014   F0           MOVX    @DPTR,A
   \   000015   A3           INC     DPTR
   \   000016   F0           MOVX    @DPTR,A
    730            uint8 *buf;
    731            uint8 hdrLen;
    732            ZMacDataReq_t dataReq;
    733            ZStatus_t status;
    734            
    735            if ( channelChangeInProgress || !StubAPS_InterPan( req->dstPanId, req->dstEP ) )
   \   000017   90....       MOV     DPTR,#channelChangeInProgress
   \   00001A   E0           MOVX    A,@DPTR
   \   00001B   701F         JNZ     ??INTERP_DataReq_0
   \   00001D                ; Setup parameters for call to function StubAPS_InterPan
   \   00001D   8A82         MOV     DPL,R2
   \   00001F   8B83         MOV     DPH,R3
   \   000021   A3           INC     DPTR
   \   000022   A3           INC     DPTR
   \   000023   A3           INC     DPTR
   \   000024   A3           INC     DPTR
   \   000025   A3           INC     DPTR
   \   000026   A3           INC     DPTR
   \   000027   A3           INC     DPTR
   \   000028   A3           INC     DPTR
   \   000029   A3           INC     DPTR
   \   00002A   A3           INC     DPTR
   \   00002B   E0           MOVX    A,@DPTR
   \   00002C   F9           MOV     R1,A
   \   00002D   EA           MOV     A,R2
   \   00002E   240B         ADD     A,#0xb
   \   000030   F582         MOV     DPL,A
   \   000032   EB           MOV     A,R3
   \   000033   12....       LCALL   ?Subroutine14 & 0xFFFF
   \                     ??CrossCallReturnLabel_20:
   \   000036   12....       LCALL   ??StubAPS_InterPan?relay
   \   000039   E9           MOV     A,R1
   \   00003A   700C         JNZ     ??INTERP_DataReq_1
    736              return ( ZFailure );
   \                     ??INTERP_DataReq_0:
   \   00003C   7901         MOV     R1,#0x1
   \                     ??INTERP_DataReq_2:
   \   00003E   7421         MOV     A,#0x21
   \   000040   12....       LCALL   ?DEALLOC_XSTACK8
   \   000043   7F06         MOV     R7,#0x6
   \   000045   02....       LJMP    ?BANKED_LEAVE_XDATA
    737            
    738            osal_memset( &dataReq, 0, sizeof( ZMacDataReq_t ) );
   \                     ??INTERP_DataReq_1:
   \   000048                ; Setup parameters for call to function osal_memset
   \   000048   7C1E         MOV     R4,#0x1e
   \   00004A   7D00         MOV     R5,#0x0
   \   00004C   7900         MOV     R1,#0x0
   \   00004E   7403         MOV     A,#0x3
   \   000050   12....       LCALL   ?XSTACK_DISP0_8
   \   000053   AA82         MOV     R2,DPL
   \   000055   AB83         MOV     R3,DPH
   \   000057   12....       LCALL   ??osal_memset?relay
    739            
    740            // Build Stub APS header
    741            status = StubAPS_BuildFrameControl( &apsFrmCtrl, &(dataReq.DstAddr), &groupID, req );
   \   00005A                ; Setup parameters for call to function StubAPS_BuildFrameControl
   \   00005A   78..         MOV     R0,#?V0 + 2
   \   00005C   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00005F   7403         MOV     A,#0x3
   \   000061   12....       LCALL   ?XSTACK_DISP0_8
   \   000064   8582..       MOV     ?V0 + 0,DPL
   \   000067   8583..       MOV     ?V0 + 1,DPH
   \   00006A   78..         MOV     R0,#?V0 + 0
   \   00006C   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00006F   7407         MOV     A,#0x7
   \   000071   12....       LCALL   ?XSTACK_DISP0_8
   \   000074   AC82         MOV     R4,DPL
   \   000076   AD83         MOV     R5,DPH
   \   000078   7404         MOV     A,#0x4
   \   00007A   12....       LCALL   ?XSTACK_DISP0_8
   \   00007D   AA82         MOV     R2,DPL
   \   00007F   AB83         MOV     R3,DPH
   \   000081   12....       LCALL   ??StubAPS_BuildFrameControl?relay
   \   000084   7404         MOV     A,#0x4
   \   000086   12....       LCALL   ?DEALLOC_XSTACK8
   \   000089   E9           MOV     A,R1
   \   00008A   FE           MOV     R6,A
    742            if ( status != ZSuccess )
   \   00008B   6004         JZ      ??INTERP_DataReq_3
    743              return ( status );
   \                     ??INTERP_DataReq_4:
   \   00008D   EE           MOV     A,R6
   \   00008E   F9           MOV     R1,A
   \   00008F   80AD         SJMP    ??INTERP_DataReq_2
    744          
    745            // set default Stub APS header length
    746            hdrLen = APS_FRAME_CTRL_FIELD_LEN;
   \                     ??INTERP_DataReq_3:
   \   000091   7A01         MOV     R2,#0x1
    747            
    748            // add group ID length
    749            if ( ( apsFrmCtrl & APS_DELIVERYMODE_MASK ) == APS_FC_DM_GROUP )
   \   000093   85..82       MOV     DPL,?XSP + 0
   \   000096   85..83       MOV     DPH,?XSP + 1
   \   000099   E0           MOVX    A,@DPTR
   \   00009A   540C         ANL     A,#0xc
   \   00009C   640C         XRL     A,#0xc
   \   00009E   7002         JNZ     ??INTERP_DataReq_5
    750              hdrLen += APS_GROUP_ID_FIELD_LEN;
   \   0000A0   0A           INC     R2
   \   0000A1   0A           INC     R2
    751            
    752            // add cluster ID length
    753            hdrLen += APS_CLUSTERID_FIELD_LEN;
    754            
    755            // add profile ID length
    756            hdrLen += APS_PROFILEID_FIELD_LEN;
    757            
    758            // add default Stub NWK header length
    759            hdrLen += STUB_NWK_HDR_LEN;
    760            
    761            // calculate MSDU length
    762            dataReq.msduLength = hdrLen + req->asduLen;
   \                     ??INTERP_DataReq_5:
   \   0000A2   E5..         MOV     A,?V0 + 2
   \   0000A4   2411         ADD     A,#0x11
   \   0000A6   F582         MOV     DPL,A
   \   0000A8   E5..         MOV     A,?V0 + 3
   \   0000AA   12....       LCALL   ??Subroutine22_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_39:
   \   0000AD   2A           ADD     A,R2
   \   0000AE   2406         ADD     A,#0x6
   \   0000B0   FA           MOV     R2,A
   \   0000B1   741E         MOV     A,#0x1e
   \   0000B3   12....       LCALL   ?XSTACK_DISP0_8
   \   0000B6   EA           MOV     A,R2
   \   0000B7   F0           MOVX    @DPTR,A
    763            
    764            // allocate buffer
    765            buf = osal_mem_alloc( dataReq.msduLength );
   \   0000B8                ; Setup parameters for call to function osal_mem_alloc
   \   0000B8   7B00         MOV     R3,#0x0
   \   0000BA   12....       LCALL   ??osal_mem_alloc?relay
   \   0000BD   8A..         MOV     ?V0 + 0,R2
   \   0000BF   8B..         MOV     ?V0 + 1,R3
    766            if ( buf != NULL )
   \   0000C1   EA           MOV     A,R2
   \   0000C2   7001         JNZ     ??INTERP_DataReq_6
   \   0000C4   EB           MOV     A,R3
   \                     ??INTERP_DataReq_6:
   \   0000C5   7003         JNZ     $+5
   \   0000C7   02....       LJMP    ??INTERP_DataReq_7 & 0xFFFF
    767            {
    768              dataReq.msdu = buf;
   \   0000CA   741F         MOV     A,#0x1f
   \   0000CC   12....       LCALL   ?XSTACK_DISP0_8
   \   0000CF   EA           MOV     A,R2
   \   0000D0   F0           MOVX    @DPTR,A
   \   0000D1   A3           INC     DPTR
   \   0000D2   EB           MOV     A,R3
   \   0000D3   F0           MOVX    @DPTR,A
    769              
    770              // Add Stub APS header and data
    771              StubAPS_BuildMsg( &buf[STUB_APS_HDR_FRAME_CTRL], apsFrmCtrl, groupID, req );
   \   0000D4                ; Setup parameters for call to function StubAPS_BuildMsg
   \   0000D4   78..         MOV     R0,#?V0 + 2
   \   0000D6   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000D9   7403         MOV     A,#0x3
   \   0000DB   12....       LCALL   ?XSTACK_DISP0_8
   \   0000DE   12....       LCALL   ?Subroutine10 & 0xFFFF
   \                     ??CrossCallReturnLabel_12:
   \   0000E1   7402         MOV     A,#0x2
   \   0000E3   12....       LCALL   ?XSTACK_DISP0_8
   \   0000E6   E0           MOVX    A,@DPTR
   \   0000E7   F9           MOV     R1,A
   \   0000E8   EA           MOV     A,R2
   \   0000E9   2402         ADD     A,#0x2
   \   0000EB   0A           INC     R2
   \   0000EC   0A           INC     R2
   \   0000ED   EB           MOV     A,R3
   \   0000EE   3400         ADDC    A,#0x0
   \   0000F0   FB           MOV     R3,A
   \   0000F1   12....       LCALL   ??StubAPS_BuildMsg?relay
   \   0000F4   7402         MOV     A,#0x2
   \   0000F6   12....       LCALL   ?DEALLOC_XSTACK8
    772              
    773              // Add Stub NWK header
    774              StubNWK_BuildMsg( buf );  
   \   0000F9   AE..         MOV     R6,?V0 + 0
   \   0000FB   AF..         MOV     R7,?V0 + 1
   \   0000FD                ; Setup parameters for call to function NLME_GetProtocolVersion
   \   0000FD   12....       LCALL   ??NLME_GetProtocolVersion?relay
   \   000100   E9           MOV     A,R1
   \   000101   F5..         MOV     ?V0 + 4,A
   \   000103   75..00       MOV     ?V0 + 5,#0x0
   \   000106   7402         MOV     A,#0x2
   \   000108   78..         MOV     R0,#?V0 + 4
   \   00010A   12....       LCALL   ?S_SHL
   \   00010D   7403         MOV     A,#0x3
   \   00010F   45..         ORL     A,?V0 + 4
   \   000111   8E82         MOV     DPL,R6
   \   000113   8F83         MOV     DPH,R7
   \   000115   F0           MOVX    @DPTR,A
   \   000116   A3           INC     DPTR
   \   000117   E5..         MOV     A,?V0 + 5
   \   000119   F0           MOVX    @DPTR,A
    775          
    776              // Set ZMac data request
    777              dataReq.DstPANId = req->dstPanId;
   \   00011A   E5..         MOV     A,?V0 + 2
   \   00011C   240B         ADD     A,#0xb
   \   00011E   F582         MOV     DPL,A
   \   000120   E5..         MOV     A,?V0 + 3
   \   000122   12....       LCALL   ?Subroutine8 & 0xFFFF
   \                     ??CrossCallReturnLabel_50:
   \   000125   740C         MOV     A,#0xc
   \   000127   12....       LCALL   ?XSTACK_DISP0_8
   \   00012A   E8           MOV     A,R0
   \   00012B   F0           MOVX    @DPTR,A
   \   00012C   A3           INC     DPTR
   \   00012D   E9           MOV     A,R1
   \   00012E   F0           MOVX    @DPTR,A
    778              dataReq.SrcAddrMode = Addr64Bit; 
   \   00012F   740E         MOV     A,#0xe
   \   000131   12....       LCALL   ?XSTACK_DISP0_8
   \   000134   7403         MOV     A,#0x3
   \   000136   F0           MOVX    @DPTR,A
    779              dataReq.Handle = req->transID;
   \   000137   E5..         MOV     A,?V0 + 2
   \   000139   2417         ADD     A,#0x17
   \   00013B   F582         MOV     DPL,A
   \   00013D   E5..         MOV     A,?V0 + 3
   \   00013F   12....       LCALL   ??Subroutine22_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_40:
   \   000142   C0E0         PUSH    A
   \   000144   740F         MOV     A,#0xf
   \   000146   12....       LCALL   ?XSTACK_DISP0_8
   \   000149   D0E0         POP     A
   \   00014B   F0           MOVX    @DPTR,A
    780            
    781              if ( ( apsFrmCtrl & APS_DELIVERYMODE_MASK ) == APS_FC_DM_UNICAST )
   \   00014C   85..82       MOV     DPL,?XSP + 0
   \   00014F   85..83       MOV     DPH,?XSP + 1
   \   000152   E0           MOVX    A,@DPTR
   \   000153   540C         ANL     A,#0xc
   \   000155   7009         JNZ     ??INTERP_DataReq_8
    782                dataReq.TxOptions = NWK_TXOPTIONS_ACK;
   \   000157   7410         MOV     A,#0x10
   \   000159   12....       LCALL   ?XSTACK_DISP0_8
   \   00015C   7401         MOV     A,#0x1
   \   00015E   8006         SJMP    ??INTERP_DataReq_9
    783              else
    784                dataReq.TxOptions = 0;
   \                     ??INTERP_DataReq_8:
   \   000160   7410         MOV     A,#0x10
   \   000162   12....       LCALL   ?XSTACK_DISP0_8
   \   000165   E4           CLR     A
   \                     ??INTERP_DataReq_9:
   \   000166   F0           MOVX    @DPTR,A
    785              
    786              // send the frame
    787              status = ZMacDataReq( &dataReq );
   \   000167                ; Setup parameters for call to function ZMacDataReq
   \   000167   7403         MOV     A,#0x3
   \   000169   12....       LCALL   ?XSTACK_DISP0_8
   \   00016C   AA82         MOV     R2,DPL
   \   00016E   AB83         MOV     R3,DPH
   \   000170   12....       LCALL   ??ZMacDataReq?relay
   \   000173   E9           MOV     A,R1
   \   000174   FE           MOV     R6,A
    788              
    789              // free the frame
    790              osal_mem_free( buf );
   \   000175                ; Setup parameters for call to function osal_mem_free
   \   000175   AA..         MOV     R2,?V0 + 0
   \   000177   AB..         MOV     R3,?V0 + 1
   \   000179   12....       LCALL   ??osal_mem_free?relay
   \   00017C   02....       LJMP    ??INTERP_DataReq_4 & 0xFFFF
    791            }
    792            else
    793            {
    794              // flag a memory error
    795              status = ZMemError;
   \                     ??INTERP_DataReq_7:
   \   00017F   7E10         MOV     R6,#0x10
   \   000181   02....       LJMP    ??INTERP_DataReq_4 & 0xFFFF
    796            }
    797            
    798            return ( status );
    799            
    800          } /* INTERP_DataReq */
    801          
    802          /******************************************************************************
    803           * @fn          INTERP_DataReqMTU
    804           *
    805           * @brief       This function requests the MTU (Max Transport Unit) of the
    806           *              Inter-PAN Data Service.
    807           *
    808           * @param       none
    809           *
    810           * @return      uint8 - MTU
    811           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    812          uint8 INTERP_DataReqMTU( void )
   \                     INTERP_DataReqMTU:
    813          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
    814            uint8 mtu;
    815            uint8 hdrLen;
    816            
    817            // Use maximum header size for Stub APS header
    818            hdrLen = APS_FRAME_CTRL_FIELD_LEN +
    819                     APS_GROUP_ID_FIELD_LEN   +
    820                     APS_CLUSTERID_FIELD_LEN  +
    821                     APS_PROFILEID_FIELD_LEN;
    822          
    823            mtu = MAC_A_MAX_FRAME_SIZE - STUB_NWK_HDR_LEN - hdrLen;
    824          
    825            return ( mtu );
   \   000000   795D         MOV     R1,#0x5d
   \   000002   02....       LJMP    ?BRET
    826          
    827          } /* INTERP_DataReqMTU */
    828          
    829          /****************************************************************************
    830           * @fn          INTERP_DataConfirm
    831           *
    832           * @brief       This function processes the data confirm from the MAC layer.
    833           *
    834           * @param       dataCnf - data confirm primitive
    835           *
    836           * @return      none
    837           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    838          void INTERP_DataConfirm( ZMacDataCnf_t *dataCnf )
   \                     INTERP_DataConfirm:
    839          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   \   000004   EA           MOV     A,R2
   \   000005   F8           MOV     R0,A
   \   000006   EB           MOV     A,R3
   \   000007   F9           MOV     R1,A
    840            afDataConfirm( appEndPoint, dataCnf->msduHandle, dataCnf->hdr.Status );
   \   000008                ; Setup parameters for call to function afDataConfirm
   \   000008   8882         MOV     DPL,R0
   \   00000A   8983         MOV     DPH,R1
   \   00000C   A3           INC     DPTR
   \   00000D   E0           MOVX    A,@DPTR
   \   00000E   FB           MOV     R3,A
   \   00000F   8882         MOV     DPL,R0
   \   000011   8983         MOV     DPH,R1
   \   000013   A3           INC     DPTR
   \   000014   A3           INC     DPTR
   \   000015   E0           MOVX    A,@DPTR
   \   000016   FA           MOV     R2,A
   \   000017   90....       MOV     DPTR,#appEndPoint
   \   00001A   E0           MOVX    A,@DPTR
   \   00001B   F9           MOV     R1,A
   \   00001C   12....       LCALL   ??afDataConfirm?relay
    841          
    842          } /* INTERP_DataConfirm */
   \   00001F   02....       LJMP    ??Subroutine21_0 & 0xFFFF
    843          
    844          /****************************************************************************
    845           * @fn          INTERP_DataIndication
    846           *
    847           * @brief       This function indicates the transfer of a data SPDU (MSDU)
    848           *              from the MAC layer to the local application layer entity.
    849           *
    850           * @param       dataInd - data indicate primitive
    851           *
    852           * @return      none
    853           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    854          void INTERP_DataIndication( macMcpsDataInd_t *dataInd )
   \                     INTERP_DataIndication:
    855          {
   \   000000   74F5         MOV     A,#-0xb
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 11
   \   000005                ; Auto size: 64
   \   000005   74C0         MOV     A,#-0x40
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   EA           MOV     A,R2
   \   00000B   FE           MOV     R6,A
   \   00000C   EB           MOV     A,R3
   \   00000D   FF           MOV     R7,A
    856            NLDE_FrameFormat_t snff;
    857            aps_FrameFormat_t saff;
    858            zAddrType_t srcAddr;
    859            NLDE_Signal_t sig;
    860          
    861            // parse the Stub NWK header
    862            StubNWK_ParseMsg( dataInd->msdu.p, dataInd->msdu.len, &snff );
   \   00000E   8E82         MOV     DPL,R6
   \   000010   8F83         MOV     DPH,R7
   \   000012   A3           INC     DPTR
   \   000013   A3           INC     DPTR
   \   000014   A3           INC     DPTR
   \   000015   A3           INC     DPTR
   \   000016   E0           MOVX    A,@DPTR
   \   000017   F5..         MOV     ?V0 + 2,A
   \   000019   8E82         MOV     DPL,R6
   \   00001B   8F83         MOV     DPH,R7
   \   00001D   A3           INC     DPTR
   \   00001E   A3           INC     DPTR
   \   00001F   12....       LCALL   ??Subroutine23_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_48:
   \   000022   88..         MOV     ?V0 + 0,R0
   \   000024   89..         MOV     ?V0 + 1,R1
   \   000026                ; Setup parameters for call to function osal_memset
   \   000026   7C1F         MOV     R4,#0x1f
   \   000028   7D00         MOV     R5,#0x0
   \   00002A   7900         MOV     R1,#0x0
   \   00002C   7403         MOV     A,#0x3
   \   00002E   12....       LCALL   ?XSTACK_DISP0_8
   \   000031   AA82         MOV     R2,DPL
   \   000033   AB83         MOV     R3,DPH
   \   000035   12....       LCALL   ??osal_memset?relay
   \   000038   7403         MOV     A,#0x3
   \   00003A   12....       LCALL   ?XSTACK_DISP0_8
   \   00003D   E5..         MOV     A,?V0 + 2
   \   00003F   F0           MOVX    @DPTR,A
   \   000040                ; Setup parameters for call to function NLDE_ParseFrameControl
   \   000040   AC82         MOV     R4,DPL
   \   000042   AD83         MOV     R5,DPH
   \   000044   85..82       MOV     DPL,?V0 + 0
   \   000047   85..83       MOV     DPH,?V0 + 1
   \   00004A   E0           MOVX    A,@DPTR
   \   00004B   FA           MOV     R2,A
   \   00004C   A3           INC     DPTR
   \   00004D   E0           MOVX    A,@DPTR
   \   00004E   FB           MOV     R3,A
   \   00004F   12....       LCALL   ??NLDE_ParseFrameControl?relay
   \   000052   7404         MOV     A,#0x4
   \   000054   12....       LCALL   ?XSTACK_DISP0_8
   \   000057   7402         MOV     A,#0x2
   \   000059   F0           MOVX    @DPTR,A
   \   00005A   E5..         MOV     A,?V0 + 0
   \   00005C   2402         ADD     A,#0x2
   \   00005E   F8           MOV     R0,A
   \   00005F   E5..         MOV     A,?V0 + 1
   \   000061   3400         ADDC    A,#0x0
   \   000063   F9           MOV     R1,A
   \   000064   7420         MOV     A,#0x20
   \   000066   12....       LCALL   ?XSTACK_DISP0_8
   \   000069   E8           MOV     A,R0
   \   00006A   F0           MOVX    @DPTR,A
   \   00006B   A3           INC     DPTR
   \   00006C   E9           MOV     A,R1
   \   00006D   F0           MOVX    @DPTR,A
   \   00006E   7403         MOV     A,#0x3
   \   000070   12....       LCALL   ?XSTACK_DISP0_8
   \   000073   E0           MOVX    A,@DPTR
   \   000074   24FE         ADD     A,#-0x2
   \   000076   C0E0         PUSH    A
   \   000078   741A         MOV     A,#0x1a
   \   00007A   12....       LCALL   ?XSTACK_DISP0_8
   \   00007D   D0E0         POP     A
   \   00007F   F0           MOVX    @DPTR,A
    863          
    864            // Fill in MAC destination address
    865            snff.macDstAddr = dataInd->mac.dstAddr.addr.shortAddr;
   \   000080   EE           MOV     A,R6
   \   000081   241B         ADD     A,#0x1b
   \   000083   F582         MOV     DPL,A
   \   000085   EF           MOV     A,R7
   \   000086   12....       LCALL   ?Subroutine8 & 0xFFFF
   \                     ??CrossCallReturnLabel_51:
   \   000089   7410         MOV     A,#0x10
   \   00008B   12....       LCALL   ?XSTACK_DISP0_8
   \   00008E   E8           MOV     A,R0
   \   00008F   F0           MOVX    @DPTR,A
   \   000090   A3           INC     DPTR
   \   000091   E9           MOV     A,R1
   \   000092   F0           MOVX    @DPTR,A
    866            
    867            // fill in MAC source address (Stub NWK frame doesn't have address fields)
    868            osal_copyAddress( &srcAddr, (zAddrType_t *)&(dataInd->mac.srcAddr) );
   \   000093                ; Setup parameters for call to function sAddrCpy
   \   000093   EE           MOV     A,R6
   \   000094   2412         ADD     A,#0x12
   \   000096   FC           MOV     R4,A
   \   000097   EF           MOV     A,R7
   \   000098   3400         ADDC    A,#0x0
   \   00009A   FD           MOV     R5,A
   \   00009B   7437         MOV     A,#0x37
   \   00009D   12....       LCALL   ?XSTACK_DISP0_8
   \   0000A0   AA82         MOV     R2,DPL
   \   0000A2   AB83         MOV     R3,DPH
   \   0000A4   12....       LCALL   ??sAddrCpy?relay
    869            
    870            // check if incoming frame is of the right type
    871            if ( snff.frameType != STUB_NWK_FRAME_TYPE )
   \   0000A7   7405         MOV     A,#0x5
   \   0000A9   12....       LCALL   ?XSTACK_DISP0_8
   \   0000AC   E0           MOVX    A,@DPTR
   \   0000AD   6403         XRL     A,#0x3
   \   0000AF   6003         JZ      $+5
   \   0000B1   02....       LJMP    ??INTERP_DataIndication_0 & 0xFFFF
    872              return;
    873              
    874            // check if incoming frame is of the right version
    875            if ( snff.protocolVersion != NLME_GetProtocolVersion() )
   \   0000B4                ; Setup parameters for call to function NLME_GetProtocolVersion
   \   0000B4   12....       LCALL   ??NLME_GetProtocolVersion?relay
   \   0000B7   E9           MOV     A,R1
   \   0000B8   FA           MOV     R2,A
   \   0000B9   7406         MOV     A,#0x6
   \   0000BB   12....       LCALL   ?XSTACK_DISP0_8
   \   0000BE   E0           MOVX    A,@DPTR
   \   0000BF   6A           XRL     A,R2
   \   0000C0   6003         JZ      $+5
   \   0000C2   02....       LJMP    ??INTERP_DataIndication_0 & 0xFFFF
    876              return;
    877            
    878            // check if the remaining sun-fields are zero
    879            if ( ( snff.discoverRoute != 0 ) || ( snff.multicast != 0 )   ||
    880                 ( snff.secure != 0 )        || ( snff.srcRouteSet != 0 ) ||
    881                 ( snff.dstExtAddrSet != 0 ) || ( snff.srcExtAddrSet != 0 ) )
   \   0000C5   7407         MOV     A,#0x7
   \   0000C7   12....       LCALL   ?XSTACK_DISP0_8
   \   0000CA   E0           MOVX    A,@DPTR
   \   0000CB   6003         JZ      $+5
   \   0000CD   02....       LJMP    ??INTERP_DataIndication_0 & 0xFFFF
   \   0000D0   7408         MOV     A,#0x8
   \   0000D2   12....       LCALL   ?XSTACK_DISP0_8
   \   0000D5   E0           MOVX    A,@DPTR
   \   0000D6   6003         JZ      $+5
   \   0000D8   02....       LJMP    ??INTERP_DataIndication_0 & 0xFFFF
   \   0000DB   7409         MOV     A,#0x9
   \   0000DD   12....       LCALL   ?XSTACK_DISP0_8
   \   0000E0   E0           MOVX    A,@DPTR
   \   0000E1   6003         JZ      $+5
   \   0000E3   02....       LJMP    ??INTERP_DataIndication_0 & 0xFFFF
   \   0000E6   741B         MOV     A,#0x1b
   \   0000E8   12....       LCALL   ?XSTACK_DISP0_8
   \   0000EB   E0           MOVX    A,@DPTR
   \   0000EC   6003         JZ      $+5
   \   0000EE   02....       LJMP    ??INTERP_DataIndication_0 & 0xFFFF
   \   0000F1   740A         MOV     A,#0xa
   \   0000F3   12....       LCALL   ?XSTACK_DISP0_8
   \   0000F6   E0           MOVX    A,@DPTR
   \   0000F7   6003         JZ      $+5
   \   0000F9   02....       LJMP    ??INTERP_DataIndication_0 & 0xFFFF
   \   0000FC   740B         MOV     A,#0xb
   \   0000FE   12....       LCALL   ?XSTACK_DISP0_8
   \   000101   E0           MOVX    A,@DPTR
   \   000102   6003         JZ      $+5
   \   000104   02....       LJMP    ??INTERP_DataIndication_0 & 0xFFFF
    882            {
    883              return;
    884            }
    885            
    886            // parse the Stub APS header
    887            StubAPS_ParseMsg( &snff, &saff );
   \   000107                ; Setup parameters for call to function StubAPS_ParseMsg
   \   000107   7422         MOV     A,#0x22
   \   000109   12....       LCALL   ?XSTACK_DISP0_8
   \   00010C   AC82         MOV     R4,DPL
   \   00010E   AD83         MOV     R5,DPH
   \   000110   7403         MOV     A,#0x3
   \   000112   12....       LCALL   ?XSTACK_DISP0_8
   \   000115   AA82         MOV     R2,DPL
   \   000117   AB83         MOV     R3,DPH
   \   000119   12....       LCALL   ??StubAPS_ParseMsg?relay
    888          
    889            // check if incoming frame is of the right type
    890            if ( ( saff.FrmCtrl & APS_FRAME_TYPE_MASK ) != STUB_APS_FRAME )
   \   00011C   7422         MOV     A,#0x22
   \   00011E   12....       LCALL   ?XSTACK_DISP0_8
   \   000121   E0           MOVX    A,@DPTR
   \   000122   5403         ANL     A,#0x3
   \   000124   6403         XRL     A,#0x3
   \   000126   6003         JZ      $+5
   \   000128   02....       LJMP    ??INTERP_DataIndication_0 & 0xFFFF
    891              return;
    892             
    893            // check if delivery mode is of the right type
    894            if ( ( saff.FrmCtrl & APS_DELIVERYMODE_MASK ) == APS_FC_DM_INDIRECT )
   \   00012B   E0           MOVX    A,@DPTR
   \   00012C   540C         ANL     A,#0xc
   \   00012E   6404         XRL     A,#0x4
   \   000130   7003         JNZ     $+5
   \   000132   02....       LJMP    ??INTERP_DataIndication_0 & 0xFFFF
    895              return;
    896            
    897            // check if incoming frame is unsecured
    898            if ( saff.FrmCtrl & APS_FC_SECURITY )
   \   000135   E0           MOVX    A,@DPTR
   \   000136   54A0         ANL     A,#0xa0
   \   000138   6003         JZ      $+5
   \   00013A   02....       LJMP    ??INTERP_DataIndication_0 & 0xFFFF
    899              return;
    900            
    901            // check if there's no extended header
    902            if ( saff.FrmCtrl & APS_FC_EXTENDED )
    903                return;
    904            
    905            // Set the endpoints
    906            saff.DstEndPoint = appEndPoint;
   \   00013D   90....       MOV     DPTR,#appEndPoint
   \   000140   E0           MOVX    A,@DPTR
   \   000141   C0E0         PUSH    A
   \   000143   7424         MOV     A,#0x24
   \   000145   12....       LCALL   ?XSTACK_DISP0_8
   \   000148   D0E0         POP     A
   \   00014A   F0           MOVX    @DPTR,A
    907            saff.SrcEndPoint = STUBAPS_INTER_PAN_EP;
   \   00014B   7425         MOV     A,#0x25
   \   00014D   12....       LCALL   ?XSTACK_DISP0_8
   \   000150   74FE         MOV     A,#-0x2
   \   000152   F0           MOVX    @DPTR,A
    908            
    909            // Set the signal strength information
    910            sig.LinkQuality = dataInd->mac.mpduLinkQuality;
   \   000153   EE           MOV     A,R6
   \   000154   242E         ADD     A,#0x2e
   \   000156   12....       LCALL   ?Subroutine15 & 0xFFFF
   \                     ??CrossCallReturnLabel_42:
   \   000159   85..82       MOV     DPL,?XSP + 0
   \   00015C   85..83       MOV     DPH,?XSP + 1
   \   00015F   F0           MOVX    @DPTR,A
    911            sig.correlation = dataInd->mac.correlation;
   \   000160   EE           MOV     A,R6
   \   000161   242F         ADD     A,#0x2f
   \   000163   12....       LCALL   ?Subroutine15 & 0xFFFF
   \                     ??CrossCallReturnLabel_43:
   \   000166   C0E0         PUSH    A
   \   000168   7401         MOV     A,#0x1
   \   00016A   12....       LCALL   ?XSTACK_DISP0_8
   \   00016D   D0E0         POP     A
   \   00016F   F0           MOVX    @DPTR,A
    912            sig.rssi = dataInd->mac.rssi;
   \   000170   EE           MOV     A,R6
   \   000171   2430         ADD     A,#0x30
   \   000173   12....       LCALL   ?Subroutine15 & 0xFFFF
   \                     ??CrossCallReturnLabel_44:
   \   000176   C0E0         PUSH    A
   \   000178   7402         MOV     A,#0x2
   \   00017A   12....       LCALL   ?XSTACK_DISP0_8
   \   00017D   D0E0         POP     A
   \   00017F   F0           MOVX    @DPTR,A
    913            
    914            APSDE_DataIndication( &saff, &srcAddr, dataInd->mac.srcPanId, 
    915                                  &sig, FALSE, dataInd->mac.timestamp );
   \   000180                ; Setup parameters for call to function APSDE_DataIndication
   \   000180   EE           MOV     A,R6
   \   000181   2424         ADD     A,#0x24
   \   000183   12....       LCALL   ??Subroutine19_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_28:
   \   000186   12....       LCALL   ?PUSH_XSTACK8_X_FOUR
   \   000189   7404         MOV     A,#0x4
   \   00018B   12....       LCALL   ?XSTACK_DISP0_8
   \   00018E   8582..       MOV     ?V0 + 0,DPL
   \   000191   8583..       MOV     ?V0 + 1,DPH
   \   000194   78..         MOV     R0,#?V0 + 0
   \   000196   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000199   EE           MOV     A,R6
   \   00019A   242A         ADD     A,#0x2a
   \   00019C   12....       LCALL   ??Subroutine19_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_29:
   \   00019F   12....       LCALL   ?PUSH_XSTACK8_X_TWO
   \   0001A2   7900         MOV     R1,#0x0
   \   0001A4   743F         MOV     A,#0x3f
   \   0001A6   12....       LCALL   ?XSTACK_DISP0_8
   \   0001A9   AC82         MOV     R4,DPL
   \   0001AB   AD83         MOV     R5,DPH
   \   0001AD   742A         MOV     A,#0x2a
   \   0001AF   12....       LCALL   ?XSTACK_DISP0_8
   \   0001B2   AA82         MOV     R2,DPL
   \   0001B4   AB83         MOV     R3,DPH
   \   0001B6   12....       LCALL   ??APSDE_DataIndication?relay
   \   0001B9   7408         MOV     A,#0x8
   \   0001BB   12....       LCALL   ?DEALLOC_XSTACK8
    916          
    917          } /* INTERP_DataIndication */
   \                     ??INTERP_DataIndication_0:
   \   0001BE   7440         MOV     A,#0x40
   \   0001C0   12....       LCALL   ?DEALLOC_XSTACK8
   \   0001C3   02....       LJMP    ?Subroutine1 & 0xFFFF

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for StubAPS_TaskID>`:
   \   000000   FF           DB 255

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for appTaskID>`:
   \   000000   FF           DB 255

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??StubAPS_Init?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    StubAPS_Init

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??StubAPS_ProcessEvent?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    StubAPS_ProcessEvent

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??StubAPS_ParseMsg?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    StubAPS_ParseMsg

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??StubAPS_BuildFrameControl?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    StubAPS_BuildFrameControl

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??StubAPS_BuildMsg?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    StubAPS_BuildMsg

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??StubAPS_SetNewChannel?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    StubAPS_SetNewChannel

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??StubAPS_SetInterPanChannel?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    StubAPS_SetInterPanChannel

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??StubAPS_SetIntraPanChannel?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    StubAPS_SetIntraPanChannel

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??StubAPS_InterPan?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    StubAPS_InterPan

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??StubAPS_RegisterApp?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    StubAPS_RegisterApp

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??StubAPS_ZMacCallback?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    StubAPS_ZMacCallback

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??INTERP_DataReq?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    INTERP_DataReq

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??INTERP_DataReqMTU?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    INTERP_DataReqMTU

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??INTERP_DataConfirm?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    INTERP_DataConfirm

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??INTERP_DataIndication?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    INTERP_DataIndication
    918          
    919          
    920          /*********************************************************************
    921          *********************************************************************/

   Maximum stack usage in bytes:

     Function                       ISTACK PSTACK XSTACK
     --------                       ------ ------ ------
     INTERP_DataConfirm                 2      0     13
       -> afDataConfirm                 4      0      0
     INTERP_DataIndication              1      0     96
       -> osal_memset                   0      0    150
       -> NLDE_ParseFrameControl        0      0    150
       -> sAddrCpy                      0      0    150
       -> NLME_GetProtocolVersion       0      0    150
       -> StubAPS_ParseMsg              0      0    150
       -> APSDE_DataIndication          0      0    166
     INTERP_DataReq                     1      0     51
       -> StubAPS_InterPan              0      0     94
       -> osal_memset                   0      0     94
       -> StubAPS_BuildFrameControl     0      0    102
       -> osal_mem_alloc                0      0     94
       -> StubAPS_BuildMsg              0      0     98
       -> NLME_GetProtocolVersion       0      0     94
       -> ZMacDataReq                   0      0     94
       -> osal_mem_free                 0      0     94
     INTERP_DataReqMTU                  0      0      0
     StubAPS_BuildFrameControl          1      0     62
       -> sAddrExtCpy                   0      0     22
     StubAPS_BuildMsg                   1      0     67
       -> osal_memcpy                   0      0     36
     StubAPS_Init                       2      0      0
     StubAPS_InterPan                   0      0     57
       -> ZMacGetReq                    0      0     20
     StubAPS_ParseMsg                   1      0     85
       -> osal_memset                   0      0     20
     StubAPS_ProcessEvent               1      0     13
       -> StubAPS_SetNewChannel         0      0     26
       -> ZMacSetReq                    0      0     26
       -> nwk_setStateIdle              0      0     26
       -> osal_msg_allocate             0      0     26
       -> osal_msg_send                 0      0     26
       -> INTERP_DataIndication         0      0     26
       -> osal_msg_deallocate           0      0     26
       -> osal_msg_receive              0      0     26
       -> INTERP_DataConfirm            0      0     26
     StubAPS_RegisterApp                2      0      0
     StubAPS_SetInterPanChannel         1      0     11
       -> ZMacGetReq                    0      0     22
       -> nwk_setStateIdle              0      0     22
       -> ZMacSetReq                    0      0     22
       -> StubAPS_SetNewChannel         0      0     22
       -> osal_start_timerEx            0      0     22
     StubAPS_SetIntraPanChannel         3      0      2
       -> ZMacGetReq                    4      0      4
       -> ZMacSetReq                    4      0      4
       -> ZMacSetReq                    4      0      4
       -> ZMacSetReq                    4      0      4
       -> nwk_setStateIdle              4      0      4
     StubAPS_SetNewChannel              3      0     15
       -> nwkDB_CountTypes              4      0      4
       -> ZMacStateIdle                 4      0      4
       -> ZMacSetReq                    4      0      4
       -> ZMacSetReq                    4      0      4
     StubAPS_ZMacCallback               2      0      0
       -> osal_msg_send                 4      0      0


   Segment part sizes:

     Function/Label                     Bytes
     --------------                     -----
     StubAPS_TaskID                        1
     newChannel                            1
     channelChangeInProgress               1
     appTaskID                             1
     appEndPoint                           1
     StubAPS_Init                         22
     ??Subroutine21_0                      7
     StubAPS_ProcessEvent                159
     ?Subroutine17                        17
     ?Subroutine4                         16
     StubAPS_ParseMsg                    221
     ?Subroutine13                        14
     ?Subroutine7                         15
     ?Subroutine3                          2
     ??Subroutine18_0                     18
     ?Subroutine16                         3
     ??Subroutine19_0                      8
     ??Subroutine22_0                      6
     ?Subroutine14                        10
     ?Subroutine8                          4
     ??Subroutine23_0                      6
     StubAPS_BuildFrameControl           238
     ?Subroutine1                          5
     ?Subroutine6                         17
     ?Subroutine10                         6
     StubAPS_BuildMsg                    110
     ?Subroutine12                        16
     ?Subroutine9                         19
     ?Subroutine15                         3
     StubAPS_SetNewChannel                62
     ??Subroutine20_0                      4
     ?Subroutine0                          5
     StubAPS_SetInterPanChannel           95
     ?Subroutine2                          8
     ?Subroutine5                          1
     StubAPS_SetIntraPanChannel           75
     StubAPS_InterPan                     81
     StubAPS_RegisterApp                  27
     ?Subroutine11                        10
     StubAPS_ZMacCallback                 74
     INTERP_DataReq                      388
     INTERP_DataReqMTU                     5
     INTERP_DataConfirm                   34
     INTERP_DataIndication               454
     ?<Initializer for StubAPS_TaskID>     1
     ?<Initializer for appTaskID>          1
     ??StubAPS_Init?relay                  6
     ??StubAPS_ProcessEvent?relay          6
     ??StubAPS_ParseMsg?relay              6
     ??StubAPS_BuildFrameControl?relay     6
     ??StubAPS_BuildMsg?relay              6
     ??StubAPS_SetNewChannel?relay         6
     ??StubAPS_SetInterPanChannel?relay    6
     ??StubAPS_SetIntraPanChannel?relay    6
     ??StubAPS_InterPan?relay              6
     ??StubAPS_RegisterApp?relay           6
     ??StubAPS_ZMacCallback?relay          6
     ??INTERP_DataReq?relay                6
     ??INTERP_DataReqMTU?relay             6
     ??INTERP_DataConfirm?relay            6
     ??INTERP_DataIndication?relay         6

 
 2 265 bytes in segment BANKED_CODE
    90 bytes in segment BANK_RELAYS
     2 bytes in segment XDATA_I
     2 bytes in segment XDATA_ID
     3 bytes in segment XDATA_Z
 
 2 357 bytes of CODE  memory
     5 bytes of XDATA memory

Errors: none
Warnings: none
