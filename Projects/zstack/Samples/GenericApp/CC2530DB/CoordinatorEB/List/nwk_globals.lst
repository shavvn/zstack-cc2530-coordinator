###############################################################################
#                                                                             #
# IAR C/C++ Compiler V7.60.1.40026 for 8051             08/Apr/2014  21:42:42 #
# Copyright (C) 2004-2010 IAR Systems AB.                                     #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data_rom                                           #
#    Dptr setup         =  1,16                                               #
#    Source file        =  D:\zigbee\projects\zstack-cc2530-coordinator\Compo #
#                          nents\stack\nwk\nwk_globals.c                      #
#    Command line       =  -f D:\zigbee\projects\zstack-cc2530-coordinator\Pr #
#                          ojects\zstack\Samples\GenericApp\CC2530DB\..\..\.. #
#                          \Tools\CC2530DB\f8wCoord.cfg (-DCPU32MHZ           #
#                          -DROOT=__near_func -DMAC_CFG_APP_PENDING_QUEUE=TRU #
#                          E -DMAC_CFG_TX_DATA_MAX=5 -DMAC_CFG_TX_MAX=8       #
#                          -DMAC_CFG_RX_MAX=5 -DZDO_COORDINATOR -DRTR_NWK)    #
#                          -f D:\zigbee\projects\zstack-cc2530-coordinator\Pr #
#                          ojects\zstack\Samples\GenericApp\CC2530DB\..\..\.. #
#                          \Tools\CC2530DB\f8wConfig.cfg (-DZIGBEEPRO         #
#                          -DSECURE=0 -DZG_SECURE_DYNAMIC=0 -DREFLECTOR       #
#                          -DDEFAULT_CHANLIST=0x00000800                      #
#                          -DZDAPP_CONFIG_PAN_ID=0x1111                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DLINK_STATUS_JITTER_MASK=0x007F                   #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3    #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40           #
#                          -DNWK_MAX_BINDING_ENTRIES=4                        #
#                          -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DMAC_MAX_FRAME_SIZE=116                           #
#                          -DZDNWKMGR_MIN_TRANSMISSIONS=20 "-DCONST=const     #
#                          __code" -DGENERIC=__generic                        #
#                          -DRFD_RCVC_ALWAYS_ON=FALSE -DPOLL_RATE=1000        #
#                          -DQUEUED_POLL_RATE=100 -DRESPONSE_POLL_RATE=100)   #
#                          -DREJOIN_POLL_RATE=440 D:\zigbee\projects\zstack-c #
#                          c2530-coordinator\Components\stack\nwk\nwk_globals #
#                          .c -D ZAPP_P1 -D MT_TASK -D MT_SYS_FUNC -D         #
#                          MT_ZDO_FUNC -D LCD_SUPPORTED=DEBUG -lC             #
#                          D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\Coordinator #
#                          EB\List\ -lA D:\zigbee\projects\zstack-cc2530-coor #
#                          dinator\Projects\zstack\Samples\GenericApp\CC2530D #
#                          B\CoordinatorEB\List\ --diag_suppress Pe001,Pa010  #
#                          -o D:\zigbee\projects\zstack-cc2530-coordinator\Pr #
#                          ojects\zstack\Samples\GenericApp\CC2530DB\Coordina #
#                          torEB\Obj\ -e --require_prototypes                 #
#                          --no_code_motion --debug --core=plain --dptr=16,1  #
#                          --data_model=large --code_model=banked             #
#                          --calling_convention=xdata_reentrant               #
#                          --place_constants=data_rom --nr_virtual_regs 16    #
#                          -I D:\zigbee\projects\zstack-cc2530-coordinator\Pr #
#                          ojects\zstack\Samples\GenericApp\CC2530DB\ -I      #
#                          D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\Source\  #
#                          -I D:\zigbee\projects\zstack-cc2530-coordinator\Pr #
#                          ojects\zstack\Samples\GenericApp\CC2530DB\..\..\.. #
#                          \ZMain\TI2530DB\ -I D:\zigbee\projects\zstack-cc25 #
#                          30-coordinator\Projects\zstack\Samples\GenericApp\ #
#                          CC2530DB\..\..\..\..\..\Components\hal\include\    #
#                          -I D:\zigbee\projects\zstack-cc2530-coordinator\Pr #
#                          ojects\zstack\Samples\GenericApp\CC2530DB\..\..\.. #
#                          \..\..\Components\hal\target\CC2530EB\ -I          #
#                          D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\mac\include\ -I                     #
#                          D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\mac\high_level\ -I                  #
#                          D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\mac\low_level\srf04\ -I             #
#                          D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\mac\low_level\srf04\single_chip\    #
#                          -I D:\zigbee\projects\zstack-cc2530-coordinator\Pr #
#                          ojects\zstack\Samples\GenericApp\CC2530DB\..\..\.. #
#                          \..\..\Components\mt\ -I                           #
#                          D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\osal\include\ -I                    #
#                          D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\osal\mcu\ccsoc\ -I                  #
#                          D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\services\saddr\ -I                  #
#                          D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\services\sdata\ -I                  #
#                          D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\stack\af\ -I                        #
#                          D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\stack\nwk\ -I                       #
#                          D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\stack\sapi\ -I                      #
#                          D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\stack\sec\ -I                       #
#                          D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\stack\sys\ -I                       #
#                          D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\stack\zdo\ -I                       #
#                          D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\zmac\ -I D:\zigbee\projects\zstack- #
#                          cc2530-coordinator\Projects\zstack\Samples\Generic #
#                          App\CC2530DB\..\..\..\..\..\Components\zmac\f8w\   #
#                          -I "C:\Program Files (x86)\IAR Systems\Embedded    #
#                          Workbench 5.4\8051\INC\" -I "C:\Program Files      #
#                          (x86)\IAR Systems\Embedded Workbench               #
#                          5.4\8051\INC\CLIB\" -Ohz                           #
#    List file          =  D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\Coordinator #
#                          EB\List\nwk_globals.lst                            #
#    Object file        =  D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\Coordinator #
#                          EB\Obj\nwk_globals.r51                             #
#                                                                             #
#                                                                             #
###############################################################################

D:\zigbee\projects\zstack-cc2530-coordinator\Components\stack\nwk\nwk_globals.c
      1          /**************************************************************************************************
      2            Filename:       nwk_globals.c
      3            Revised:        $Date: 2010-09-09 09:46:48 -0700 (Thu, 09 Sep 2010) $
      4            Revision:       $Revision: 23706 $
      5          
      6            Description:    User definable Network Parameters.
      7          
      8          
      9            Copyright 2004-2010 Texas Instruments Incorporated. All rights reserved.
     10          
     11            IMPORTANT: Your use of this Software is limited to those specific rights
     12            granted under the terms of a software license agreement between the user
     13            who downloaded the software, his/her employer (which must be your employer)
     14            and Texas Instruments Incorporated (the "License").  You may not use this
     15            Software unless you agree to abide by the terms of the License. The License
     16            limits your use, and you acknowledge, that the Software may not be modified,
     17            copied or distributed unless embedded on a Texas Instruments microcontroller
     18            or used solely and exclusively in conjunction with a Texas Instruments radio
     19            frequency transceiver, which is integrated into your product.  Other than for
     20            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     21            works of, modify, distribute, perform, display or sell this Software and/or
     22            its documentation for any purpose.
     23          
     24            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     25            PROVIDED “AS IS” WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED,
     26            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE,
     27            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     28            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     29            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     30            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     31            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     32            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     33            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     34            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     35          
     36            Should you have any questions regarding your right to use this Software,
     37            contact Texas Instruments Incorporated at www.TI.com.
     38          **************************************************************************************************/
     39          
     40          /*********************************************************************
     41           * INCLUDES
     42           */
     43          #include "ZComdef.h"
     44          #include "OSAL.h"
     45          #include "AddrMgr.h"
     46          #include "AssocList.h"
     47          #include "BindingTable.h"
     48          #include "nwk_util.h"
     49          #include "nwk_globals.h"
     50          #include "APS.h"
     51          #include "ssp.h"
     52          #include "rtg.h"
     53          #include "ZDConfig.h"
     54          #include "ZGlobals.h"
     55          
     56          #if defined ( LCD_SUPPORTED )
     57            #include "OnBoard.h"
     58          #endif
     59          
     60          /* HAL */
     61          #include "hal_lcd.h"
     62          
     63          /*********************************************************************
     64           * MACROS
     65           */
     66          
     67          /*********************************************************************
     68           * CONSTANTS
     69           */
     70          
     71          // Maximums for the data buffer queue
     72          #define NWK_MAX_DATABUFS_WAITING    8     // Waiting to be sent to MAC
     73          #define NWK_MAX_DATABUFS_SCHEDULED  5     // Timed messages to be sent
     74          #define NWK_MAX_DATABUFS_CONFIRMED  5     // Held after MAC confirms
     75          #define NWK_MAX_DATABUFS_TOTAL      12    // Total number of buffers
     76          
     77          // 1-255 (0 -> 256) X RTG_TIMER_INTERVAL
     78          // A known shortcoming is that when a message is enqueued as "hold" for a
     79          // sleeping device, the timer tick may have counted down to 1, so that msg
     80          // will not be held as long as expected. If NWK_INDIRECT_MSG_TIMEOUT is set to 1
     81          // the hold time will vary randomly from 0 - CNT_RTG_TIMER ticks.
     82          // So the hold time will vary within this interval:
     83          // { (NWK_INDIRECT_MSG_TIMEOUT-1)*CNT_RTG_TIMER,
     84          //                                    NWK_INDIRECT_MSG_TIMEOUT*CNT_RTG_TIMER }
     85          #define NWK_INDIRECT_CNT_RTG_TMR    1
     86          // To hold msg for sleeping end devices for 30 secs:
     87          // #define CNT_RTG_TIMER            1
     88          // #define NWK_INDIRECT_MSG_TIMEOUT 30
     89          // To hold msg for sleeping end devices for 30 mins:
     90          // #define CNT_RTG_TIMER            60
     91          // #define NWK_INDIRECT_MSG_TIMEOUT 30
     92          // To hold msg for sleeping end devices for 30 days:
     93          // #define CNT_RTG_TIMER            60
     94          // #define NWK_INDIRECT_MSG_TIMEOUT (30 * 24 * 60)
     95          // Maximum msgs to hold per associated device.
     96          #define NWK_INDIRECT_MSG_MAX_PER    3
     97          // Maximum total msgs to hold for all associated devices.
     98          #define NWK_INDIRECT_MSG_MAX_ALL    \
     99                                      (NWK_MAX_DATABUFS_TOTAL - NWK_INDIRECT_MSG_MAX_PER)
    100          
    101          /*********************************************************************
    102           * TYPEDEFS
    103           */
    104          
    105          /*********************************************************************
    106           * NWK GLOBAL VARIABLES
    107           */
    108          
    109          // Variables for MAX list size

   \                                 In  segment CODE_C, align 1
    110          CONST uint16 gNWK_MAX_DEVICE_LIST = NWK_MAX_DEVICES;
   \                     gNWK_MAX_DEVICE_LIST:
   \   000000   1500         DW 21
    111          
    112          // Variables for MAX Sleeping End Devices

   \                                 In  segment CODE_C, align 1
    113          CONST uint8 gNWK_MAX_SLEEPING_END_DEVICES = NWK_MAX_DEVICES - NWK_MAX_ROUTERS;
   \                     gNWK_MAX_SLEEPING_END_DEVICES:
   \   000000   0F           DB 15
    114          
    115          // Variables for MAX data buffer levels

   \                                 In  segment CODE_C, align 1
    116          CONST uint8 gNWK_MAX_DATABUFS_WAITING = NWK_MAX_DATABUFS_WAITING;
   \                     gNWK_MAX_DATABUFS_WAITING:
   \   000000   08           DB 8

   \                                 In  segment CODE_C, align 1
    117          CONST uint8 gNWK_MAX_DATABUFS_SCHEDULED = NWK_MAX_DATABUFS_SCHEDULED;
   \                     gNWK_MAX_DATABUFS_SCHEDULED:
   \   000000   05           DB 5

   \                                 In  segment CODE_C, align 1
    118          CONST uint8 gNWK_MAX_DATABUFS_CONFIRMED = NWK_MAX_DATABUFS_CONFIRMED;
   \                     gNWK_MAX_DATABUFS_CONFIRMED:
   \   000000   05           DB 5

   \                                 In  segment CODE_C, align 1
    119          CONST uint8 gNWK_MAX_DATABUFS_TOTAL = NWK_MAX_DATABUFS_TOTAL;
   \                     gNWK_MAX_DATABUFS_TOTAL:
   \   000000   0C           DB 12
    120          

   \                                 In  segment CODE_C, align 1
    121          CONST uint8 gNWK_INDIRECT_CNT_RTG_TMR = NWK_INDIRECT_CNT_RTG_TMR;
   \                     gNWK_INDIRECT_CNT_RTG_TMR:
   \   000000   01           DB 1

   \                                 In  segment CODE_C, align 1
    122          CONST uint8 gNWK_INDIRECT_MSG_MAX_PER = NWK_INDIRECT_MSG_MAX_PER;
   \                     gNWK_INDIRECT_MSG_MAX_PER:
   \   000000   03           DB 3

   \                                 In  segment CODE_C, align 1
    123          CONST uint8 gNWK_INDIRECT_MSG_MAX_ALL = NWK_INDIRECT_MSG_MAX_ALL;
   \                     gNWK_INDIRECT_MSG_MAX_ALL:
   \   000000   09           DB 9
    124          
    125          // change this if using a different stack profile...
    126          // Cskip array

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    127          uint16 *Cskip;
   \                     Cskip:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z
    128          
    129          #if ( STACK_PROFILE_ID == ZIGBEEPRO_PROFILE )

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    130            uint8 CskipRtrs[1] = {0};
   \                     CskipRtrs:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    131            uint8 CskipChldrn[1] = {0};
   \                     CskipChldrn:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    132          #elif ( STACK_PROFILE_ID == HOME_CONTROLS )
    133            uint8 CskipRtrs[MAX_NODE_DEPTH+1] = {6,6,6,6,6,0};
    134            uint8 CskipChldrn[MAX_NODE_DEPTH+1] = {20,20,20,20,20,0};
    135          #elif ( STACK_PROFILE_ID == GENERIC_STAR )
    136            uint8 CskipRtrs[MAX_NODE_DEPTH+1] = {5,5,5,5,5,0};
    137            uint8 CskipChldrn[MAX_NODE_DEPTH+1] = {5,5,5,5,5,0};
    138          #elif ( STACK_PROFILE_ID == NETWORK_SPECIFIC )
    139            uint8 CskipRtrs[MAX_NODE_DEPTH+1] = {5,5,5,5,5,0};
    140            uint8 CskipChldrn[MAX_NODE_DEPTH+1] = {5,5,5,5,5,0};
    141          #endif // STACK_PROFILE_ID
    142          
    143          // Minimum lqi value that is required for association

   \                                 In  segment XDATA_I, align 1, keep-with-next
    144          uint8 gMIN_TREE_LINK_COST = MIN_LQI_COST_3;
   \                     gMIN_TREE_LINK_COST:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for gMIN_TREE_LINK_COST>`
   \   000001                REQUIRE __INIT_XDATA_I
    145          
    146          // Statically defined Associated Device List

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    147          associated_devices_t AssociatedDevList[NWK_MAX_DEVICES];
   \                     AssociatedDevList:
   \   000000                DS 378
   \   00017A                REQUIRE __INIT_XDATA_Z
    148          

   \                                 In  segment CODE_C, align 1
    149          CONST uint16 gMAX_RTG_ENTRIES = MAX_RTG_ENTRIES;
   \                     gMAX_RTG_ENTRIES:
   \   000000   2800         DW 40

   \                                 In  segment CODE_C, align 1
    150          CONST uint16 gMAX_RTG_SRC_ENTRIES = MAX_RTG_SRC_ENTRIES;
   \                     gMAX_RTG_SRC_ENTRIES:
   \   000000   0C00         DW 12

   \                                 In  segment CODE_C, align 1
    151          CONST uint8 gMAX_RREQ_ENTRIES = MAX_RREQ_ENTRIES;
   \                     gMAX_RREQ_ENTRIES:
   \   000000   08           DB 8
    152          

   \                                 In  segment CODE_C, align 1
    153          CONST uint8 gMAX_NEIGHBOR_ENTRIES = MAX_NEIGHBOR_ENTRIES;
   \                     gMAX_NEIGHBOR_ENTRIES:
   \   000000   10           DB 16
    154          
    155           // Table of neighboring nodes (not including child nodes)

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    156          neighborEntry_t neighborTable[MAX_NEIGHBOR_ENTRIES];
   \                     neighborTable:
   \   000000                DS 368
   \   000170                REQUIRE __INIT_XDATA_Z
    157          

   \                                 In  segment CODE_C, align 1
    158          CONST uint8 gMAX_SOURCE_ROUTE = MAX_SOURCE_ROUTE;
   \                     gMAX_SOURCE_ROUTE:
   \   000000   0C           DB 12
    159          

   \                                 In  segment CODE_C, align 1
    160          CONST uint8 gMAX_BROADCAST_QUEUED = MAX_BROADCAST_QUEUED;
   \                     gMAX_BROADCAST_QUEUED:
   \   000000   0A           DB 10
    161          

   \                                 In  segment CODE_C, align 1
    162          CONST uint8 gLINK_DOWN_TRIGGER = LINK_DOWN_TRIGGER;
   \                     gLINK_DOWN_TRIGGER:
   \   000000   03           DB 3
    163          

   \                                 In  segment CODE_C, align 1
    164          CONST uint8 gMAX_PASSIVE_ACK_CNT = MAX_PASSIVE_ACK_CNT;
   \                     gMAX_PASSIVE_ACK_CNT:
   \   000000   08           DB 8
    165          
    166          // Routing table

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    167          rtgEntry_t rtgTable[MAX_RTG_ENTRIES];
   \                     rtgTable:
   \   000000                DS 280
   \   000118                REQUIRE __INIT_XDATA_Z
    168          
    169          #if defined ( ZIGBEE_SOURCE_ROUTING )

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    170            rtgSrcEntry_t rtgSrcTable[MAX_RTG_SRC_ENTRIES];
   \                     rtgSrcTable:
   \   000000                DS 72
   \   000048                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    171            uint16 rtgSrcRelayList[MAX_SOURCE_ROUTE];
   \                     rtgSrcRelayList:
   \   000000                DS 24
   \   000018                REQUIRE __INIT_XDATA_Z
    172          #endif
    173          
    174          // Table of current RREQ packets in the network

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    175          rtDiscEntry_t rtDiscTable[MAX_RREQ_ENTRIES];
   \                     rtDiscTable:
   \   000000                DS 64
   \   000040                REQUIRE __INIT_XDATA_Z
    176          
    177          // Table of data broadcast packets currently in circulation.

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    178          bcastEntry_t bcastTable[MAX_BCAST];
   \                     bcastTable:
   \   000000                DS 72
   \   000048                REQUIRE __INIT_XDATA_Z
    179          
    180          // These 2 arrays are to be used as an array of struct { uint8, uint32 }.

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    181          uint8 bcastHoldHandle[MAX_BCAST];
   \                     bcastHoldHandle:
   \   000000                DS 9
   \   000009                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    182          uint32 bcastHoldAckMask[MAX_BCAST];
   \                     bcastHoldAckMask:
   \   000000                DS 36
   \   000024                REQUIRE __INIT_XDATA_Z
    183          

   \                                 In  segment CODE_C, align 1
    184          CONST uint8 gMAX_BCAST = MAX_BCAST;
   \                     gMAX_BCAST:
   \   000000   09           DB 9
    185          
    186          // For tree addressing, this switch allows the allocation of a
    187          // router address to an end device when end device address are
    188          // all used up.  If this option is enabled, address space
    189          // could be limited.

   \                                 In  segment CODE_C, align 1
    190          CONST uint8 gNWK_TREE_ALLOCATE_ROUTERADDR_FOR_ENDDEVICE = FALSE;
   \                     gNWK_TREE_ALLOCATE_ROUTERADDR_FOR_ENDDEVICE:
   \   000000   00           DB 0
    191          
    192          #if defined ( ZIGBEE_STOCHASTIC_ADDRESSING )
    193          // number of link status periods after the last received address conflict report
    194          // (network status command)

   \                                 In  segment CODE_C, align 1
    195          CONST uint8 gNWK_CONFLICTED_ADDR_EXPIRY_TIME = NWK_CONFLICTED_ADDR_EXPIRY_TIME;
   \                     gNWK_CONFLICTED_ADDR_EXPIRY_TIME:
   \   000000   04           DB 4
    196          #endif
    197          
    198          #if defined ( ZIGBEE_FREQ_AGILITY )

   \                                 In  segment CODE_C, align 1
    199          CONST uint8 gNWK_FREQ_AGILITY_ALL_MAC_ERRS = NWK_FREQ_AGILITY_ALL_MAC_ERRS;
   \                     gNWK_FREQ_AGILITY_ALL_MAC_ERRS:
   \   000000   00           DB 0
    200          #endif
    201          
    202          // The time limited to one MTO RReq (Concentrator Announce) in milliseconds.

   \                                 In  segment CODE_C, align 1
    203          CONST uint16 gMTO_RREQ_LIMIT_TIME = MTO_RREQ_LIMIT_TIME;
   \                     gMTO_RREQ_LIMIT_TIME:
   \   000000   E803         DW 1000
    204          
    205          // The number of seconds a MTO routing entry will last.

   \                                 In  segment CODE_C, align 1
    206          CONST uint8 gMTO_ROUTE_EXPIRY_TIME = MTO_ROUTE_EXPIRY_TIME;
   \                     gMTO_ROUTE_EXPIRY_TIME:
   \   000000   FF           DB 255
    207          
    208          // Route Discovery Request Default Radius

   \                                 In  segment CODE_C, align 1
    209          CONST uint8 gDEFAULT_ROUTE_REQUEST_RADIUS = DEFAULT_ROUTE_REQUEST_RADIUS;
   \                     gDEFAULT_ROUTE_REQUEST_RADIUS:
   \   000000   1E           DB 30
    210          
    211          // Network message radius

   \                                 In  segment CODE_C, align 1
    212          CONST uint8 gDEF_NWK_RADIUS = DEF_NWK_RADIUS;
   \                     gDEF_NWK_RADIUS:
   \   000000   1E           DB 30
    213          
    214          #if ( ZSTACK_ROUTER_BUILD )

   \                                 In  segment CODE_C, align 1
    215          CONST uint16 gLINK_STATUS_JITTER_MASK = LINK_STATUS_JITTER_MASK;
   \                     gLINK_STATUS_JITTER_MASK:
   \   000000   7F00         DW 127
    216          #endif
    217          
    218          /*********************************************************************
    219           * APS GLOBAL VARIABLES
    220           */
    221          
    222          // The Maximum number of binding records
    223          // This number is defined in BindingTable.h - change it there.

   \                                 In  segment CODE_C, align 1
    224          CONST uint16 gNWK_MAX_BINDING_ENTRIES = NWK_MAX_BINDING_ENTRIES;
   \                     gNWK_MAX_BINDING_ENTRIES:
   \   000000   0400         DW 4
    225          
    226          #if defined ( REFLECTOR )
    227            // The Maximum number of cluster IDs in a binding record
    228            // This number is defined in BindingTable.h - change it there.

   \                                 In  segment CODE_C, align 1
    229            CONST uint8 gMAX_BINDING_CLUSTER_IDS = MAX_BINDING_CLUSTER_IDS;
   \                     gMAX_BINDING_CLUSTER_IDS:
   \   000000   04           DB 4
    230          

   \                                 In  segment CODE_C, align 1
    231            CONST uint16 gBIND_REC_SIZE = sizeof( BindingEntry_t );
   \                     gBIND_REC_SIZE:
   \   000000   0E00         DW 14
    232          
    233            // Binding Table

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    234            BindingEntry_t BindingTable[NWK_MAX_BINDING_ENTRIES];
   \                     BindingTable:
   \   000000                DS 56
   \   000038                REQUIRE __INIT_XDATA_Z
    235          #endif
    236          
    237          // Maximum number allowed in the groups table.

   \                                 In  segment CODE_C, align 1
    238          CONST uint8 gAPS_MAX_GROUPS = APS_MAX_GROUPS;
   \                     gAPS_MAX_GROUPS:
   \   000000   10           DB 16
    239          
    240          // APS End Device Broadcast Table
    241          #if ( ZG_BUILD_ENDDEVICE_TYPE )
    242            apsEndDeviceBroadcast_t apsEndDeviceBroadcastTable[APS_MAX_ENDDEVICE_BROADCAST_ENTRIES];
    243            uint8 gAPS_MAX_ENDDEVICE_BROADCAST_ENTRIES = APS_MAX_ENDDEVICE_BROADCAST_ENTRIES;
    244          #endif
    245          
    246          /*********************************************************************
    247           * SECURITY GLOBAL VARIABLES
    248           */
    249          
    250          // This is the default pre-configured key,
    251          // change this to make a unique key
    252          // SEC_KEY_LEN is defined in ssp.h.
    253          
    254          #if defined ( DEFAULT_KEY )

   \                                 In  segment CODE_C, align 1
    255          CONST uint8 defaultKey[SEC_KEY_LEN] = DEFAULT_KEY;
   \                     defaultKey:
   \   000000   01030507     DB 1, 3, 5, 7, 9, 11, 13, 15, 0, 2, 4, 6, 8, 10, 12, 13
   \            090B0D0F
   \            00020406
   \            080A0C0D
    256          #else
    257          CONST uint8 defaultKey[SEC_KEY_LEN] =
    258          {
    259          #if defined ( APP_TP ) || defined ( APP_TP2 )
    260            // Key for ZigBee Conformance Testing
    261            0xbb, 0xbb, 0xbb, 0xbb, 0xbb, 0xbb, 0xbb, 0xbb,
    262            0xaa, 0xaa, 0xaa, 0xaa, 0xaa, 0xaa, 0xaa, 0xaa
    263          #else
    264            // Key for In-House Testing
    265            0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07,
    266            0x08, 0x09, 0x0A, 0x0B, 0x0C, 0x0D, 0x0E, 0x0F
    267          #endif
    268          };
    269          #endif
    270          
    271          // This is the default pre-configured Trust Center Link key,
    272          // change this to make a unique key, SEC_KEY_LEN is defined in ssp.h.

   \                                 In  segment CODE_C, align 1
    273          CONST uint8 defaultTCLinkKey[SEC_KEY_LEN] =
   \                     defaultTCLinkKey:
   \   000000   56777777     DB 86, 119, 119, 119, 119, 119, 119, 119, 119, 119, 119, 119, 119, 119
   \            77777777
   \            77777777
   \            7777    
   \   00000E   7777         DB 119, 119
    274          {
    275            0x56, 0x77, 0x77, 0x77, 0x77, 0x77, 0x77, 0x77,
    276            0x77, 0x77, 0x77, 0x77, 0x77, 0x77, 0x77, 0x77
    277          };
    278          
    279          /*********************************************************************
    280           * GLOBAL VARIABLES - Statistics
    281           */
    282          
    283          #if defined ( PACKET_FILTER_STATS )
    284            uint32 apsInvalidPackets = 0;
    285            uint32 apsSecurityFailures = 0;
    286            uint32 nwkInvalidPackets = 0;
    287            uint32 nwkSecurityFailures = 0;
    288          #endif
    289          
    290          /*********************************************************************
    291           * STATUS STRINGS
    292           */
    293          #if defined ( LCD_SUPPORTED )

   \                                 In  segment XDATA_ROM_C, align 1
    294            const char PingStr[]         = "Ping Rcvd from";
   \                     PingStr:
   \   000000   50696E67     DB "Ping Rcvd from"
   \            20526376
   \            64206672
   \            6F6D00  

   \                                 In  segment XDATA_ROM_C, align 1
    295            const char AssocCnfStr[]     = "Assoc Cnf";
   \                     AssocCnfStr:
   \   000000   4173736F     DB "Assoc Cnf"
   \            6320436E
   \            6600    

   \                                 In  segment XDATA_ROM_C, align 1
    296            const char SuccessStr[]      = "Success";
   \                     SuccessStr:
   \   000000   53756363     DB "Success"
   \            65737300

   \                                 In  segment XDATA_ROM_C, align 1
    297            const char EndDeviceStr[]    = "EndDevice:";
   \                     EndDeviceStr:
   \   000000   456E6444     DB "EndDevice:"
   \            65766963
   \            653A00  

   \                                 In  segment XDATA_ROM_C, align 1
    298            const char ParentStr[]       = "Parent:";
   \                     ParentStr:
   \   000000   50617265     DB "Parent:"
   \            6E743A00

   \                                 In  segment XDATA_ROM_C, align 1
    299            const char ZigbeeCoordStr[]  = "ZigBee Coord";
   \                     ZigbeeCoordStr:
   \   000000   5A696742     DB "ZigBee Coord"
   \            65652043
   \            6F6F7264
   \            00      

   \                                 In  segment XDATA_ROM_C, align 1
    300            const char NetworkIDStr[]    = "Network ID:";
   \                     NetworkIDStr:
   \   000000   4E657477     DB "Network ID:"
   \            6F726B20
   \            49443A00

   \                                 In  segment XDATA_ROM_C, align 1
    301            const char RouterStr[]       = "Router:";
   \                     RouterStr:
   \   000000   526F7574     DB "Router:"
   \            65723A00

   \                                 In  segment XDATA_ROM_C, align 1
    302            const char OrphanRspStr[]    = "Orphan Response";
   \                     OrphanRspStr:
   \   000000   4F727068     DB "Orphan Response"
   \            616E2052
   \            6573706F
   \            6E736500

   \                                 In  segment XDATA_ROM_C, align 1
    303            const char SentStr[]         = "Sent";
   \                     SentStr:
   \   000000   53656E74     DB "Sent"
   \            00      

   \                                 In  segment XDATA_ROM_C, align 1
    304            const char FailedStr[]       = "Failed";
   \                     FailedStr:
   \   000000   4661696C     DB "Failed"
   \            656400  

   \                                 In  segment XDATA_ROM_C, align 1
    305            const char AssocRspFailStr[] = "Assoc Rsp fail";
   \                     AssocRspFailStr:
   \   000000   4173736F     DB "Assoc Rsp fail"
   \            63205273
   \            70206661
   \            696C00  

   \                                 In  segment XDATA_ROM_C, align 1
    306            const char AssocIndStr[]     = "Assoc Ind";
   \                     AssocIndStr:
   \   000000   4173736F     DB "Assoc Ind"
   \            6320496E
   \            6400    

   \                                 In  segment XDATA_ROM_C, align 1
    307            const char AssocCnfFailStr[] = "Assoc Cnf fail";
   \                     AssocCnfFailStr:
   \   000000   4173736F     DB "Assoc Cnf fail"
   \            6320436E
   \            66206661
   \            696C00  

   \                                 In  segment XDATA_ROM_C, align 1
    308            const char EnergyLevelStr[]  = "Energy Level";
   \                     EnergyLevelStr:
   \   000000   456E6572     DB "Energy Level"
   \            6779204C
   \            6576656C
   \            00      

   \                                 In  segment XDATA_ROM_C, align 1
    309            const char ScanFailedStr[]   = "Scan Failed";
   \                     ScanFailedStr:
   \   000000   5363616E     DB "Scan Failed"
   \            20466169
   \            6C656400
    310          #endif
    311          
    312          /*********************************************************************
    313           * @fn       nwk_globals_init()
    314           *
    315           * @brief
    316           *
    317           *   Initialize nwk layer globals.  These are the system defaults and
    318           *   should be changed by the user here.  The default definitions are
    319           *   defined in nwk.h or NLMEDE.h.
    320           *
    321           * @param   none
    322           *
    323           * @return  none
    324           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    325          void nwk_globals_init( void )
   \                     nwk_globals_init:
    326          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    327            AddrMgrInit( NWK_MAX_ADDRESSES );
   \   000004                ; Setup parameters for call to function AddrMgrInit
   \   000004   7A1A         MOV     R2,#0x1a
   \   000006   7B00         MOV     R3,#0x0
   \   000008   12....       LCALL   ??AddrMgrInit?relay
    328          
    329          #if !defined ( ZIGBEE_STOCHASTIC_ADDRESSING )
    330            if ( ZSTACK_ROUTER_BUILD )
    331            {
    332              // Initialize the Cskip Table
    333              Cskip = osal_mem_alloc(sizeof(uint16) *(MAX_NODE_DEPTH+1));
    334              RTG_FillCSkipTable(CskipChldrn, CskipRtrs, MAX_NODE_DEPTH, Cskip);
    335            }
    336          #endif
    337          
    338            // To compile out the Link Status Feature, set NWK_LINK_STATUS_PERIOD
    339            // to 0 (compiler flag).
    340            if ( ZSTACK_ROUTER_BUILD && NWK_LINK_STATUS_PERIOD )
    341            {
    342              NLME_InitLinkStatus();
   \   00000B                ; Setup parameters for call to function NLME_InitLinkStatus
   \   00000B   12....       LCALL   ??NLME_InitLinkStatus?relay
    343            }
    344          
    345          #if defined ( ZIGBEE_FREQ_AGILITY )
    346            NwkFreqAgilityInit();
   \   00000E                ; Setup parameters for call to function NwkFreqAgilityInit
   \   00000E   12....       LCALL   ??NwkFreqAgilityInit?relay
    347          #endif
    348          }
   \   000011                REQUIRE ?Subroutine0
   \   000011                ; // Fall through to label ?Subroutine0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine0:
   \   000000   D083         POP     DPH
   \   000002   D082         POP     DPL
   \   000004   02....       LJMP    ?BRET
    349          
    350          /*********************************************************************
    351           * @fn       NIB_init()
    352           *
    353           * @brief
    354           *
    355           *   Initialize attribute values in NIB
    356           *
    357           * @param   none
    358           *
    359           * @return  none
    360           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    361          void NIB_init()
   \                     NIB_init:
    362          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    363            _NIB.SequenceNum = LO_UINT16(osal_rand());
   \   000004                ; Setup parameters for call to function osal_rand
   \   000004   12....       LCALL   ??osal_rand?relay
   \   000007   EA           MOV     A,R2
   \   000008   90....       MOV     DPTR,#_NIB
   \   00000B   F0           MOVX    @DPTR,A
    364          
    365            _NIB.nwkProtocolVersion = ZB_PROT_VERS;
   \   00000C   7402         MOV     A,#0x2
   \   00000E   90....       MOV     DPTR,#(_NIB + 17)
   \   000011   F0           MOVX    @DPTR,A
    366            _NIB.MaxDepth = MAX_NODE_DEPTH;
   \   000012   7414         MOV     A,#0x14
   \   000014   90....       MOV     DPTR,#(_NIB + 4)
   \   000017   F0           MOVX    @DPTR,A
    367          
    368          #if ( NWK_MODE == NWK_MODE_MESH )
    369            _NIB.beaconOrder = BEACON_ORDER_NO_BEACONS;
   \   000018   740F         MOV     A,#0xf
   \   00001A   90....       MOV     DPTR,#(_NIB + 40)
   \   00001D   F0           MOVX    @DPTR,A
    370            _NIB.superFrameOrder = BEACON_ORDER_NO_BEACONS;
   \   00001E   90....       MOV     DPTR,#(_NIB + 41)
   \   000021   F0           MOVX    @DPTR,A
    371          #endif
    372          
    373            // BROADCAST SETTINGS:
    374            // *******************
    375            //   Broadcast Delivery Time
    376            //     - set to multiples of 100ms
    377            //     - should be 500ms more than the retry time
    378            //       -  "retry time" = PassiveAckTimeout * (MaxBroadcastRetries + 1)
    379            //   Passive Ack Timeout
    380            //     - set to multiples of 100ms
    381            _NIB.BroadcastDeliveryTime = zgBcastDeliveryTime;
   \   000022   90....       MOV     DPTR,#zgBcastDeliveryTime
   \   000025   E0           MOVX    A,@DPTR
   \   000026   90....       MOV     DPTR,#(_NIB + 7)
   \   000029   F0           MOVX    @DPTR,A
    382            _NIB.PassiveAckTimeout     = zgPassiveAckTimeout;
   \   00002A   90....       MOV     DPTR,#zgPassiveAckTimeout
   \   00002D   E0           MOVX    A,@DPTR
   \   00002E   90....       MOV     DPTR,#(_NIB + 1)
   \   000031   F0           MOVX    @DPTR,A
    383            _NIB.MaxBroadcastRetries   = zgMaxBcastRetires;
   \   000032   90....       MOV     DPTR,#zgMaxBcastRetires
   \   000035   E0           MOVX    A,@DPTR
   \   000036   90....       MOV     DPTR,#(_NIB + 2)
   \   000039   F0           MOVX    @DPTR,A
    384          
    385            _NIB.ReportConstantCost = 0;
   \   00003A   E4           CLR     A
   \   00003B   90....       MOV     DPTR,#(_NIB + 8)
   \   00003E   F0           MOVX    @DPTR,A
    386            _NIB.RouteDiscRetries = 0;
   \   00003F   90....       MOV     DPTR,#(_NIB + 9)
   \   000042   F0           MOVX    @DPTR,A
    387            _NIB.SecureAllFrames = USE_NWK_SECURITY;
   \   000043   90....       MOV     DPTR,#(_NIB + 11)
   \   000046   F0           MOVX    @DPTR,A
    388            _NIB.nwkAllFresh = NWK_ALL_FRESH;
   \   000047   7401         MOV     A,#0x1
   \   000049   90....       MOV     DPTR,#(_NIB + 104)
   \   00004C   F0           MOVX    @DPTR,A
    389          
    390            if ( ZG_SECURE_ENABLED )
    391            {
    392              _NIB.SecurityLevel = SECURITY_LEVEL;
    393            }
    394            else
    395            {
    396              _NIB.SecurityLevel = 0;
   \   00004D   E4           CLR     A
   \   00004E   90....       MOV     DPTR,#(_NIB + 12)
   \   000051   F0           MOVX    @DPTR,A
    397            }
    398          
    399          #if defined ( ZIGBEEPRO )
    400            _NIB.SymLink = FALSE;
   \   000052   90....       MOV     DPTR,#(_NIB + 13)
   \   000055   F0           MOVX    @DPTR,A
    401          #else
    402            _NIB.SymLink = TRUE;
    403          #endif
    404          
    405            _NIB.CapabilityFlags = ZDO_Config_Node_Descriptor.CapabilityFlags;
   \   000056   90....       MOV     DPTR,#(ZDO_Config_Node_Descriptor + 2)
   \   000059   E0           MOVX    A,@DPTR
   \   00005A   90....       MOV     DPTR,#(_NIB + 14)
   \   00005D   F0           MOVX    @DPTR,A
    406          
    407            _NIB.TransactionPersistenceTime = zgIndirectMsgTimeout;
   \   00005E   90....       MOV     DPTR,#zgIndirectMsgTimeout
   \   000061   E0           MOVX    A,@DPTR
   \   000062   90....       MOV     DPTR,#(_NIB + 15)
   \   000065   F0           MOVX    @DPTR,A
   \   000066   A3           INC     DPTR
   \   000067   E4           CLR     A
   \   000068   F0           MOVX    @DPTR,A
    408          
    409            _NIB.RouteDiscoveryTime = zgRouteDiscoveryTime;
   \   000069   90....       MOV     DPTR,#zgRouteDiscoveryTime
   \   00006C   E0           MOVX    A,@DPTR
   \   00006D   90....       MOV     DPTR,#(_NIB + 18)
   \   000070   F0           MOVX    @DPTR,A
    410            _NIB.RouteExpiryTime = zgRouteExpiryTime;
   \   000071   90....       MOV     DPTR,#zgRouteExpiryTime
   \   000074   E0           MOVX    A,@DPTR
   \   000075   90....       MOV     DPTR,#(_NIB + 19)
   \   000078   F0           MOVX    @DPTR,A
    411          
    412            _NIB.nwkDevAddress = INVALID_NODE_ADDR;
   \   000079   90....       MOV     DPTR,#(_NIB + 20)
   \   00007C   74FE         MOV     A,#-0x2
   \   00007E   F0           MOVX    @DPTR,A
   \   00007F   A3           INC     DPTR
   \   000080   74FF         MOV     A,#-0x1
   \   000082   F0           MOVX    @DPTR,A
    413            _NIB.nwkLogicalChannel = 0;
   \   000083   E4           CLR     A
   \   000084   90....       MOV     DPTR,#(_NIB + 22)
   \   000087   F0           MOVX    @DPTR,A
    414            _NIB.nwkCoordAddress = INVALID_NODE_ADDR;
   \   000088   90....       MOV     DPTR,#(_NIB + 23)
   \   00008B   74FE         MOV     A,#-0x2
   \   00008D   F0           MOVX    @DPTR,A
   \   00008E   A3           INC     DPTR
   \   00008F   74FF         MOV     A,#-0x1
   \   000091   F0           MOVX    @DPTR,A
    415            osal_memset( _NIB.nwkCoordExtAddress, 0, Z_EXTADDR_LEN );
   \   000092                ; Setup parameters for call to function osal_memset
   \   000092   7C08         MOV     R4,#0x8
   \   000094   7D00         MOV     R5,#0x0
   \   000096   7900         MOV     R1,#0x0
   \   000098   7A..         MOV     R2,#((_NIB + 25) & 0xff)
   \   00009A   7B..         MOV     R3,#(((_NIB + 25) >> 8) & 0xff)
   \   00009C   12....       LCALL   ??osal_memset?relay
    416            _NIB.nwkPanId = INVALID_NODE_ADDR;
   \   00009F   90....       MOV     DPTR,#(_NIB + 33)
   \   0000A2   74FE         MOV     A,#-0x2
   \   0000A4   F0           MOVX    @DPTR,A
   \   0000A5   A3           INC     DPTR
   \   0000A6   74FF         MOV     A,#-0x1
   \   0000A8   F0           MOVX    @DPTR,A
    417          
    418            osal_cpyExtAddr( _NIB.extendedPANID, zgExtendedPANID );
   \   0000A9                ; Setup parameters for call to function sAddrExtCpy
   \   0000A9   7C..         MOV     R4,#(zgExtendedPANID & 0xff)
   \   0000AB   7D..         MOV     R5,#((zgExtendedPANID >> 8) & 0xff)
   \   0000AD   7A..         MOV     R2,#((_NIB + 53) & 0xff)
   \   0000AF   7B..         MOV     R3,#(((_NIB + 53) >> 8) & 0xff)
   \   0000B1   12....       LCALL   ??sAddrExtCpy?relay
    419          
    420            _NIB.nwkKeyLoaded = FALSE;
   \   0000B4   E4           CLR     A
   \   0000B5   90....       MOV     DPTR,#(_NIB + 61)
   \   0000B8   F0           MOVX    @DPTR,A
    421          
    422          #if defined ( ZIGBEE_STOCHASTIC_ADDRESSING )
    423            _NIB.nwkAddrAlloc  = NWK_ADDRESSING_STOCHASTIC;
   \   0000B9   7402         MOV     A,#0x2
   \   0000BB   90....       MOV     DPTR,#(_NIB + 96)
   \   0000BE   F0           MOVX    @DPTR,A
    424            _NIB.nwkUniqueAddr = FALSE;
   \   0000BF   E4           CLR     A
   \   0000C0   90....       MOV     DPTR,#(_NIB + 97)
   \   0000C3   F0           MOVX    @DPTR,A
    425          #else
    426            _NIB.nwkAddrAlloc  = NWK_ADDRESSING_DISTRIBUTED;
    427            _NIB.nwkUniqueAddr = TRUE;
    428          #endif
    429          
    430            _NIB.nwkLinkStatusPeriod = NWK_LINK_STATUS_PERIOD;
   \   0000C4   740F         MOV     A,#0xf
   \   0000C6   90....       MOV     DPTR,#(_NIB + 98)
   \   0000C9   F0           MOVX    @DPTR,A
    431            _NIB.nwkRouterAgeLimit = NWK_ROUTE_AGE_LIMIT;
   \   0000CA   7403         MOV     A,#0x3
   \   0000CC   90....       MOV     DPTR,#(_NIB + 99)
   \   0000CF   F0           MOVX    @DPTR,A
    432          
    433            //MTO and source routing
    434            _NIB.nwkConcentratorDiscoveryTime = zgConcentratorDiscoveryTime;
   \   0000D0   90....       MOV     DPTR,#zgConcentratorDiscoveryTime
   \   0000D3   E0           MOVX    A,@DPTR
   \   0000D4   90....       MOV     DPTR,#(_NIB + 102)
   \   0000D7   F0           MOVX    @DPTR,A
    435            _NIB.nwkIsConcentrator = zgConcentratorEnable;
   \   0000D8   90....       MOV     DPTR,#zgConcentratorEnable
   \   0000DB   E0           MOVX    A,@DPTR
   \   0000DC   90....       MOV     DPTR,#(_NIB + 101)
   \   0000DF   F0           MOVX    @DPTR,A
    436            _NIB.nwkConcentratorRadius = zgConcentratorRadius;
   \   0000E0   90....       MOV     DPTR,#zgConcentratorRadius
   \   0000E3   E0           MOVX    A,@DPTR
   \   0000E4   90....       MOV     DPTR,#(_NIB + 103)
   \   0000E7   F0           MOVX    @DPTR,A
    437          
    438          #if defined ( ZIGBEE_MULTICAST )
    439            _NIB.nwkUseMultiCast = TRUE;
   \   0000E8   7401         MOV     A,#0x1
   \   0000EA   90....       MOV     DPTR,#(_NIB + 100)
   \   0000ED   F0           MOVX    @DPTR,A
    440          #else
    441            _NIB.nwkUseMultiCast = FALSE;
    442          #endif
    443            _NIB.nwkManagerAddr = 0x0000;
   \   0000EE   90....       MOV     DPTR,#(_NIB + 105)
   \   0000F1   E4           CLR     A
   \   0000F2   F0           MOVX    @DPTR,A
   \   0000F3   A3           INC     DPTR
   \   0000F4   F0           MOVX    @DPTR,A
    444            _NIB.nwkUpdateId = 0;
   \   0000F5   90....       MOV     DPTR,#(_NIB + 109)
   \   0000F8   F0           MOVX    @DPTR,A
    445            _NIB.nwkTotalTransmissions = 0;
   \   0000F9   90....       MOV     DPTR,#(_NIB + 107)
   \   0000FC   F0           MOVX    @DPTR,A
   \   0000FD   A3           INC     DPTR
   \   0000FE   F0           MOVX    @DPTR,A
    446          
    447            if ( ZSTACK_ROUTER_BUILD )
    448            {
    449          #if defined ( ZIGBEE_STOCHASTIC_ADDRESSING )
    450              NLME_InitStochasticAddressing();
   \   0000FF                ; Setup parameters for call to function NLME_InitStochasticAddressing
   \   0000FF   12....       LCALL   ??NLME_InitStochasticAddressing?relay
    451          #else
    452              NLME_InitTreeAddressing();
    453          #endif
    454            }
    455          }
   \   000102   02....       LJMP    ?Subroutine0 & 0xFFFF
    456          
    457          /*********************************************************************
    458           * @fn       nwk_Status()
    459           *
    460           * @brief
    461           *
    462           *   Status report.
    463           *
    464           * @param   statusCode
    465           * @param   statusValue
    466           *
    467           * @return  none
    468           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    469          void nwk_Status( uint16 statusCode, uint16 statusValue )
   \                     nwk_Status:
    470          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 0
   \   000005   8C..         MOV     ?V0 + 0,R4
   \   000007   8D..         MOV     ?V0 + 1,R5
    471          #if defined ( LCD_SUPPORTED )
    472            switch ( statusCode )
   \   000009   8A..         MOV     ?V0 + 2,R2
   \   00000B   8B..         MOV     ?V0 + 3,R3
   \   00000D   78..         MOV     R0,#?V0 + 2
   \   00000F   12....       LCALL   ?US_SWITCH_SPARSE
   \                     `?<Jumptable for nwk_Status>_0`:
   \   000012   0000         DW        0
   \   000014   0900         DW        9
   \   000016   0200         DW        2
   \   000018   ....         DW        ??nwk_Status_0
   \   00001A   0300         DW        3
   \   00001C   ....         DW        ??nwk_Status_1
   \   00001E   0400         DW        4
   \   000020   ....         DW        ??nwk_Status_2
   \   000022   0500         DW        5
   \   000024   ....         DW        ??nwk_Status_3
   \   000026   0600         DW        6
   \   000028   ....         DW        ??nwk_Status_4
   \   00002A   0700         DW        7
   \   00002C   ....         DW        ??nwk_Status_5
   \   00002E   0110         DW        4097
   \   000030   ....         DW        ??nwk_Status_6
   \   000032   0310         DW        4099
   \   000034   ....         DW        ??nwk_Status_7
   \   000036   0410         DW        4100
   \   000038   ....         DW        ??nwk_Status_8
   \   00003A   ....         DW        ??nwk_Status_1
    473            {
    474              case NWK_STATUS_COORD_ADDR:
    475                if ( ZSTACK_ROUTER_BUILD )
    476                {
    477                  HalLcdWriteString( (char*)ZigbeeCoordStr, HAL_LCD_LINE_1 );
   \                     ??nwk_Status_3:
   \   00003C                ; Setup parameters for call to function HalLcdWriteString
   \   00003C   7901         MOV     R1,#0x1
   \   00003E   7A..         MOV     R2,#(ZigbeeCoordStr & 0xff)
   \   000040   7B..         MOV     R3,#((ZigbeeCoordStr >> 8) & 0xff)
   \   000042   12....       LCALL   ?Subroutine1 & 0xFFFF
    478                  HalLcdWriteStringValue( (char*)NetworkIDStr, statusValue, 16, HAL_LCD_LINE_2 );
   \                     ??CrossCallReturnLabel_0:
   \   000045   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000048   7910         MOV     R1,#0x10
   \   00004A   AC..         MOV     R4,?V0 + 0
   \   00004C   AD..         MOV     R5,?V0 + 1
   \   00004E   7A..         MOV     R2,#(NetworkIDStr & 0xff)
   \   000050   7B..         MOV     R3,#((NetworkIDStr >> 8) & 0xff)
   \   000052   12....       LCALL   ??HalLcdWriteStringValue?relay
   \   000055   7401         MOV     A,#0x1
   \   000057   12....       LCALL   ?DEALLOC_XSTACK8
    479                  BuzzerControl( BUZZER_BLIP );
   \   00005A                ; Setup parameters for call to function BuzzerControl
   \   00005A   7902         MOV     R1,#0x2
   \   00005C   12....       LCALL   ??BuzzerControl?relay
   \   00005F   8076         SJMP    ??nwk_Status_1
    480                }
    481                break;
    482          
    483              case NWK_STATUS_ROUTER_ADDR:
    484                if ( ZSTACK_ROUTER_BUILD )
    485                {
    486                  HalLcdWriteStringValue( (char*)RouterStr, statusValue, 16, HAL_LCD_LINE_1 );
   \                     ??nwk_Status_4:
   \   000061                ; Setup parameters for call to function HalLcdWriteStringValue
   \   000061   75..01       MOV     ?V0 + 2,#0x1
   \   000064   78..         MOV     R0,#?V0 + 2
   \   000066   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000069   7910         MOV     R1,#0x10
   \   00006B   7A..         MOV     R2,#(RouterStr & 0xff)
   \   00006D   7B..         MOV     R3,#((RouterStr >> 8) & 0xff)
   \                     ??nwk_Status_9:
   \   00006F   12....       LCALL   ??HalLcdWriteStringValue?relay
   \                     ??nwk_Status_10:
   \   000072   7401         MOV     A,#0x1
   \   000074   12....       LCALL   ?DEALLOC_XSTACK8
   \   000077   805E         SJMP    ??nwk_Status_1
    487                }
    488                break;
    489          
    490              case NWK_STATUS_ORPHAN_RSP:
    491                if ( ZSTACK_ROUTER_BUILD )
    492                {
    493                  if ( statusValue == ZSuccess )
   \                     ??nwk_Status_5:
   \   000079   EC           MOV     A,R4
   \   00007A   7001         JNZ     ??nwk_Status_11
   \   00007C   ED           MOV     A,R5
   \                     ??nwk_Status_11:
   \   00007D   700A         JNZ     ??nwk_Status_12
    494                    HalLcdWriteScreen( (char*)OrphanRspStr, (char*)SentStr );
   \   00007F                ; Setup parameters for call to function HalLcdWriteScreen
   \   00007F   7C..         MOV     R4,#(SentStr & 0xff)
   \   000081   7D..         MOV     R5,#((SentStr >> 8) & 0xff)
   \                     ??nwk_Status_13:
   \   000083   7A..         MOV     R2,#(OrphanRspStr & 0xff)
   \   000085   7B..         MOV     R3,#((OrphanRspStr >> 8) & 0xff)
   \   000087   804B         SJMP    ??nwk_Status_14
    495                  else
    496                    HalLcdWriteScreen( (char*)OrphanRspStr, (char*)FailedStr );
   \                     ??nwk_Status_12:
   \   000089                ; Setup parameters for call to function HalLcdWriteScreen
   \   000089   7C..         MOV     R4,#(FailedStr & 0xff)
   \   00008B   7D..         MOV     R5,#((FailedStr >> 8) & 0xff)
   \   00008D   80F4         SJMP    ??nwk_Status_13
    497                }
    498                break;
    499          
    500              case NWK_ERROR_ASSOC_RSP:
    501                if ( ZSTACK_ROUTER_BUILD )
    502                {
    503                  HalLcdWriteString( (char*)AssocRspFailStr, HAL_LCD_LINE_1 );
   \                     ??nwk_Status_6:
   \   00008F                ; Setup parameters for call to function HalLcdWriteString
   \   00008F   7901         MOV     R1,#0x1
   \   000091   7A..         MOV     R2,#(AssocRspFailStr & 0xff)
   \   000093   7B..         MOV     R3,#((AssocRspFailStr >> 8) & 0xff)
    504                  HalLcdWriteValue( (uint32)(statusValue), 16, HAL_LCD_LINE_2 );
    505                }
   \                     ??nwk_Status_15:
   \   000095   12....       LCALL   ?Subroutine1 & 0xFFFF
   \                     ??CrossCallReturnLabel_1:
   \   000098   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   00009B   7910         MOV     R1,#0x10
   \   00009D   AA..         MOV     R2,?V0 + 0
   \   00009F   AB..         MOV     R3,?V0 + 1
   \   0000A1   7C00         MOV     R4,#0x0
   \   0000A3   7D00         MOV     R5,#0x0
   \   0000A5   12....       LCALL   ??HalLcdWriteValue?relay
   \   0000A8   80C8         SJMP    ??nwk_Status_10
    506                break;
    507          
    508              case NWK_STATUS_ED_ADDR:
    509                if ( ZSTACK_END_DEVICE_BUILD )
    510                {
    511                  HalLcdWriteStringValue( (char*)EndDeviceStr, statusValue, 16, HAL_LCD_LINE_1 );
    512                }
    513                break;
    514          
    515              case NWK_STATUS_PARENT_ADDR:
    516                      HalLcdWriteStringValue( (char*)ParentStr, statusValue, 16, HAL_LCD_LINE_2 );
   \                     ??nwk_Status_2:
   \   0000AA                ; Setup parameters for call to function HalLcdWriteStringValue
   \   0000AA   75..02       MOV     ?V0 + 2,#0x2
   \   0000AD   78..         MOV     R0,#?V0 + 2
   \   0000AF   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   0000B2   7910         MOV     R1,#0x10
   \   0000B4   7A..         MOV     R2,#(ParentStr & 0xff)
   \   0000B6   7B..         MOV     R3,#((ParentStr >> 8) & 0xff)
   \   0000B8   80B5         SJMP    ??nwk_Status_9
    517                break;
    518          
    519              case NWK_STATUS_ASSOC_CNF:
    520                HalLcdWriteScreen( (char*)AssocCnfStr, (char*)SuccessStr );
   \                     ??nwk_Status_0:
   \   0000BA                ; Setup parameters for call to function HalLcdWriteScreen
   \   0000BA   7C..         MOV     R4,#(SuccessStr & 0xff)
   \   0000BC   7D..         MOV     R5,#((SuccessStr >> 8) & 0xff)
   \   0000BE   7A..         MOV     R2,#(AssocCnfStr & 0xff)
   \   0000C0   7B..         MOV     R3,#((AssocCnfStr >> 8) & 0xff)
   \   0000C2   8010         SJMP    ??nwk_Status_14
    521                break;
    522          
    523              case NWK_ERROR_ASSOC_CNF_DENIED:
    524                HalLcdWriteString((char*)AssocCnfFailStr, HAL_LCD_LINE_1 );
   \                     ??nwk_Status_7:
   \   0000C4                ; Setup parameters for call to function HalLcdWriteString
   \   0000C4   7901         MOV     R1,#0x1
   \   0000C6   7A..         MOV     R2,#(AssocCnfFailStr & 0xff)
   \   0000C8   7B..         MOV     R3,#((AssocCnfFailStr >> 8) & 0xff)
   \   0000CA   80C9         SJMP    ??nwk_Status_15
    525                HalLcdWriteValue( (uint32)(statusValue), 16, HAL_LCD_LINE_2 );
    526                break;
    527          
    528              case NWK_ERROR_ENERGY_SCAN_FAILED:
    529                HalLcdWriteScreen( (char*)EnergyLevelStr, (char*)ScanFailedStr );
   \                     ??nwk_Status_8:
   \   0000CC                ; Setup parameters for call to function HalLcdWriteScreen
   \   0000CC   7C..         MOV     R4,#(ScanFailedStr & 0xff)
   \   0000CE   7D..         MOV     R5,#((ScanFailedStr >> 8) & 0xff)
   \   0000D0   7A..         MOV     R2,#(EnergyLevelStr & 0xff)
   \   0000D2   7B..         MOV     R3,#((EnergyLevelStr >> 8) & 0xff)
   \                     ??nwk_Status_14:
   \   0000D4   12....       LCALL   ??HalLcdWriteScreen?relay
    530                break;
    531            }
    532          #endif
    533          }
   \                     ??nwk_Status_1:
   \   0000D7   7F04         MOV     R7,#0x4
   \   0000D9   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine1:
   \   000000   12....       LCALL   ??HalLcdWriteString?relay
   \   000003                ; Setup parameters for call to function HalLcdWriteStringValue
   \   000003                ; Setup parameters for call to function HalLcdWriteValue
   \   000003   75..02       MOV     ?V0 + 2,#0x2
   \   000006   78..         MOV     R0,#?V0 + 2
   \   000008   22           RET
    534          
    535          /*********************************************************************
    536           * @fn       nwk_UpdateStatistics()
    537           *
    538           * @brief   Update network layer statistic counters
    539           *
    540           * @param   statisticCode
    541           *
    542           * @return  none
    543           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    544          void nwk_UpdateStatistics( uint8 statisticCode )
   \                     nwk_UpdateStatistics:
    545          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
    546          #if defined ( PACKET_FILTER_STATS )
    547            switch ( statisticCode )
    548            {
    549              case STAT_NWK_INVALID_PACKET:
    550                nwkInvalidPackets++;
    551                break;
    552          
    553              case STAT_NWK_SECURITY_FAILURE:
    554                nwkInvalidPackets++;
    555                nwkSecurityFailures++;
    556                break;
    557          
    558              case STAT_APS_INVALID_PACKET:
    559                apsInvalidPackets++;
    560                break;
    561          
    562              case STAT_APS_SECURITY_FAILURE:
    563                apsSecurityFailures++;
    564                break;
    565            }
    566          #endif
    567          }
   \   000000   02....       LJMP    ?BRET

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for gMIN_TREE_LINK_COST>`:
   \   000000   06           DB 6

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??nwk_globals_init?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    nwk_globals_init

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??NIB_init?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    NIB_init

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??nwk_Status?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    nwk_Status

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??nwk_UpdateStatistics?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    nwk_UpdateStatistics
    568          
    569          /*********************************************************************
    570          *********************************************************************/

   Maximum stack usage in bytes:

     Function                       ISTACK PSTACK XSTACK
     --------                       ------ ------ ------
     NIB_init                           2      0      0
       -> osal_rand                     4      0      0
       -> osal_memset                   4      0      0
       -> sAddrExtCpy                   4      0      0
       -> NLME_InitStochasticAddressing
                                        4      0      0
     nwk_Status                         0      0     13
       -> HalLcdWriteString             0      0     24
       -> HalLcdWriteStringValue        0      0     26
       -> BuzzerControl                 0      0     24
       -> HalLcdWriteStringValue        0      0     26
       -> HalLcdWriteScreen             0      0     24
       -> HalLcdWriteScreen             0      0     24
       -> HalLcdWriteString             0      0     24
       -> HalLcdWriteValue              0      0     26
       -> HalLcdWriteStringValue        0      0     26
       -> HalLcdWriteScreen             0      0     24
       -> HalLcdWriteString             0      0     24
       -> HalLcdWriteValue              0      0     26
       -> HalLcdWriteScreen             0      0     24
     nwk_UpdateStatistics               0      0      0
     nwk_globals_init                   2      0      0
       -> AddrMgrInit                   4      0      0
       -> NLME_InitLinkStatus           4      0      0
       -> NwkFreqAgilityInit            4      0      0


   Segment part sizes:

     Function/Label                         Bytes
     --------------                         -----
     gNWK_MAX_DEVICE_LIST                      2
     gNWK_MAX_SLEEPING_END_DEVICES             1
     gNWK_MAX_DATABUFS_WAITING                 1
     gNWK_MAX_DATABUFS_SCHEDULED               1
     gNWK_MAX_DATABUFS_CONFIRMED               1
     gNWK_MAX_DATABUFS_TOTAL                   1
     gNWK_INDIRECT_CNT_RTG_TMR                 1
     gNWK_INDIRECT_MSG_MAX_PER                 1
     gNWK_INDIRECT_MSG_MAX_ALL                 1
     Cskip                                     2
     CskipRtrs                                 1
     CskipChldrn                               1
     gMIN_TREE_LINK_COST                       1
     AssociatedDevList                       378
     gMAX_RTG_ENTRIES                          2
     gMAX_RTG_SRC_ENTRIES                      2
     gMAX_RREQ_ENTRIES                         1
     gMAX_NEIGHBOR_ENTRIES                     1
     neighborTable                           368
     gMAX_SOURCE_ROUTE                         1
     gMAX_BROADCAST_QUEUED                     1
     gLINK_DOWN_TRIGGER                        1
     gMAX_PASSIVE_ACK_CNT                      1
     rtgTable                                280
     rtgSrcTable                              72
     rtgSrcRelayList                          24
     rtDiscTable                              64
     bcastTable                               72
     bcastHoldHandle                           9
     bcastHoldAckMask                         36
     gMAX_BCAST                                1
     gNWK_TREE_ALLOCATE_ROUTERADDR_FOR_ENDDEVICE
                                               1
     gNWK_CONFLICTED_ADDR_EXPIRY_TIME
                                               1
     gNWK_FREQ_AGILITY_ALL_MAC_ERRS            1
     gMTO_RREQ_LIMIT_TIME                      2
     gMTO_ROUTE_EXPIRY_TIME                    1
     gDEFAULT_ROUTE_REQUEST_RADIUS             1
     gDEF_NWK_RADIUS                           1
     gLINK_STATUS_JITTER_MASK                  2
     gNWK_MAX_BINDING_ENTRIES                  2
     gMAX_BINDING_CLUSTER_IDS                  1
     gBIND_REC_SIZE                            2
     BindingTable                             56
     gAPS_MAX_GROUPS                           1
     defaultKey                               16
     defaultTCLinkKey                         16
     PingStr                                  15
     AssocCnfStr                              10
     SuccessStr                                8
     EndDeviceStr                             11
     ParentStr                                 8
     ZigbeeCoordStr                           13
     NetworkIDStr                             12
     RouterStr                                 8
     OrphanRspStr                             16
     SentStr                                   5
     FailedStr                                 7
     AssocRspFailStr                          15
     AssocIndStr                              10
     AssocCnfFailStr                          15
     EnergyLevelStr                           13
     ScanFailedStr                            12
     nwk_globals_init                         17
     ?Subroutine0                              7
     NIB_init                                261
     nwk_Status                              220
     ?Subroutine1                              9
     nwk_UpdateStatistics                      3
     ?<Initializer for gMIN_TREE_LINK_COST>    1
     ??nwk_globals_init?relay                  6
     ??NIB_init?relay                          6
     ??nwk_Status?relay                        6
     ??nwk_UpdateStatistics?relay              6

 
   517 bytes in segment BANKED_CODE
    24 bytes in segment BANK_RELAYS
    69 bytes in segment CODE_C
     1 byte  in segment XDATA_I
     1 byte  in segment XDATA_ID
   178 bytes in segment XDATA_ROM_C
 1 363 bytes in segment XDATA_Z
 
   611 bytes of CODE  memory
   178 bytes of CONST memory
 1 364 bytes of XDATA memory

Errors: none
Warnings: none
