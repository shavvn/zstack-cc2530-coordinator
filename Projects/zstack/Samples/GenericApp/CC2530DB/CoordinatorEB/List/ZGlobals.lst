###############################################################################
#                                                                             #
# IAR C/C++ Compiler V7.60.1.40026 for 8051             08/Apr/2014  21:42:51 #
# Copyright (C) 2004-2010 IAR Systems AB.                                     #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data_rom                                           #
#    Dptr setup         =  1,16                                               #
#    Source file        =  D:\zigbee\projects\zstack-cc2530-coordinator\Compo #
#                          nents\stack\sys\ZGlobals.c                         #
#    Command line       =  -f D:\zigbee\projects\zstack-cc2530-coordinator\Pr #
#                          ojects\zstack\Samples\GenericApp\CC2530DB\..\..\.. #
#                          \Tools\CC2530DB\f8wCoord.cfg (-DCPU32MHZ           #
#                          -DROOT=__near_func -DMAC_CFG_APP_PENDING_QUEUE=TRU #
#                          E -DMAC_CFG_TX_DATA_MAX=5 -DMAC_CFG_TX_MAX=8       #
#                          -DMAC_CFG_RX_MAX=5 -DZDO_COORDINATOR -DRTR_NWK)    #
#                          -f D:\zigbee\projects\zstack-cc2530-coordinator\Pr #
#                          ojects\zstack\Samples\GenericApp\CC2530DB\..\..\.. #
#                          \Tools\CC2530DB\f8wConfig.cfg (-DZIGBEEPRO         #
#                          -DSECURE=0 -DZG_SECURE_DYNAMIC=0 -DREFLECTOR       #
#                          -DDEFAULT_CHANLIST=0x00000800                      #
#                          -DZDAPP_CONFIG_PAN_ID=0x1111                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DLINK_STATUS_JITTER_MASK=0x007F                   #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3    #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40           #
#                          -DNWK_MAX_BINDING_ENTRIES=4                        #
#                          -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DMAC_MAX_FRAME_SIZE=116                           #
#                          -DZDNWKMGR_MIN_TRANSMISSIONS=20 "-DCONST=const     #
#                          __code" -DGENERIC=__generic                        #
#                          -DRFD_RCVC_ALWAYS_ON=FALSE -DPOLL_RATE=1000        #
#                          -DQUEUED_POLL_RATE=100 -DRESPONSE_POLL_RATE=100)   #
#                          -DREJOIN_POLL_RATE=440 D:\zigbee\projects\zstack-c #
#                          c2530-coordinator\Components\stack\sys\ZGlobals.c  #
#                          -D ZAPP_P1 -D MT_TASK -D MT_SYS_FUNC -D            #
#                          MT_ZDO_FUNC -D LCD_SUPPORTED=DEBUG -lC             #
#                          D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\Coordinator #
#                          EB\List\ -lA D:\zigbee\projects\zstack-cc2530-coor #
#                          dinator\Projects\zstack\Samples\GenericApp\CC2530D #
#                          B\CoordinatorEB\List\ --diag_suppress Pe001,Pa010  #
#                          -o D:\zigbee\projects\zstack-cc2530-coordinator\Pr #
#                          ojects\zstack\Samples\GenericApp\CC2530DB\Coordina #
#                          torEB\Obj\ -e --require_prototypes                 #
#                          --no_code_motion --debug --core=plain --dptr=16,1  #
#                          --data_model=large --code_model=banked             #
#                          --calling_convention=xdata_reentrant               #
#                          --place_constants=data_rom --nr_virtual_regs 16    #
#                          -I D:\zigbee\projects\zstack-cc2530-coordinator\Pr #
#                          ojects\zstack\Samples\GenericApp\CC2530DB\ -I      #
#                          D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\Source\  #
#                          -I D:\zigbee\projects\zstack-cc2530-coordinator\Pr #
#                          ojects\zstack\Samples\GenericApp\CC2530DB\..\..\.. #
#                          \ZMain\TI2530DB\ -I D:\zigbee\projects\zstack-cc25 #
#                          30-coordinator\Projects\zstack\Samples\GenericApp\ #
#                          CC2530DB\..\..\..\..\..\Components\hal\include\    #
#                          -I D:\zigbee\projects\zstack-cc2530-coordinator\Pr #
#                          ojects\zstack\Samples\GenericApp\CC2530DB\..\..\.. #
#                          \..\..\Components\hal\target\CC2530EB\ -I          #
#                          D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\mac\include\ -I                     #
#                          D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\mac\high_level\ -I                  #
#                          D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\mac\low_level\srf04\ -I             #
#                          D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\mac\low_level\srf04\single_chip\    #
#                          -I D:\zigbee\projects\zstack-cc2530-coordinator\Pr #
#                          ojects\zstack\Samples\GenericApp\CC2530DB\..\..\.. #
#                          \..\..\Components\mt\ -I                           #
#                          D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\osal\include\ -I                    #
#                          D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\osal\mcu\ccsoc\ -I                  #
#                          D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\services\saddr\ -I                  #
#                          D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\services\sdata\ -I                  #
#                          D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\stack\af\ -I                        #
#                          D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\stack\nwk\ -I                       #
#                          D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\stack\sapi\ -I                      #
#                          D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\stack\sec\ -I                       #
#                          D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\stack\sys\ -I                       #
#                          D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\stack\zdo\ -I                       #
#                          D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\zmac\ -I D:\zigbee\projects\zstack- #
#                          cc2530-coordinator\Projects\zstack\Samples\Generic #
#                          App\CC2530DB\..\..\..\..\..\Components\zmac\f8w\   #
#                          -I "C:\Program Files (x86)\IAR Systems\Embedded    #
#                          Workbench 5.4\8051\INC\" -I "C:\Program Files      #
#                          (x86)\IAR Systems\Embedded Workbench               #
#                          5.4\8051\INC\CLIB\" -Ohz                           #
#    List file          =  D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\Coordinator #
#                          EB\List\ZGlobals.lst                               #
#    Object file        =  D:\zigbee\projects\zstack-cc2530-coordinator\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\Coordinator #
#                          EB\Obj\ZGlobals.r51                                #
#                                                                             #
#                                                                             #
###############################################################################

D:\zigbee\projects\zstack-cc2530-coordinator\Components\stack\sys\ZGlobals.c
      1          /**************************************************************************************************
      2            Filename:       ZGlobals.c
      3            Revised:        $Date: 2010-08-20 16:29:19 -0700 (Fri, 20 Aug 2010) $
      4            Revision:       $Revision: 23466 $
      5          
      6            Description:    User definable Z-Stack parameters.
      7          
      8          
      9            Copyright 2007-2010 Texas Instruments Incorporated. All rights reserved.
     10          
     11            IMPORTANT: Your use of this Software is limited to those specific rights
     12            granted under the terms of a software license agreement between the user
     13            who downloaded the software, his/her employer (which must be your employer)
     14            and Texas Instruments Incorporated (the "License").  You may not use this
     15            Software unless you agree to abide by the terms of the License. The License
     16            limits your use, and you acknowledge, that the Software may not be modified,
     17            copied or distributed unless embedded on a Texas Instruments microcontroller
     18            or used solely and exclusively in conjunction with a Texas Instruments radio
     19            frequency transceiver, which is integrated into your product.  Other than for
     20            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     21            works of, modify, distribute, perform, display or sell this Software and/or
     22            its documentation for any purpose.
     23          
     24            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     25            PROVIDED “AS IS” WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED,
     26            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE,
     27            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     28            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     29            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     30            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     31            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     32            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     33            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     34            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     35          
     36            Should you have any questions regarding your right to use this Software,
     37            contact Texas Instruments Incorporated at www.TI.com.
     38          **************************************************************************************************/
     39          
     40          /*********************************************************************
     41           * INCLUDES
     42           */
     43          
     44          #include "ZComDef.h"
     45          #include "OSAL_Nv.h"
     46          #include "ZDObject.h"
     47          #include "ZGlobals.h"
     48          #include "ZDNwkMgr.h"
     49          #include "OnBoard.h"
     50          #include "ZDSecMgr.h"
     51          
     52          /*********************************************************************
     53           * MACROS
     54           */
     55          
     56          /*********************************************************************
     57           * CONSTANTS
     58           */
     59          
     60          /*********************************************************************
     61           * TYPEDEFS
     62           */
     63          
     64          typedef struct zgItem
     65          {
     66            uint16 id;
     67            uint16 len;
     68            void *buf;
     69          } zgItem_t;
     70          
     71          /*********************************************************************
     72           * NWK GLOBAL VARIABLES
     73           */
     74          
     75          // Polling values

   \                                 In  segment XDATA_I, align 1, keep-with-next
     76          uint16 zgPollRate = POLL_RATE;
   \                     zgPollRate:
   \   000000                DS 2
   \   000002                REQUIRE `?<Initializer for zgPollRate>`
   \   000002                REQUIRE __INIT_XDATA_I

   \                                 In  segment XDATA_I, align 1, keep-with-next
     77          uint16 zgQueuedPollRate = QUEUED_POLL_RATE;
   \                     zgQueuedPollRate:
   \   000000                DS 2
   \   000002                REQUIRE `?<Initializer for zgQueuedPollRate>`
   \   000002                REQUIRE __INIT_XDATA_I

   \                                 In  segment XDATA_I, align 1, keep-with-next
     78          uint16 zgResponsePollRate = RESPONSE_POLL_RATE;
   \                     zgResponsePollRate:
   \   000000                DS 2
   \   000002                REQUIRE `?<Initializer for zgResponsePollRate>`
   \   000002                REQUIRE __INIT_XDATA_I

   \                                 In  segment XDATA_I, align 1, keep-with-next
     79          uint16 zgRejoinPollRate = REJOIN_POLL_RATE;
   \                     zgRejoinPollRate:
   \   000000                DS 2
   \   000002                REQUIRE `?<Initializer for zgRejoinPollRate>`
   \   000002                REQUIRE __INIT_XDATA_I
     80          
     81          // Transmission retries numbers

   \                                 In  segment XDATA_I, align 1, keep-with-next
     82          uint8 zgMaxDataRetries = NWK_MAX_DATA_RETRIES;
   \                     zgMaxDataRetries:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for zgMaxDataRetries>`
   \   000001                REQUIRE __INIT_XDATA_I

   \                                 In  segment XDATA_I, align 1, keep-with-next
     83          uint8 zgMaxPollFailureRetries = MAX_POLL_FAILURE_RETRIES;
   \                     zgMaxPollFailureRetries:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for zgMaxPollFailureRetries>`
   \   000001                REQUIRE __INIT_XDATA_I
     84          
     85          // Default channel list

   \                                 In  segment XDATA_I, align 1, keep-with-next
     86          uint32 zgDefaultChannelList = DEFAULT_CHANLIST;
   \                     zgDefaultChannelList:
   \   000000                DS 4
   \   000004                REQUIRE `?<Initializer for zgDefaultChannelList>`
   \   000004                REQUIRE __INIT_XDATA_I
     87          
     88          // Default starting scan duration

   \                                 In  segment XDATA_I, align 1, keep-with-next
     89          uint8 zgDefaultStartingScanDuration = STARTING_SCAN_DURATION;
   \                     zgDefaultStartingScanDuration:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for zgDefaultStartingScanDuratio`
   \   000001                REQUIRE __INIT_XDATA_I
     90          
     91          // Stack profile Id

   \                                 In  segment XDATA_I, align 1, keep-with-next
     92          uint8 zgStackProfile = STACK_PROFILE_ID;
   \                     zgStackProfile:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for zgStackProfile>`
   \   000001                REQUIRE __INIT_XDATA_I
     93          
     94          // Default indirect message holding timeout

   \                                 In  segment XDATA_I, align 1, keep-with-next
     95          uint8 zgIndirectMsgTimeout = NWK_INDIRECT_MSG_TIMEOUT;
   \                     zgIndirectMsgTimeout:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for zgIndirectMsgTimeout>`
   \   000001                REQUIRE __INIT_XDATA_I
     96          
     97          // Security mode

   \                                 In  segment XDATA_Z, align 1, keep-with-next
     98          uint8 zgSecurityMode = ZG_SECURITY_MODE;
   \                     zgSecurityMode:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
     99          
    100          // Secure permit join

   \                                 In  segment XDATA_I, align 1, keep-with-next
    101          uint8 zgSecurePermitJoin = true;
   \                     zgSecurePermitJoin:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for zgSecurePermitJoin>`
   \   000001                REQUIRE __INIT_XDATA_I
    102          
    103          // Trust center address

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    104          uint16 zgTrustCenterAddr = ZG_TRUSTCENTER_ADDR;
   \                     zgTrustCenterAddr:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z
    105          
    106          // Route Discovery Time - amount of time that a route request lasts

   \                                 In  segment XDATA_I, align 1, keep-with-next
    107          uint8 zgRouteDiscoveryTime = ROUTE_DISCOVERY_TIME;
   \                     zgRouteDiscoveryTime:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for zgRouteDiscoveryTime>`
   \   000001                REQUIRE __INIT_XDATA_I
    108          
    109          // Route expiry

   \                                 In  segment XDATA_I, align 1, keep-with-next
    110          uint8 zgRouteExpiryTime = ROUTE_EXPIRY_TIME;
   \                     zgRouteExpiryTime:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for zgRouteExpiryTime>`
   \   000001                REQUIRE __INIT_XDATA_I
    111          
    112          // Extended PAN Id

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    113          uint8 zgExtendedPANID[Z_EXTADDR_LEN];
   \                     zgExtendedPANID:
   \   000000                DS 8
   \   000008                REQUIRE __INIT_XDATA_Z
    114          
    115          // Broadcast parameters

   \                                 In  segment XDATA_I, align 1, keep-with-next
    116          uint8 zgMaxBcastRetires   = MAX_BCAST_RETRIES;
   \                     zgMaxBcastRetires:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for zgMaxBcastRetires>`
   \   000001                REQUIRE __INIT_XDATA_I

   \                                 In  segment XDATA_I, align 1, keep-with-next
    117          uint8 zgPassiveAckTimeout = PASSIVE_ACK_TIMEOUT;
   \                     zgPassiveAckTimeout:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for zgPassiveAckTimeout>`
   \   000001                REQUIRE __INIT_XDATA_I

   \                                 In  segment XDATA_I, align 1, keep-with-next
    118          uint8 zgBcastDeliveryTime = BCAST_DELIVERY_TIME;
   \                     zgBcastDeliveryTime:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for zgBcastDeliveryTime>`
   \   000001                REQUIRE __INIT_XDATA_I
    119          
    120          // Network mode

   \                                 In  segment XDATA_I, align 1, keep-with-next
    121          uint8 zgNwkMode = NWK_MODE;
   \                     zgNwkMode:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for zgNwkMode>`
   \   000001                REQUIRE __INIT_XDATA_I
    122          
    123          // Many-to-one values

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    124          uint8 zgConcentratorEnable = CONCENTRATOR_ENABLE;
   \                     zgConcentratorEnable:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    125          uint8 zgConcentratorDiscoveryTime = CONCENTRATOR_DISCOVERY_TIME;
   \                     zgConcentratorDiscoveryTime:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_I, align 1, keep-with-next
    126          uint8 zgConcentratorRadius = CONCENTRATOR_RADIUS;
   \                     zgConcentratorRadius:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for zgConcentratorRadius>`
   \   000001                REQUIRE __INIT_XDATA_I

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    127          uint8 zgConcentratorRC = CONCENTRATOR_ROUTE_CACHE;   // concentrator with route cache (no memory constraints)
   \                     zgConcentratorRC:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_I, align 1, keep-with-next
    128          uint8 zgNwkSrcRtgExpiryTime = SRC_RTG_EXPIRY_TIME;
   \                     zgNwkSrcRtgExpiryTime:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for zgNwkSrcRtgExpiryTime>`
   \   000001                REQUIRE __INIT_XDATA_I
    129          
    130          /*********************************************************************
    131           * APS GLOBAL VARIABLES
    132           */
    133          
    134          // The maximum number of retries allowed after a transmission failure

   \                                 In  segment XDATA_I, align 1, keep-with-next
    135          uint8 zgApscMaxFrameRetries = APSC_MAX_FRAME_RETRIES;
   \                     zgApscMaxFrameRetries:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for zgApscMaxFrameRetries>`
   \   000001                REQUIRE __INIT_XDATA_I
    136          
    137          // The maximum number of seconds (milliseconds) to wait for an
    138          // acknowledgement to a transmitted frame.
    139          
    140          // This number is used by polled devices.

   \                                 In  segment XDATA_I, align 1, keep-with-next
    141          uint16 zgApscAckWaitDurationPolled = APSC_ACK_WAIT_DURATION_POLLED;
   \                     zgApscAckWaitDurationPolled:
   \   000000                DS 2
   \   000002                REQUIRE `?<Initializer for zgApscAckWaitDurationPolled>`
   \   000002                REQUIRE __INIT_XDATA_I
    142          
    143          // This number is used by non-polled devices in the following formula:
    144          //   (100 mSec) * (_NIB.MaxDepth * zgApsAckWaitMultiplier)

   \                                 In  segment XDATA_I, align 1, keep-with-next
    145          uint8 zgApsAckWaitMultiplier = 2;
   \                     zgApsAckWaitMultiplier:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for zgApsAckWaitMultiplier>`
   \   000001                REQUIRE __INIT_XDATA_I
    146          
    147          // The maximum number of milliseconds for the end device binding

   \                                 In  segment XDATA_I, align 1, keep-with-next
    148          uint16 zgApsDefaultMaxBindingTime = APS_DEFAULT_MAXBINDING_TIME;
   \                     zgApsDefaultMaxBindingTime:
   \   000000                DS 2
   \   000002                REQUIRE `?<Initializer for zgApsDefaultMaxBindingTime>`
   \   000002                REQUIRE __INIT_XDATA_I
    149          
    150          // The 64-big identifier of the network to join or form.
    151          // Default set to all zeros

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    152          uint8 zgApsUseExtendedPANID[Z_EXTADDR_LEN] = {00,00,00,00,00,00,00,00};
   \                     zgApsUseExtendedPANID:
   \   000000                DS 8
   \   000008                REQUIRE __INIT_XDATA_Z
    153          
    154          // A boolean flag that indicates whether it is OK to use insecure join
    155          // on startup. Default set to true

   \                                 In  segment XDATA_I, align 1, keep-with-next
    156          uint8 zgApsUseInsecureJoin = TRUE;
   \                     zgApsUseInsecureJoin:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for zgApsUseInsecureJoin>`
   \   000001                REQUIRE __INIT_XDATA_I
    157          
    158          // The radius of broadcast multicast transmissions

   \                                 In  segment XDATA_I, align 1, keep-with-next
    159          uint8 zgApsNonMemberRadius = APS_DEFAULT_NONMEMBER_RADIUS;
   \                     zgApsNonMemberRadius:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for zgApsNonMemberRadius>`
   \   000001                REQUIRE __INIT_XDATA_I
    160          
    161          // The size of a tx window when using fragmentation

   \                                 In  segment XDATA_I, align 1, keep-with-next
    162          uint8 zgApsfMaxWindowSize = APSF_DEFAULT_WINDOW_SIZE;
   \                     zgApsfMaxWindowSize:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for zgApsfMaxWindowSize>`
   \   000001                REQUIRE __INIT_XDATA_I
    163          
    164          // The delay between tx packets when using fragmentaition

   \                                 In  segment XDATA_I, align 1, keep-with-next
    165          uint16 zgApsfInterframeDelay = APSF_DEFAULT_INTERFRAME_DELAY;
   \                     zgApsfInterframeDelay:
   \   000000                DS 2
   \   000002                REQUIRE `?<Initializer for zgApsfInterframeDelay>`
   \   000002                REQUIRE __INIT_XDATA_I
    166          
    167          /*********************************************************************
    168           * SECURITY GLOBAL VARIABLES
    169           */
    170          
    171          // If true, preConfigKey should be configured on all devices on the network
    172          // If false, it is configured only on the coordinator and sent to other
    173          // devices upon joining.

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    174          uint8 zgPreConfigKeys = FALSE;// TRUE;
   \                     zgPreConfigKeys:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    175          
    176          // If true, defaultTCLinkKey should be configured on all devices on the
    177          // network. If false, individual trust center link key between each device and
    178          // the trust center should be manually configured via MT_WRITE_NV

   \                                 In  segment XDATA_I, align 1, keep-with-next
    179          uint8 zgUseDefaultTCLK = TRUE; // FALSE
   \                     zgUseDefaultTCLK:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for zgUseDefaultTCLK>`
   \   000001                REQUIRE __INIT_XDATA_I
    180          
    181          /*********************************************************************
    182           * ZDO GLOBAL VARIABLES
    183           */
    184          
    185          // Configured PAN ID

   \                                 In  segment XDATA_I, align 1, keep-with-next
    186          uint16 zgConfigPANID = ZDAPP_CONFIG_PAN_ID;
   \                     zgConfigPANID:
   \   000000                DS 2
   \   000002                REQUIRE `?<Initializer for zgConfigPANID>`
   \   000002                REQUIRE __INIT_XDATA_I
    187          
    188          // Device Logical Type

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    189          uint8 zgDeviceLogicalType = DEVICE_LOGICAL_TYPE;
   \                     zgDeviceLogicalType:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    190          
    191          // Startup Delay

   \                                 In  segment XDATA_I, align 1, keep-with-next
    192          uint8 zgStartDelay = START_DELAY;
   \                     zgStartDelay:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for zgStartDelay>`
   \   000001                REQUIRE __INIT_XDATA_I
    193          
    194          #if !defined MT_TASK
    195          // Flag to use verbose (i.e. "cc2480-style") direct MT callbacks in ZDProfile.c, ZDP_IncomingData().
    196          uint8 zgZdoDirectCB = FALSE;
    197          #endif
    198          
    199          // Min number of attempted transmissions for Channel Interference detection

   \                                 In  segment XDATA_I, align 1, keep-with-next
    200          uint8 zgNwkMgrMinTransmissions = ZDNWKMGR_MIN_TRANSMISSIONS;
   \                     zgNwkMgrMinTransmissions:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for zgNwkMgrMinTransmissions>`
   \   000001                REQUIRE __INIT_XDATA_I
    201          
    202          /*********************************************************************
    203           * APPLICATION GLOBAL VARIABLES
    204           */
    205          
    206          // Network Manager Mode

   \                                 In  segment XDATA_I, align 1, keep-with-next
    207          uint8 zgNwkMgrMode = ZDNWKMGR_ENABLE;
   \                     zgNwkMgrMode:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for zgNwkMgrMode>`
   \   000001                REQUIRE __INIT_XDATA_I
    208          
    209          /*********************************************************************
    210           * NON-STANDARD GLOBAL VARIABLES
    211           */
    212          
    213          // Simple API Endpoint

   \                                 In  segment XDATA_I, align 1, keep-with-next
    214          uint8 zgSapiEndpoint = SAPI_ENDPOINT;
   \                     zgSapiEndpoint:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for zgSapiEndpoint>`
   \   000001                REQUIRE __INIT_XDATA_I
    215          
    216          /*********************************************************************
    217           * LOCAL VARIABLES
    218           */
    219          
    220          /*********************************************************************
    221           * ZGlobal Item Table
    222           */

   \                                 In  segment CODE_C, align 1
    223          static CONST zgItem_t zgItemTable[] =
   \                     zgItemTable:
   \   000000   00000000     DW 0, 0, 0H
   \            0000    
    224          {
    225          #if defined ( NV_INIT )
    226          #if !defined MT_TASK
    227            {
    228              ZCD_NV_ZDO_DIRECT_CB, sizeof(zgZdoDirectCB), &zgZdoDirectCB
    229            },
    230          #endif
    231            {
    232              ZCD_NV_LOGICAL_TYPE, sizeof(zgDeviceLogicalType), &zgDeviceLogicalType
    233            },
    234            {
    235              ZCD_NV_POLL_RATE, sizeof(zgPollRate), &zgPollRate
    236            },
    237            {
    238              ZCD_NV_QUEUED_POLL_RATE, sizeof(zgQueuedPollRate), &zgQueuedPollRate
    239            },
    240            {
    241              ZCD_NV_RESPONSE_POLL_RATE, sizeof(zgResponsePollRate), &zgResponsePollRate
    242            },
    243            {
    244              ZCD_NV_REJOIN_POLL_RATE, sizeof(zgRejoinPollRate), &zgRejoinPollRate
    245            },
    246            {
    247              ZCD_NV_DATA_RETRIES, sizeof(zgMaxDataRetries), &zgMaxDataRetries
    248            },
    249            {
    250              ZCD_NV_POLL_FAILURE_RETRIES, sizeof(zgMaxPollFailureRetries), &zgMaxPollFailureRetries
    251            },
    252            {
    253              ZCD_NV_CHANLIST, sizeof(zgDefaultChannelList), &zgDefaultChannelList
    254            },
    255            {
    256              ZCD_NV_SCAN_DURATION, sizeof(zgDefaultStartingScanDuration), &zgDefaultStartingScanDuration
    257            },
    258            {
    259              ZCD_NV_STACK_PROFILE, sizeof(zgStackProfile), &zgStackProfile
    260            },
    261            {
    262              ZCD_NV_INDIRECT_MSG_TIMEOUT, sizeof(zgIndirectMsgTimeout), &zgIndirectMsgTimeout
    263            },
    264            {
    265              ZCD_NV_ROUTE_EXPIRY_TIME, sizeof(zgRouteExpiryTime), &zgRouteExpiryTime
    266            },
    267            {
    268              ZCD_NV_EXTENDED_PAN_ID, Z_EXTADDR_LEN, zgExtendedPANID
    269            },
    270            {
    271              ZCD_NV_BCAST_RETRIES, sizeof(zgMaxBcastRetires), &zgMaxBcastRetires
    272            },
    273            {
    274              ZCD_NV_PASSIVE_ACK_TIMEOUT, sizeof(zgPassiveAckTimeout), &zgPassiveAckTimeout
    275            },
    276            {
    277              ZCD_NV_BCAST_DELIVERY_TIME, sizeof(zgBcastDeliveryTime), &zgBcastDeliveryTime
    278            },
    279            {
    280              ZCD_NV_NWK_MODE, sizeof(zgNwkMode), &zgNwkMode
    281            },
    282            {
    283              ZCD_NV_CONCENTRATOR_ENABLE, sizeof(zgConcentratorEnable), &zgConcentratorEnable
    284            },
    285            {
    286              ZCD_NV_CONCENTRATOR_DISCOVERY, sizeof(zgConcentratorDiscoveryTime), &zgConcentratorDiscoveryTime
    287            },
    288            {
    289              ZCD_NV_CONCENTRATOR_RADIUS, sizeof(zgConcentratorRadius), &zgConcentratorRadius
    290            },
    291            {
    292              ZCD_NV_CONCENTRATOR_RC, sizeof(zgConcentratorRC), &zgConcentratorRC
    293            },
    294            {
    295              ZCD_NV_SRC_RTG_EXPIRY_TIME, sizeof(zgNwkSrcRtgExpiryTime), &zgNwkSrcRtgExpiryTime
    296            },
    297            {
    298              ZCD_NV_ROUTE_DISCOVERY_TIME, sizeof(zgRouteDiscoveryTime), &zgRouteDiscoveryTime
    299            },
    300          #ifndef NONWK
    301            {
    302              ZCD_NV_PANID, sizeof(zgConfigPANID), &zgConfigPANID
    303            },
    304            {
    305              ZCD_NV_PRECFGKEYS_ENABLE, sizeof(zgPreConfigKeys), &zgPreConfigKeys
    306            },
    307            {
    308              ZCD_NV_SECURITY_MODE, sizeof(zgSecurityMode), &zgSecurityMode
    309            },
    310            {
    311              ZCD_NV_SECURE_PERMIT_JOIN, sizeof(zgSecurePermitJoin), &zgSecurePermitJoin
    312            },
    313            {
    314              ZCD_NV_USE_DEFAULT_TCLK, sizeof(zgUseDefaultTCLK), &zgUseDefaultTCLK
    315            },
    316            {
    317              ZCD_NV_TRUSTCENTER_ADDR, sizeof(zgTrustCenterAddr), &zgTrustCenterAddr
    318            },
    319          #endif // NONWK
    320            {
    321              ZCD_NV_APS_FRAME_RETRIES, sizeof(zgApscMaxFrameRetries), &zgApscMaxFrameRetries
    322            },
    323            {
    324              ZCD_NV_APS_ACK_WAIT_DURATION, sizeof(zgApscAckWaitDurationPolled), &zgApscAckWaitDurationPolled
    325            },
    326            {
    327              ZCD_NV_APS_ACK_WAIT_MULTIPLIER, sizeof(zgApsAckWaitMultiplier), &zgApsAckWaitMultiplier
    328            },
    329            {
    330              ZCD_NV_BINDING_TIME, sizeof(zgApsDefaultMaxBindingTime), &zgApsDefaultMaxBindingTime
    331            },
    332            {
    333              ZCD_NV_APS_USE_EXT_PANID, Z_EXTADDR_LEN, zgApsUseExtendedPANID
    334            },
    335            {
    336              ZCD_NV_APS_USE_INSECURE_JOIN, sizeof(zgApsUseInsecureJoin), &zgApsUseInsecureJoin
    337            },
    338            {
    339              ZCD_NV_APSF_WINDOW_SIZE, sizeof(zgApsfMaxWindowSize), &zgApsfMaxWindowSize
    340            },
    341            {
    342              ZCD_NV_APSF_INTERFRAME_DELAY, sizeof(zgApsfInterframeDelay), &zgApsfInterframeDelay
    343            },
    344            {
    345              ZCD_NV_APS_NONMEMBER_RADIUS, sizeof(zgApsNonMemberRadius), &zgApsNonMemberRadius
    346            },
    347            {
    348              ZCD_NV_START_DELAY, sizeof(zgStartDelay), &zgStartDelay
    349            },
    350            {
    351              ZCD_NV_SAPI_ENDPOINT, sizeof(zgSapiEndpoint), &zgSapiEndpoint
    352            },
    353            {
    354              ZCD_NV_NWK_MGR_MODE, sizeof(zgNwkMgrMode), &zgNwkMgrMode
    355            },
    356            {
    357              ZCD_NV_NWKMGR_MIN_TX, sizeof(zgNwkMgrMinTransmissions), &zgNwkMgrMinTransmissions
    358            },
    359          #endif // NV_INIT
    360            // Last item -- DO NOT MOVE IT!
    361            {
    362              0x00, 0, NULL
    363            }
    364          };
    365          
    366          /*********************************************************************
    367           * LOCAL FUNCTIONS
    368           */
    369          
    370          static uint8 zgItemInit( uint16 id, uint16 len, void *buf, uint8 setDefault );
    371          static uint8 zgPreconfigKeyInit( uint8 setDefault );
    372          
    373          /*********************************************************************
    374           * @fn       zgItemInit()
    375           *
    376           * @brief
    377           *
    378           *   Initialize a global item. If the item doesn't exist in NV memory,
    379           *   write the system default (value passed in) into NV memory. But if
    380           *   it exists, set the item to the value stored in NV memory.
    381           *
    382           *   Also, if setDefault is TRUE and the item exists, we will write
    383           *   the default value to NV space.
    384           *
    385           * @param   id - item id
    386           * @param   len - item len
    387           * @param   buf - pointer to the item
    388           * @param   setDefault - TRUE to set default, not read
    389           *
    390           * @return  ZSUCCESS if successful, NV_ITEM_UNINIT if item did not
    391           *          exist in NV, NV_OPER_FAILED if failure.
    392           */
    393          static uint8 zgItemInit( uint16 id, uint16 len, void *buf, uint8 setDefault )
    394          {
    395            uint8 status;
    396          
    397            // If the item doesn't exist in NV memory, create and initialize
    398            // it with the value passed in.
    399            status = osal_nv_item_init( id, len, buf );
    400            if ( status == ZSUCCESS )
    401            {
    402              if ( setDefault )
    403              {
    404                // Write the default value back to NV
    405                status = osal_nv_write( id, 0, len, buf );
    406              }
    407              else
    408              {
    409                // The item exists in NV memory, read it from NV memory
    410                status = osal_nv_read( id, 0, len, buf );
    411              }
    412            }
    413          
    414            return (status);
    415          }
    416          
    417          /*********************************************************************
    418           * API FUNCTIONS
    419           */
    420          
    421          /*********************************************************************
    422           * @fn          zgInit
    423           *
    424           * @brief
    425           *
    426           *   Initialize the Z-Stack Globals. If an item doesn't exist in
    427           *   NV memory, write the system default into NV memory. But if
    428           *   it exists, set the item to the value stored in NV memory.
    429           *
    430           * NOTE: The Startup Options (ZCD_NV_STARTUP_OPTION) indicate
    431           *       that the Config state items (zgItemTable) need to be
    432           *       set to defaults (ZCD_STARTOPT_DEFAULT_CONFIG_STATE). The
    433           *
    434           * @param       none
    435           *
    436           * @return      ZSUCCESS if successful, NV_ITEM_UNINIT if item did not
    437           *              exist in NV, NV_OPER_FAILED if failure.
    438           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    439          uint8 zgInit( void )
   \                     zgInit:
    440          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
    441            uint8  setDefault = FALSE;
   \   000005   7E00         MOV     R6,#0x0
    442          
    443            // Do we want to default the Config state values
    444            if ( zgReadStartupOptions() & ZCD_STARTOPT_DEFAULT_CONFIG_STATE )
   \   000007                ; Setup parameters for call to function zgReadStartupOptions
   \   000007   12....       LCALL   ??zgReadStartupOptions?relay
   \   00000A   E9           MOV     A,R1
   \   00000B   A2E0         MOV     C,0xE0 /* A   */.0
   \   00000D   5001         JNC     ??zgInit_0
    445            {
    446              setDefault = TRUE;
   \   00000F   0E           INC     R6
    447            }
    448          
    449          #if 0
    450            // Enable this section if you need to track the number of resets
    451            // This section is normally disabled to minimize "wear" on NV memory
    452            uint16 bootCnt = 0;
    453          
    454            // Update the Boot Counter
    455            if ( osal_nv_item_init( ZCD_NV_BOOTCOUNTER, sizeof(bootCnt), &bootCnt ) == ZSUCCESS )
    456            {
    457              // Get the old value from NV memory
    458              osal_nv_read( ZCD_NV_BOOTCOUNTER, 0, sizeof(bootCnt), &bootCnt );
    459            }
    460          
    461            // Increment the Boot Counter and store it into NV memory
    462            if ( setDefault )
    463              bootCnt = 0;
    464            else
    465              bootCnt++;
    466            osal_nv_write( ZCD_NV_BOOTCOUNTER, 0, sizeof(bootCnt), &bootCnt );
    467          #endif
    468          
    469            // Initialize the Extended PAN ID as my own extended address
    470            ZMacGetReq( ZMacExtAddr, zgExtendedPANID );
   \                     ??zgInit_0:
   \   000010                ; Setup parameters for call to function ZMacGetReq
   \   000010   7A..         MOV     R2,#(zgExtendedPANID & 0xff)
   \   000012   7B..         MOV     R3,#((zgExtendedPANID >> 8) & 0xff)
   \   000014   79E2         MOV     R1,#-0x1e
   \   000016   12....       LCALL   ??ZMacGetReq?relay
    471          
    472            // Initialize the items table
    473            zgInitItems( setDefault );
   \   000019                ; Setup parameters for call to function zgInitItems
   \   000019   EE           MOV     A,R6
   \   00001A   F9           MOV     R1,A
   \   00001B   12....       LCALL   ??zgInitItems?relay
    474          
    475          #ifndef NONWK
    476            if ( ZG_SECURE_ENABLED )
    477            {
    478              // Initialize the Pre-Configured Key to the default key
    479              zgPreconfigKeyInit( setDefault );
    480          
    481              // Initialize NV items for all Keys: NWK, APS, TCLK and Master
    482              ZDSecMgrInitNVKeyTables( setDefault );
    483            }
    484          #endif // NONWK
    485          
    486            // Clear the Config State default
    487            if ( setDefault )
   \   00001E   EE           MOV     A,R6
   \   00001F   6007         JZ      ??zgInit_1
    488            {
    489              zgWriteStartupOptions( ZG_STARTUP_CLEAR, ZCD_STARTOPT_DEFAULT_CONFIG_STATE );
   \   000021                ; Setup parameters for call to function zgWriteStartupOptions
   \   000021   7A01         MOV     R2,#0x1
   \   000023   7900         MOV     R1,#0x0
   \   000025   12....       LCALL   ??zgWriteStartupOptions?relay
    490            }
    491          
    492            return ( ZSUCCESS );
   \                     ??zgInit_1:
   \   000028   7900         MOV     R1,#0x0
   \   00002A   7F01         MOV     R7,#0x1
   \   00002C   02....       LJMP    ?BANKED_LEAVE_XDATA
    493          }
    494          
    495          /*********************************************************************
    496           * @fn          zgInitItems
    497           *
    498           * @brief       Initializes RAM variables from NV.  If NV items don't
    499           *              exist, then the NV is initialize with what is in RAM
    500           *              variables.
    501           *
    502           * @param       none
    503           *
    504           * @return      none
    505           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    506          void zgInitItems( uint8 setDefault )
   \                     zgInitItems:
    507          {
   \   000000   74F2         MOV     A,#-0xe
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 14
   \   000005                ; Auto size: 0
   \   000005   89..         MOV     ?V0 + 5,R1
    508            uint8  i = 0;
   \   000007   75..00       MOV     ?V0 + 4,#0x0
   \   00000A   801A         SJMP    ??zgInitItems_0
    509          
    510            while ( zgItemTable[i].id != 0x00 )
    511            {
   \                     ??zgInitItems_1:
   \   00000C                ; Setup parameters for call to function osal_nv_read
   \   00000C   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00000F   78..         MOV     R0,#?V0 + 0
   \   000011   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000014   7C00         MOV     R4,#0x0
   \   000016   7D00         MOV     R5,#0x0
   \   000018   EE           MOV     A,R6
   \   000019   FA           MOV     R2,A
   \   00001A   EF           MOV     A,R7
   \   00001B   FB           MOV     R3,A
   \   00001C   12....       LCALL   ??osal_nv_read?relay
   \                     ??zgInitItems_2:
   \   00001F   7404         MOV     A,#0x4
   \   000021   12....       LCALL   ?DEALLOC_XSTACK8
    512              // Initialize the item
    513              zgItemInit( zgItemTable[i].id, zgItemTable[i].len, zgItemTable[i].buf, setDefault  );
    514          
    515              // Move on to the next item
    516              i++;
   \                     ??zgInitItems_3:
   \   000024   05..         INC     ?V0 + 4
   \                     ??zgInitItems_0:
   \   000026   E5..         MOV     A,?V0 + 4
   \   000028   75F006       MOV     B,#0x6
   \   00002B   A4           MUL     AB
   \   00002C   F8           MOV     R0,A
   \   00002D   AAF0         MOV     R2,B
   \   00002F   EA           MOV     A,R2
   \   000030   F9           MOV     R1,A
   \   000031   E8           MOV     A,R0
   \   000032   24..         ADD     A,#(zgItemTable & 0xff)
   \   000034   F582         MOV     DPL,A
   \   000036   E9           MOV     A,R1
   \   000037   12....       LCALL   ?Subroutine2 & 0xFFFF
   \                     ??CrossCallReturnLabel_0:
   \   00003A   7001         JNZ     ??zgInitItems_4
   \   00003C   E9           MOV     A,R1
   \                     ??zgInitItems_4:
   \   00003D   607F         JZ      ??zgInitItems_5
   \   00003F   E5..         MOV     A,?V0 + 4
   \   000041   75F006       MOV     B,#0x6
   \   000044   A4           MUL     AB
   \   000045   F8           MOV     R0,A
   \   000046   EA           MOV     A,R2
   \   000047   F9           MOV     R1,A
   \   000048   E8           MOV     A,R0
   \   000049   24..         ADD     A,#(zgItemTable & 0xff)
   \   00004B   F8           MOV     R0,A
   \   00004C   E9           MOV     A,R1
   \   00004D   34..         ADDC    A,#((zgItemTable >> 8) & 0xff)
   \   00004F   F9           MOV     R1,A
   \   000050   A3           INC     DPTR
   \   000051   A3           INC     DPTR
   \   000052   A3           INC     DPTR
   \   000053   A3           INC     DPTR
   \   000054   E4           CLR     A
   \   000055   93           MOVC    A,@A+DPTR
   \   000056   F5..         MOV     ?V0 + 2,A
   \   000058   7401         MOV     A,#0x1
   \   00005A   93           MOVC    A,@A+DPTR
   \   00005B   F5..         MOV     ?V0 + 3,A
   \   00005D   8882         MOV     DPL,R0
   \   00005F   8983         MOV     DPH,R1
   \   000061   A3           INC     DPTR
   \   000062   A3           INC     DPTR
   \   000063   E4           CLR     A
   \   000064   93           MOVC    A,@A+DPTR
   \   000065   C0E0         PUSH    A
   \   000067   7401         MOV     A,#0x1
   \   000069   93           MOVC    A,@A+DPTR
   \   00006A   F583         MOV     DPH,A
   \   00006C   D082         POP     DPL
   \   00006E   8582..       MOV     ?V0 + 0,DPL
   \   000071   8583..       MOV     ?V0 + 1,DPH
   \   000074   8882         MOV     DPL,R0
   \   000076   8983         MOV     DPH,R1
   \   000078   E4           CLR     A
   \   000079   93           MOVC    A,@A+DPTR
   \   00007A   C0E0         PUSH    A
   \   00007C   7401         MOV     A,#0x1
   \   00007E   93           MOVC    A,@A+DPTR
   \   00007F   F583         MOV     DPH,A
   \   000081   D082         POP     DPL
   \   000083   AE82         MOV     R6,DPL
   \   000085   AF83         MOV     R7,DPH
   \   000087                ; Setup parameters for call to function osal_nv_item_init
   \   000087   78..         MOV     R0,#?V0 + 2
   \   000089   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00008C   AC..         MOV     R4,?V0 + 0
   \   00008E   AD..         MOV     R5,?V0 + 1
   \   000090   EE           MOV     A,R6
   \   000091   FA           MOV     R2,A
   \   000092   EF           MOV     A,R7
   \   000093   FB           MOV     R3,A
   \   000094   12....       LCALL   ??osal_nv_item_init?relay
   \   000097   7402         MOV     A,#0x2
   \   000099   12....       LCALL   ?DEALLOC_XSTACK8
   \   00009C   E9           MOV     A,R1
   \   00009D   7085         JNZ     ??zgInitItems_3
   \   00009F   E5..         MOV     A,?V0 + 5
   \   0000A1   78..         MOV     R0,#?V0 + 2
   \   0000A3   7003         JNZ     $+5
   \   0000A5   02....       LJMP    ??zgInitItems_1 & 0xFFFF
   \   0000A8                ; Setup parameters for call to function osal_nv_write
   \   0000A8   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000AB   78..         MOV     R0,#?V0 + 0
   \   0000AD   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000B0   7C00         MOV     R4,#0x0
   \   0000B2   7D00         MOV     R5,#0x0
   \   0000B4   EE           MOV     A,R6
   \   0000B5   FA           MOV     R2,A
   \   0000B6   EF           MOV     A,R7
   \   0000B7   FB           MOV     R3,A
   \   0000B8   12....       LCALL   ??osal_nv_write?relay
   \   0000BB   02....       LJMP    ??zgInitItems_2 & 0xFFFF
    517            }
    518          }
   \                     ??zgInitItems_5:
   \   0000BE   7F06         MOV     R7,#0x6
   \   0000C0   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine2:
   \   000000   34..         ADDC    A,#((zgItemTable >> 8) & 0xff)
   \   000002   12....       LCALL   ?Subroutine3 & 0xFFFF
   \                     ??CrossCallReturnLabel_7:
   \   000005   E8           MOV     A,R0
   \   000006   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine3:
   \   000000   F583         MOV     DPH,A
   \   000002                REQUIRE ??Subroutine5_0
   \   000002                ; // Fall through to label ??Subroutine5_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine5_0:
   \   000000   E4           CLR     A
   \   000001   93           MOVC    A,@A+DPTR
   \   000002   F8           MOV     R0,A
   \   000003   7401         MOV     A,#0x1
   \   000005   93           MOVC    A,@A+DPTR
   \   000006   F9           MOV     R1,A
   \   000007   22           RET
    519          
    520          /*********************************************************************
    521           * @fn          zgReadStartupOptions
    522           *
    523           * @brief       Reads the ZCD_NV_STARTUP_OPTION NV Item.
    524           *
    525           * @param       none
    526           *
    527           * @return      the ZCD_NV_STARTUP_OPTION NV item
    528           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    529          uint8 zgReadStartupOptions( void )
   \                     zgReadStartupOptions:
    530          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 1
   \   000005   74FF         MOV     A,#-0x1
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
    531            // Default to Use Config State and Use Network State
    532            uint8 startupOption = 0;
   \   00000A   12....       LCALL   ?Subroutine1 & 0xFFFF
    533          
    534            // This should have been done in ZMain.c, but just in case.
    535            if ( osal_nv_item_init( ZCD_NV_STARTUP_OPTION,
    536                                        sizeof(startupOption),
    537                                        &startupOption ) == ZSUCCESS )
   \                     ??CrossCallReturnLabel_2:
   \   00000D   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000010   7C01         MOV     R4,#0x1
   \   000012   7D00         MOV     R5,#0x0
   \   000014   7A03         MOV     R2,#0x3
   \   000016   7B00         MOV     R3,#0x0
   \   000018   12....       LCALL   ??osal_nv_item_init?relay
   \   00001B   7402         MOV     A,#0x2
   \   00001D   12....       LCALL   ?DEALLOC_XSTACK8
   \   000020   E9           MOV     A,R1
   \   000021   7020         JNZ     ??zgReadStartupOptions_0
    538            {
    539              // Read saved startup control
    540              osal_nv_read( ZCD_NV_STARTUP_OPTION,
    541                            0,
    542                            sizeof( startupOption ),
    543                            &startupOption);
   \   000023                ; Setup parameters for call to function osal_nv_read
   \   000023   78..         MOV     R0,#?V0 + 0
   \   000025   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000028   75..01       MOV     ?V0 + 0,#0x1
   \   00002B   75..00       MOV     ?V0 + 1,#0x0
   \   00002E   78..         MOV     R0,#?V0 + 0
   \   000030   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000033   7C00         MOV     R4,#0x0
   \   000035   7D00         MOV     R5,#0x0
   \   000037   7A03         MOV     R2,#0x3
   \   000039   7B00         MOV     R3,#0x0
   \   00003B   12....       LCALL   ??osal_nv_read?relay
   \   00003E   7404         MOV     A,#0x4
   \   000040   12....       LCALL   ?DEALLOC_XSTACK8
    544            }
    545            return ( startupOption );
   \                     ??zgReadStartupOptions_0:
   \   000043   85..82       MOV     DPL,?XSP + 0
   \   000046   85..83       MOV     DPH,?XSP + 1
   \   000049   E0           MOVX    A,@DPTR
   \   00004A   F9           MOV     R1,A
   \   00004B                REQUIRE ?Subroutine0
   \   00004B                ; // Fall through to label ?Subroutine0
    546          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine0:
   \   000000   7401         MOV     A,#0x1
   \   000002   12....       LCALL   ?DEALLOC_XSTACK8
   \   000005   7F02         MOV     R7,#0x2
   \   000007   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine1:
   \   000000   E4           CLR     A
   \   000001   85..82       MOV     DPL,?XSP + 0
   \   000004   85..83       MOV     DPH,?XSP + 1
   \   000007                REQUIRE ??Subroutine4_0
   \   000007                ; // Fall through to label ??Subroutine4_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine4_0:
   \   000000   F0           MOVX    @DPTR,A
   \   000001                ; Setup parameters for call to function osal_nv_item_init
   \   000001                ; Setup parameters for call to function osal_nv_read
   \   000001                ; Setup parameters for call to function osal_nv_write
   \   000001   8582..       MOV     ?V0 + 0,DPL
   \   000004   8583..       MOV     ?V0 + 1,DPH
   \   000007   78..         MOV     R0,#?V0 + 0
   \   000009   22           RET
    547          
    548          /*********************************************************************
    549           * @fn          zgWriteStartupOptions
    550           *
    551           * @brief       Writes bits into the ZCD_NV_STARTUP_OPTION NV Item.
    552           *
    553           * @param       action - ZG_STARTUP_SET set bit, ZG_STARTUP_CLEAR to
    554           *               clear bit. The set bit is an OR operation, and the
    555           *               clear bit is an AND ~(bitOptions) operation.
    556           *
    557           * @param       bitOptions - which bits to perform action on:
    558           *                      ZCD_STARTOPT_DEFAULT_CONFIG_STATE
    559           *                      ZCD_STARTOPT_DEFAULT_NETWORK_STATE
    560           *
    561           * @return      ZSUCCESS if successful
    562           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    563          uint8 zgWriteStartupOptions( uint8 action, uint8 bitOptions )
   \                     zgWriteStartupOptions:
    564          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 1
   \   000005   74FF         MOV     A,#-0x1
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   E9           MOV     A,R1
   \   00000B   FE           MOV     R6,A
   \   00000C   EA           MOV     A,R2
   \   00000D   FF           MOV     R7,A
    565            uint8 status;
    566            uint8 startupOptions = 0;
   \   00000E   12....       LCALL   ?Subroutine1 & 0xFFFF
    567          
    568            status = osal_nv_read( ZCD_NV_STARTUP_OPTION,
    569                          0,
    570                          sizeof( startupOptions ),
    571                          &startupOptions );
   \                     ??CrossCallReturnLabel_3:
   \   000011   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000014   75..01       MOV     ?V0 + 0,#0x1
   \   000017   75..00       MOV     ?V0 + 1,#0x0
   \   00001A   78..         MOV     R0,#?V0 + 0
   \   00001C   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00001F   7C00         MOV     R4,#0x0
   \   000021   7D00         MOV     R5,#0x0
   \   000023   7A03         MOV     R2,#0x3
   \   000025   7B00         MOV     R3,#0x0
   \   000027   12....       LCALL   ??osal_nv_read?relay
   \   00002A   7404         MOV     A,#0x4
   \   00002C   12....       LCALL   ?DEALLOC_XSTACK8
   \   00002F   E9           MOV     A,R1
    572          
    573            if ( status == ZSUCCESS )
   \   000030   703C         JNZ     ??zgWriteStartupOptions_0
    574            {
    575              if ( action == ZG_STARTUP_SET )
   \   000032   74FF         MOV     A,#-0x1
   \   000034   6E           XRL     A,R6
   \   000035   700A         JNZ     ??zgWriteStartupOptions_1
    576              {
    577                // Set bits
    578                startupOptions |= bitOptions;
   \   000037   85..82       MOV     DPL,?XSP + 0
   \   00003A   85..83       MOV     DPH,?XSP + 1
   \   00003D   E0           MOVX    A,@DPTR
   \   00003E   4F           ORL     A,R7
   \   00003F   800C         SJMP    ??zgWriteStartupOptions_2
    579              }
    580              else
    581              {
    582                // Clear bits
    583                startupOptions &= (bitOptions ^ 0xFF);
   \                     ??zgWriteStartupOptions_1:
   \   000041   74FF         MOV     A,#-0x1
   \   000043   6F           XRL     A,R7
   \   000044   FA           MOV     R2,A
   \   000045   85..82       MOV     DPL,?XSP + 0
   \   000048   85..83       MOV     DPH,?XSP + 1
   \   00004B   E0           MOVX    A,@DPTR
   \   00004C   5A           ANL     A,R2
    584              }
    585          
    586              // Changed?
    587              status = osal_nv_write( ZCD_NV_STARTUP_OPTION,
    588                           0,
    589                           sizeof( startupOptions ),
    590                           &startupOptions );
    591            }
   \                     ??zgWriteStartupOptions_2:
   \   00004D   12....       LCALL   ??Subroutine4_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_4:
   \   000050   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000053   75..01       MOV     ?V0 + 0,#0x1
   \   000056   75..00       MOV     ?V0 + 1,#0x0
   \   000059   78..         MOV     R0,#?V0 + 0
   \   00005B   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00005E   7C00         MOV     R4,#0x0
   \   000060   7D00         MOV     R5,#0x0
   \   000062   7A03         MOV     R2,#0x3
   \   000064   7B00         MOV     R3,#0x0
   \   000066   12....       LCALL   ??osal_nv_write?relay
   \   000069   7404         MOV     A,#0x4
   \   00006B   12....       LCALL   ?DEALLOC_XSTACK8
    592          
    593            return ( status );
   \                     ??zgWriteStartupOptions_0:
   \   00006E   02....       LJMP    ?Subroutine0 & 0xFFFF
    594          }
    595          
    596          /*********************************************************************
    597           * @fn          zgSetItem
    598           *
    599           * @brief       Set RAM variables from set-NV, if it exist in the zgItemTable
    600           *
    601           * @param       id - NV ID
    602           *              len - NV item length
    603           *              buf - pointer to the input buffer
    604           *
    605           * @return      none
    606           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    607          void zgSetItem( uint16 id, uint16 len, void *buf )
   \                     zgSetItem:
    608          {
   \   000000   74F5         MOV     A,#-0xb
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 11
   \   000005                ; Auto size: 0
   \   000005   740B         MOV     A,#0xb
   \   000007   12....       LCALL   ?XSTACK_DISP0_8
   \   00000A   E0           MOVX    A,@DPTR
   \   00000B   F5..         MOV     ?V0 + 0,A
   \   00000D   A3           INC     DPTR
   \   00000E   E0           MOVX    A,@DPTR
   \   00000F   F5..         MOV     ?V0 + 1,A
    609          
    610            uint8  i = 0;
   \   000011   7E00         MOV     R6,#0x0
   \   000013   8001         SJMP    ??zgSetItem_0
    611          
    612            // Look up the NV item table
    613            while ( zgItemTable[i].id != 0x00 )
    614            {
    615              if( zgItemTable[i].id == id )
    616              {
    617                if ( zgItemTable[i].len == len )
    618                {
    619                  osal_memcpy( zgItemTable[i].buf, buf, len );
    620                }
    621                break;
    622              }
    623              // Move on to the next item
    624              i++;
   \                     ??zgSetItem_1:
   \   000015   0E           INC     R6
   \                     ??zgSetItem_0:
   \   000016   EE           MOV     A,R6
   \   000017   75F006       MOV     B,#0x6
   \   00001A   A4           MUL     AB
   \   00001B   24..         ADD     A,#(zgItemTable & 0xff)
   \   00001D   F582         MOV     DPL,A
   \   00001F   E5F0         MOV     A,B
   \   000021   12....       LCALL   ?Subroutine2 & 0xFFFF
   \                     ??CrossCallReturnLabel_1:
   \   000024   7001         JNZ     ??zgSetItem_2
   \   000026   E9           MOV     A,R1
   \                     ??zgSetItem_2:
   \   000027   6051         JZ      ??zgSetItem_3
   \   000029   12....       LCALL   ??Subroutine5_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_5:
   \   00002C   EA           MOV     A,R2
   \   00002D   68           XRL     A,R0
   \   00002E   7002         JNZ     ??zgSetItem_4
   \   000030   EB           MOV     A,R3
   \   000031   69           XRL     A,R1
   \                     ??zgSetItem_4:
   \   000032   70E1         JNZ     ??zgSetItem_1
   \   000034   EE           MOV     A,R6
   \   000035   75F006       MOV     B,#0x6
   \   000038   A4           MUL     AB
   \   000039   F8           MOV     R0,A
   \   00003A   AAF0         MOV     R2,B
   \   00003C   EA           MOV     A,R2
   \   00003D   F9           MOV     R1,A
   \   00003E   E8           MOV     A,R0
   \   00003F   24..         ADD     A,#((zgItemTable + 2) & 0xff)
   \   000041   F582         MOV     DPL,A
   \   000043   E9           MOV     A,R1
   \   000044   34..         ADDC    A,#(((zgItemTable + 2) >> 8) & 0xff)
   \   000046   12....       LCALL   ?Subroutine3 & 0xFFFF
   \                     ??CrossCallReturnLabel_6:
   \   000049   EC           MOV     A,R4
   \   00004A   68           XRL     A,R0
   \   00004B   7002         JNZ     ??zgSetItem_5
   \   00004D   ED           MOV     A,R5
   \   00004E   69           XRL     A,R1
   \                     ??zgSetItem_5:
   \   00004F   7029         JNZ     ??zgSetItem_3
   \   000051                ; Setup parameters for call to function osal_memcpy
   \   000051   75..00       MOV     ?V0 + 2,#0x0
   \   000054   78..         MOV     R0,#?V0 + 0
   \   000056   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   000059   EE           MOV     A,R6
   \   00005A   75F006       MOV     B,#0x6
   \   00005D   A4           MUL     AB
   \   00005E   F8           MOV     R0,A
   \   00005F   EA           MOV     A,R2
   \   000060   F9           MOV     R1,A
   \   000061   E8           MOV     A,R0
   \   000062   24..         ADD     A,#((zgItemTable + 4) & 0xff)
   \   000064   F582         MOV     DPL,A
   \   000066   E9           MOV     A,R1
   \   000067   34..         ADDC    A,#(((zgItemTable + 4) >> 8) & 0xff)
   \   000069   F583         MOV     DPH,A
   \   00006B   E4           CLR     A
   \   00006C   93           MOVC    A,@A+DPTR
   \   00006D   FA           MOV     R2,A
   \   00006E   7401         MOV     A,#0x1
   \   000070   93           MOVC    A,@A+DPTR
   \   000071   FB           MOV     R3,A
   \   000072   12....       LCALL   ??osal_memcpy?relay
   \   000075   7403         MOV     A,#0x3
   \   000077   12....       LCALL   ?DEALLOC_XSTACK8
    625            }
    626          }
   \                     ??zgSetItem_3:
   \   00007A   7F03         MOV     R7,#0x3
   \   00007C   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zgPollRate>`:
   \   000000   E803         DW 1000

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zgQueuedPollRate>`:
   \   000000   6400         DW 100

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zgResponsePollRate>`:
   \   000000   6400         DW 100

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zgRejoinPollRate>`:
   \   000000   B801         DW 440

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zgMaxDataRetries>`:
   \   000000   02           DB 2

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zgMaxPollFailureRetries>`:
   \   000000   02           DB 2

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zgDefaultChannelList>`:
   \   000000   00080000     DD 2048

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zgDefaultStartingScanDuratio`:
   \   000000   05           DB 5

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zgStackProfile>`:
   \   000000   02           DB 2

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zgIndirectMsgTimeout>`:
   \   000000   07           DB 7

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zgSecurePermitJoin>`:
   \   000000   01           DB 1

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zgRouteDiscoveryTime>`:
   \   000000   05           DB 5

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zgRouteExpiryTime>`:
   \   000000   1E           DB 30

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zgMaxBcastRetires>`:
   \   000000   02           DB 2

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zgPassiveAckTimeout>`:
   \   000000   05           DB 5

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zgBcastDeliveryTime>`:
   \   000000   1E           DB 30

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zgNwkMode>`:
   \   000000   02           DB 2

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zgConcentratorRadius>`:
   \   000000   0A           DB 10

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zgNwkSrcRtgExpiryTime>`:
   \   000000   0A           DB 10

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zgApscMaxFrameRetries>`:
   \   000000   03           DB 3

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zgApscAckWaitDurationPolled>`:
   \   000000   B80B         DW 3000

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zgApsAckWaitMultiplier>`:
   \   000000   02           DB 2

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zgApsDefaultMaxBindingTime>`:
   \   000000   803E         DW 16000

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zgApsUseInsecureJoin>`:
   \   000000   01           DB 1

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zgApsNonMemberRadius>`:
   \   000000   02           DB 2

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zgApsfMaxWindowSize>`:
   \   000000   03           DB 3

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zgApsfInterframeDelay>`:
   \   000000   3200         DW 50

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zgUseDefaultTCLK>`:
   \   000000   01           DB 1

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zgConfigPANID>`:
   \   000000   1111         DW 4369

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zgStartDelay>`:
   \   000000   0A           DB 10

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zgNwkMgrMinTransmissions>`:
   \   000000   14           DB 20

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zgNwkMgrMode>`:
   \   000000   01           DB 1

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zgSapiEndpoint>`:
   \   000000   E0           DB 224

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??zgInit?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zgInit

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??zgInitItems?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zgInitItems

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??zgReadStartupOptions?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zgReadStartupOptions

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??zgWriteStartupOptions?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zgWriteStartupOptions

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??zgSetItem?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zgSetItem
    627          
    628          /*********************************************************************
    629           * @fn       zgPreconfigKeyInit()
    630           *
    631           * @brief
    632           *
    633           *   Initialize ZCD_NV_PRECFGKEY NV item. If the item doesn't exist in NV memory,
    634           *   write the system default (value passed in) into NV memory. But if
    635           *   it exists do not overwrite it.
    636           *
    637           *   Also, if setDefault is TRUE and the item exists, we will write
    638           *   the default value to NV space.
    639           *
    640           * @param   setDefault - TRUE to set default
    641           *
    642           * @return  ZSUCCESS if successful, NV_ITEM_UNINIT if item did not
    643           *          exist in NV, NV_OPER_FAILED if failure.
    644           */
    645          static uint8 zgPreconfigKeyInit( uint8 setDefault )
    646          {
    647            uint8 zgPreConfigKey[SEC_KEY_LEN];
    648            uint8 status;
    649          
    650            // Initialize the Pre-Configured Key to the default key
    651            osal_memcpy( zgPreConfigKey, defaultKey, SEC_KEY_LEN );
    652          
    653            // If the item doesn't exist in NV memory, create and initialize it
    654            status = osal_nv_item_init( ZCD_NV_PRECFGKEY, SEC_KEY_LEN, zgPreConfigKey );
    655            if ( status == ZSUCCESS )
    656            {
    657              if ( setDefault )
    658              {
    659                // Write the default value back to NV
    660                status =  osal_nv_write( ZCD_NV_PRECFGKEY, 0, SEC_KEY_LEN, zgPreConfigKey );
    661              }
    662            }
    663          
    664            // clear local copy of default key
    665            osal_memset(zgPreConfigKey, 0x00, SEC_KEY_LEN);
    666          
    667            return (status);
    668          }
    669          
    670          /*********************************************************************
    671          *********************************************************************/

   Maximum stack usage in bytes:

     Function                   ISTACK PSTACK XSTACK
     --------                   ------ ------ ------
     zgInit                         0      0      9
       -> zgReadStartupOptions      0      0     18
       -> ZMacGetReq                0      0     18
       -> zgInitItems               0      0     18
       -> zgWriteStartupOptions     0      0     18
     zgInitItems                    0      0     27
       -> osal_nv_read              0      0     36
       -> osal_nv_item_init         0      0     32
       -> osal_nv_write             0      0     36
     zgReadStartupOptions           1      0     24
       -> osal_nv_item_init         0      0     26
       -> osal_nv_read              0      0     30
     zgSetItem                      0      0     16
       -> osal_memcpy               0      0     28
     zgWriteStartupOptions          1      0     24
       -> osal_nv_read              0      0     30
       -> osal_nv_write             0      0     30


   Segment part sizes:

     Function/Label                                 Bytes
     --------------                                 -----
     zgPollRate                                        2
     zgQueuedPollRate                                  2
     zgResponsePollRate                                2
     zgRejoinPollRate                                  2
     zgMaxDataRetries                                  1
     zgMaxPollFailureRetries                           1
     zgDefaultChannelList                              4
     zgDefaultStartingScanDuration                     1
     zgStackProfile                                    1
     zgIndirectMsgTimeout                              1
     zgSecurityMode                                    1
     zgSecurePermitJoin                                1
     zgTrustCenterAddr                                 2
     zgRouteDiscoveryTime                              1
     zgRouteExpiryTime                                 1
     zgExtendedPANID                                   8
     zgMaxBcastRetires                                 1
     zgPassiveAckTimeout                               1
     zgBcastDeliveryTime                               1
     zgNwkMode                                         1
     zgConcentratorEnable                              1
     zgConcentratorDiscoveryTime                       1
     zgConcentratorRadius                              1
     zgConcentratorRC                                  1
     zgNwkSrcRtgExpiryTime                             1
     zgApscMaxFrameRetries                             1
     zgApscAckWaitDurationPolled                       2
     zgApsAckWaitMultiplier                            1
     zgApsDefaultMaxBindingTime                        2
     zgApsUseExtendedPANID                             8
     zgApsUseInsecureJoin                              1
     zgApsNonMemberRadius                              1
     zgApsfMaxWindowSize                               1
     zgApsfInterframeDelay                             2
     zgPreConfigKeys                                   1
     zgUseDefaultTCLK                                  1
     zgConfigPANID                                     2
     zgDeviceLogicalType                               1
     zgStartDelay                                      1
     zgNwkMgrMinTransmissions                          1
     zgNwkMgrMode                                      1
     zgSapiEndpoint                                    1
     zgItemTable                                       6
     zgInit                                           47
     zgInitItems                                     195
     ?Subroutine2                                      7
     ?Subroutine3                                      2
     ??Subroutine5_0                                   8
     zgReadStartupOptions                             75
     ?Subroutine0                                     10
     ?Subroutine1                                      7
     ??Subroutine4_0                                  10
     zgWriteStartupOptions                           113
     zgSetItem                                       127
     ?<Initializer for zgPollRate>                     2
     ?<Initializer for zgQueuedPollRate>               2
     ?<Initializer for zgResponsePollRate>             2
     ?<Initializer for zgRejoinPollRate>               2
     ?<Initializer for zgMaxDataRetries>               1
     ?<Initializer for zgMaxPollFailureRetries>        1
     ?<Initializer for zgDefaultChannelList>           4
     ?<Initializer for zgDefaultStartingScanDuratio    1
     ?<Initializer for zgStackProfile>                 1
     ?<Initializer for zgIndirectMsgTimeout>           1
     ?<Initializer for zgSecurePermitJoin>             1
     ?<Initializer for zgRouteDiscoveryTime>           1
     ?<Initializer for zgRouteExpiryTime>              1
     ?<Initializer for zgMaxBcastRetires>              1
     ?<Initializer for zgPassiveAckTimeout>            1
     ?<Initializer for zgBcastDeliveryTime>            1
     ?<Initializer for zgNwkMode>                      1
     ?<Initializer for zgConcentratorRadius>           1
     ?<Initializer for zgNwkSrcRtgExpiryTime>          1
     ?<Initializer for zgApscMaxFrameRetries>          1
     ?<Initializer for zgApscAckWaitDurationPolled>    2
     ?<Initializer for zgApsAckWaitMultiplier>         1
     ?<Initializer for zgApsDefaultMaxBindingTime>     2
     ?<Initializer for zgApsUseInsecureJoin>           1
     ?<Initializer for zgApsNonMemberRadius>           1
     ?<Initializer for zgApsfMaxWindowSize>            1
     ?<Initializer for zgApsfInterframeDelay>          2
     ?<Initializer for zgUseDefaultTCLK>               1
     ?<Initializer for zgConfigPANID>                  2
     ?<Initializer for zgStartDelay>                   1
     ?<Initializer for zgNwkMgrMinTransmissions>       1
     ?<Initializer for zgNwkMgrMode>                   1
     ?<Initializer for zgSapiEndpoint>                 1
     ??zgInit?relay                                    6
     ??zgInitItems?relay                               6
     ??zgReadStartupOptions?relay                      6
     ??zgWriteStartupOptions?relay                     6
     ??zgSetItem?relay                                 6

 
 601 bytes in segment BANKED_CODE
  30 bytes in segment BANK_RELAYS
   6 bytes in segment CODE_C
  44 bytes in segment XDATA_I
  44 bytes in segment XDATA_ID
  24 bytes in segment XDATA_Z
 
 681 bytes of CODE  memory
  68 bytes of XDATA memory

Errors: none
Warnings: none
